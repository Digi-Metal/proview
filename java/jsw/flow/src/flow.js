"use strict";function PwrtStatus(e){this.sts=e,this.evenSts=function(){return e%2==0},this.oddSts=function(){return e%2==1},this.getSts=function(){return e}}var Pwr={eType_Boolean:98305,eType_Float32:98306,eType_Float64:98307,eType_Char:98308,eType_Int8:98309,eType_Int16:98310,eType_Int32:98311,eType_UInt8:98312,eType_UInt16:98313,eType_UInt32:98314,eType_Objid:98315,eType_Buffer:98316,eType_String:98317,eType_Enum:98318,eType_Struct:98319,eType_Mask:98320,eType_Array:98321,eType_Time:98322,eType_Text:98323,eType_AttrRef:98324,eType_UInt64:98325,eType_Int64:98326,eType_ClassId:98327,eType_TypeId:98328,eType_VolumeId:98329,eType_ObjectIx:98330,eType_RefId:98331,eType_DeltaTime:98332,eType_Status:98333,eType_NetStatus:98334,eType_CastId:98335,eType_ProString:98336,eType_DisableAttr:98337,eType_DataRef:98338,mPrv_RtRead:1,mPrv_RtWrite:2,mPrv_System:4,mPrv_Maintenance:8,mPrv_Process:16,mPrv_Instrument:32,mPrv_Operator1:64,mPrv_Operator2:128,mPrv_Operator3:256,mPrv_Operator4:512,mPrv_Operator5:1024,mPrv_Operator6:2048,mPrv_Operator7:4096,mPrv_Operator8:8192,mPrv_Operator9:16384,mPrv_Operator10:32768,mPrv_RtEventsAck:1<<18,mPrv_RtPlc:1<<19,mPrv_RtNavigator:1<<20,mPrv_DevRead:1<<21,mPrv_DevPlc:1<<22,mPrv_DevConfig:1<<23,mPrv_DevClass:1<<24,mPrv_RtEventsBlock:1<<25,mPrv_Administrator:1<<26,mPrv_SevRead:1<<27,mPrv_SevAdmin:1<<28,mAccess_RtRead:1,mAccess_RtWrite:2,mAccess_System:4,mAccess_Maintenance:8,mAccess_Process:16,mAccess_Instrument:32,mAccess_RtEventsBlock:1<<25,mAccess_RtEventsAck:1<<18,mAccess_RtPlc:1<<19,mAccess_RtNavigator:1<<20,mAccess_AllRt:35454975,mAccess_AllOperators:65472,mAccess_AllPwr:-1,mAdef_pointer:1,mAdef_array:2,mAdef_backup:4,mAdef_changelog:8,mAdef_state:16,mAdef_const:32,mAdef_rtvirtual:64,mAdef_devbodyref:128,mAdef_dynamic:256,mAdef_publicwrite:512,mAdef_noedit:1024,mAdef_invisible:2048,mAdef_refdirect:4096,mAdef_noinvert:8192,mAdef_noremove:16384,mAdef_rtdbref:32768,mAdef_private:65536,mAdef_class:131072,mAdef_superclass:262144,mAdef_buffer:524288,mAdef_nowbl:1048576,mAdef_alwayswbl:2097152,mAdef_disableattr:4194304,mAdef_rthide:8388608},Pwrb={mXttMethodsFlagsMask_IsConfigured:1,mXttOpMethodsMask_OpenGraph:1,mXttOpMethodsMask_OpenObjectGraph:2,mXttOpMethodsMask_OpenTrend:4,mXttOpMethodsMask_OpenHistory:8,mXttOpMethodsMask_OpenFast:16,mXttOpMethodsMask_Camera:32,mXttOpMethodsMask_HistEvent:64,mXttOpMethodsMask_BlockEvents:128,mXttOpMethodsMask_Help:256,mXttOpMethodsMask_Photo:512,mXttOpMethodsMask_Note:1024,mXttOpMethodsMask_ParentObjectGraph:2048,mXttMntMethodsMask_OpenObject:1,mXttMntMethodsMask_OpenTrace:2,mXttMntMethodsMask_RtNavigator:4,mXttMntMethodsMask_OpenCrossref:8,mXttMntMethodsMask_HelpClass:16,mXttMntMethodsMask_DataSheet:32,mXttMntMethodsMask_CircuitDiagram:64,mXttMntMethodsMask_Simulate:1<<31};function PwrtObjid(e,t){this.oix=t,this.vid=e}function PwrtAttrRef(){this.objid,this.offset,this.body,this.size,this.flags}function CdhrNumber(e,t){this.value=e,this.sts=t,this.evenSts=function(){return t%2==0},this.oddSts=function(){return t%2==1},this.getSts=function(){return t}}var CdhC={cUserVolMin:65793,cUserVolMax:16711422};function UserdataCbReturn(){this.userdata,this.row}function Sub(){this.sts,this.refid,this.type,this.elements,this.name,this.value}function ObjectInfo(){this.objid,this.cid,this.has_children,this.name,this.description,this.classname,this.full_name,this.param1}function AttributeInfo(){this.name,this.type,this.size,this.flags,this.element,this.objid,this.full_name,this.classname}function MenuButton(){this.type,this.text,this.name,this.url}function OpwindMenuInfo(){this.title,this.text,this.enable_language,this.enable_login,this.enable_alarmlist,this.enable_eventlog,this.enable_navigator,this.disable_help,this.disable_proview,this.language,this.buttons=[]}function CrrInfo(){this.type,this.objid,this.name,this.classname}function GlowPieInfo(){this.sector_num,this.min_val,this.max_val}function GlowBarChartInfo(){this.bars,this.barsegments,this.min_value,this.max_value}function GlowTableInfo(){this.columns,this.rows,this.column_size=new Array(Glow.TABLE_MAX_COL)}function PendingData(e,t){this.func_cb=e,this.data=t}var GdhOp={GET_OP_SELF:1,GET_OP_METHOD_PLC:2,GET_OP_METHOD_OBJECTGRAPH:3,GET_OP_METHOD_GRAPH:4,GET_OP_METHOD_HELPCLASS:5};function Gdh(){var P=1,j=2,O=3,z=4,D=5,R=6,M=7,N=9,L=10,E=15,G=25,B=26,X=29,W=36,H=39,V=42,q=50,Y=57,J=63,K=64,Q=65,Z=66,$=67,ee=68;this.debug=!1,this.pending=[],this.sub=[],this.PORT=4448,this.ws=null,this.open_cb=null,this.close_cb=null,this.return_cb=null,this.next_id=1234,this.subscriptionCount=1,this.listSend=!1,this.init=function(){""===window.location.hostname?this.ws=new WebSocket("ws:127.0.0.1:4448"):this.ws=new WebSocket("ws://"+window.location.hostname+":4448"),this.ws.binaryType="arraybuffer",(this.ws.gdh=this).ws.onopen=function(e){null!==this.gdh.open_cb&&this.gdh.open_cb()},this.ws.onclose=function(){this.debug&&console.log("Socket closed"),null!==this.gdh.close_cb&&this.gdh.close_cb()},this.ws.onmessage=function(e){if("string"==typeof e.data)console.log("String message received",e,e.data);else if(e.data instanceof ArrayBuffer){var t=new DataView(e.data),n=t.getUint8(0),i=t.getUint32(1),a=t.getUint32(5);switch(n){case D:this.gdh.debug&&console.log("GetObjectInfoBoolean received");var o=t.getUint8(9);(0,this.gdh.pending[i].func_cb)(i,a,o),delete this.gdh.pending[i];break;case M:this.gdh.debug&&console.log("GetObjectInfoInt received");o=t.getUint32(9);(U=this.gdh.pending[i]).func_cb(i,U.data,a,o),delete this.gdh.pending[i];break;case R:this.gdh.debug&&console.log("GetObjectInfoFloat received");o=t.getFloat32(9);(U=this.gdh.pending[i]).func_cb(i,U.data,a,o),delete this.gdh.pending[i];break;case Y:this.gdh.debug&&console.log("GetObjectInfoFloatArray received");var s=t.getInt32(9);o=new Array(s);g=13;for(var r=0;r<s;r++)o[r]=t.getFloat32(g),g+=4;(U=this.gdh.pending[i]).func_cb(i,U.data,a,o),delete this.gdh.pending[i];break;case P:this.gdh.debug&&console.log("SetObjectInfoBoolean received",i,a);break;case O:this.gdh.debug&&console.log("SetObjectInfoInt received",i,a);break;case j:this.gdh.debug&&console.log("SetObjectInfoFloat received",i,a);break;case z:this.gdh.debug&&console.log("SetObjectInfoString received",i,a);break;case N:this.gdh.debug&&console.log("ToggleObjectInfo received",i,a);break;case L:this.gdh.debug&&console.log("RefObjectInfo received",i,a),delete this.gdh.pending[i];break;case E:this.gdh.debug&&console.log("UnrefObjectInfo received",i,a),delete this.gdh.pending[i];break;case B:this.gdh.debug&&console.log("RefObjectInfoList received",i,a),(0,this.gdh.pending[i].func_cb)(i,a),delete this.gdh.pending[i];break;case G:var _=9,l=t.getUint32(_);this.gdh.debug&&console.log("GetObjectRefInfoAll received",i,l),_+=4;for(r=0;r<l;r++){var h=t.getUint32(_);_+=4;var c=t.getUint32(_);_+=4;var d=this.gdh.sub[h];if(void 0===d)_+=c;else{switch(d.type){case Pwr.eType_Boolean:if(d.elements<=1)o=t.getUint8(_),_+=1;else{(v=c)!=d.elements&&console.log("Subscription size error",v,d.elements,h),o=new Array(v);for(var g=0;g<v;g++)o[g]=t.getUint8(_),_+=1}break;case Pwr.eType_Float32:if(d.elements<=1)o=t.getFloat32(_),_+=4;else{(v=c/4)!=d.elements&&console.log("Subscription size error",v,d.elements,h),o=new Array(v);for(g=0;g<v;g++)o[g]=t.getFloat32(_),_+=4}break;case Pwr.eType_Int8:case Pwr.eType_Int16:case Pwr.eType_Int32:case Pwr.eType_UInt8:case Pwr.eType_UInt16:case Pwr.eType_UInt32:case Pwr.eType_Status:case Pwr.eType_NetStatus:case Pwr.eType_Mask:case Pwr.eType_Enum:case GraphIfc.eType_Bit:if(d.elements<=1)o=t.getInt32(_),_+=4;else{(v=c/4)!=d.elements&&console.log("Subscription size error",v,d.elements,h),o=new Array(v);for(g=0;g<v;g++)o[g]=t.getInt32(_),_+=4}break;case Pwr.eType_String:case Pwr.eType_Time:case Pwr.eType_DeltaTime:case Pwr.eType_AttrRef:case Pwr.eType_Objid:if(d.elements<=1){var w=t.getInt16(_);_+=2;var f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);o=String.fromCharCode.apply(null,f)}else{var v;(v=d.elements)!=d.elements&&console.log("Subscription size error",v,d.elements,h),o=new Array(v);for(var p=0;p<v;p++){w=t.getInt16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);o[p]=String.fromCharCode.apply(null,f)}}}this.gdh.sub[h].value=o}}if(void 0===this.gdh.pending[i]){console.log("** GetObjectRefInfoAll received removed",i);break}(0,this.gdh.pending[i].func_cb)(i,a),delete this.gdh.pending[i];break;case H:var u=[];_=9,l=t.getUint32(_);this.gdh.debug&&console.log("GetAllXttChildren received",i,l),console.log("GetAllXttChildren received",a,i,l),_+=4;for(r=0;r<l;r++){(y=new ObjectInfo).objid=new PwrtObjid,y.objid.vid=t.getUint32(_),_+=4,y.objid.oix=t.getUint32(_),_+=4,y.cid=t.getUint32(_),_+=4,y.has_children=0!==t.getUint16(_),_+=2;w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);y.name=String.fromCharCode.apply(null,f);var b=t.getUint16(_);_+=2,f=new Uint8Array(b);for(g=0;g<b;g++)f[g]=t.getUint8(_++);y.description=String.fromCharCode.apply(null,f);var x=t.getUint16(_);_+=2,f=new Uint8Array(x);for(g=0;g<x;g++)f[g]=t.getUint8(_++);y.classname=String.fromCharCode.apply(null,f),u.push(y)}(U=this.gdh.pending[i]).func_cb(i,U.data,a,u),delete this.gdh.pending[i];break;case W:u=[],_=9,l=t.getUint32(_);this.gdh.debug&&console.log("GetAllClassAttributes received",i,l),_+=4;for(r=0;r<l;r++){(y=new AttributeInfo).type=t.getUint32(_),_+=4,y.flags=t.getUint32(_),_+=4,y.size=t.getUint16(_),_+=2,y.elements=t.getUint16(_),_+=2;w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);y.name=String.fromCharCode.apply(null,f),w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);y.classname=String.fromCharCode.apply(null,f),u.push(y)}(U=this.gdh.pending[i]).func_cb(i,U.data,a,u),delete this.gdh.pending[i];break;case J:case ee:case Q:this.gdh.debug&&console.log("GetObject received",i,a);var y=null;if(0!=(1&a)){_=9;(y=new ObjectInfo).objid=new PwrtObjid,y.objid.vid=t.getUint32(_),_+=4,y.objid.oix=t.getUint32(_),_+=4,y.cid=t.getUint32(_),_+=4,y.has_children=0!==t.getUint16(_),_+=2;w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);y.name=String.fromCharCode.apply(null,f),w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);y.fullname=String.fromCharCode.apply(null,f);x=t.getUint16(_);_+=2,f=new Uint8Array(x);for(g=0;g<x;g++)f[g]=t.getUint8(_++);y.classname=String.fromCharCode.apply(null,f);b=t.getUint16(_);_+=2,f=new Uint8Array(b);for(g=0;g<b;g++)f[g]=t.getUint8(_++);y.description=String.fromCharCode.apply(null,f);var S=t.getUint16(_);_+=2,f=new Uint8Array(S);for(g=0;g<S;g++)f[g]=t.getUint8(_++);y.param1=String.fromCharCode.apply(null,f)}(U=this.gdh.pending[i]).func_cb(i,U.data,a,y),delete this.gdh.pending[i];break;case V:if(0!=(1&a)){_=9,u=[],l=t.getUint16(_);_+=2,this.gdh.debug&&console.log("CrrSignal received",i,l);for(r=0;r<l;r++){(y=new CrrInfo).type=t.getUint16(_),_+=2,y.objid=new PwrtObjid,y.objid.vid=t.getUint32(_),_+=4,y.objid.oix=t.getUint32(_),_+=4;w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);y.name=String.fromCharCode.apply(null,f);x=t.getUint16(_);_+=2,f=new Uint8Array(x);for(g=0;g<x;g++)f[g]=t.getUint8(_++);y.classname=String.fromCharCode.apply(null,f),u.push(y)}}(U=this.gdh.pending[i]).func_cb(i,U.data,a,u),delete this.gdh.pending[i];break;case K:u=new OpwindMenuInfo,_=9;if(this.gdh.debug&&console.log("GetOpwindMenu received",i,l),console.log("GetOpwindMenu received",a,i),1&a){w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);u.title=String.fromCharCode.apply(null,f),w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);u.text=String.fromCharCode.apply(null,f),u.enable_language=t.getUint32(_),_+=4,u.enable_login=t.getUint32(_),_+=4,u.enable_alarmlist=t.getUint32(_),_+=4,u.enable_eventlog=t.getUint32(_),_+=4,u.enable_navigator=t.getUint32(_),_+=4,u.disable_help=t.getUint32(_),_+=4,u.disable_proview=t.getUint32(_),_+=4,u.language=t.getUint32(_),_+=4;var m=t.getUint16(_);_+=2;for(r=0;r<m;r++){var C=new MenuButton;C.type=t.getUint32(_),_+=4,w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);C.text=String.fromCharCode.apply(null,f),w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);C.name=String.fromCharCode.apply(null,f),w=t.getUint16(_),_+=2,f=new Uint8Array(w);for(g=0;g<w;g++)f[g]=t.getUint8(_++);C.url=String.fromCharCode.apply(null,f),u.buttons.push(C)}}(U=this.gdh.pending[i]).func_cb(i,U.data,a,u),delete this.gdh.pending[i];break;case X:_=9;this.gdh.debug&&console.log("Check user received",i,l),console.log("Check user received",a,i);var F=0;1&a&&(F=t.getUint32(_),_+=4),(U=this.gdh.pending[i]).func_cb(i,U.data,a,F),delete this.gdh.pending[i];break;case q:if(1&a){_=9,w=t.getUint16(_);_+=2;for(f=new Uint8Array(w),g=0;g<w;g++)f[g]=t.getUint8(_++);var k=String.fromCharCode.apply(null,f)}(U=this.gdh.pending[i]).func_cb(i,U.data,a,k),delete this.gdh.pending[i];break;case Z:u=[],_=9,l=t.getUint32(_);this.gdh.debug&&console.log("MhSync received",i,l),_+=4;for(r=0;r<l;r++){e=new MhEvent;var A=t.getUint16(_);_+=2;for(f=new Uint8Array(A),g=0;g<A;g++)f[g]=t.getUint8(_++);e.eventTime=String.fromCharCode.apply(null,f),A=t.getUint16(_),_+=2,f=new Uint8Array(A);for(g=0;g<A;g++)f[g]=t.getUint8(_++);e.eventText=String.fromCharCode.apply(null,f),A=t.getUint16(_),_+=2,f=new Uint8Array(A);for(g=0;g<A;g++)f[g]=t.getUint8(_++);e.eventName=String.fromCharCode.apply(null,f),e.eventFlags=t.getUint32(_),_+=4,e.eventStatus=t.getUint32(_),_+=4,e.eventPrio=t.getUint32(_),_+=4,e.eventId=new MhEventId,e.eventId.nix=t.getUint32(_),_+=4,e.eventId.idx=t.getUint32(_),_+=4,A=t.getUint16(_),_+=2,f=new Uint8Array(A);for(g=0;g<A;g++)f[g]=t.getUint8(_++);e.eventId.birthTime=String.fromCharCode.apply(null,f),e.targetId=new MhEventId,e.targetId.nix=t.getUint32(_),_+=4,e.targetId.idx=t.getUint32(_),_+=4,A=t.getUint16(_),_+=2,f=new Uint8Array(A);for(g=0;g<A;g++)f[g]=t.getUint8(_++);e.targetId.birthTime=String.fromCharCode.apply(null,f),e.eventType=t.getUint32(_),_+=4;var T=new PwrtObjid(0,0);T.vid=t.getUint32(_),_+=4,T.oix=t.getUint32(_),_+=4,e.object=new PwrtAttrRef,e.object.objid=T,e.object.offset=t.getUint32(_),_+=4,e.object.body=t.getUint32(_),_+=4,e.object.size=t.getUint32(_),_+=4,e.object.flags=t.getUint32(_),_+=4;var I=new PwrtObjid(0,0);I.vid=t.getUint32(_),_+=4,I.oix=t.getUint32(_),_+=4,e.supObject=new PwrtAttrRef,e.supObject.objid=I,e.supObject.offset=t.getUint32(_),_+=4,e.supObject.body=t.getUint32(_),_+=4,e.supObject.size=t.getUint32(_),_+=4,e.supObject.flags=t.getUint32(_),_+=4,A=t.getUint16(_),_+=2,f=new Uint8Array(A);for(g=0;g<A;g++)f[g]=t.getUint8(_++);e.eventMoreText=String.fromCharCode.apply(null,f),e.syncIdx=t.getUint32(_),_+=4,u.push(e)}(U=this.gdh.pending[i]).func_cb(i,U.data,a,u),delete this.gdh.pending[i];break;case $:var U;(U=this.gdh.pending[i]).func_cb(i,U.data,a),delete this.gdh.pending[i];break;default:console.log("Unknown message type")}}}},this.getObjectInfoBoolean=function(e,t){this.return_cb=t;var n=new Uint8Array(e.length+6);n[0]=D,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;for(var i=0;i<e.length;i++)n[i+6]=e.charCodeAt(i);this.pending[this.next_id]=new PendingData(t,null),this.ws.send(n),this.next_id++},this.getObjectInfoInt=function(e,t,n){this.return_cb=t;var i=new Uint8Array(e.length+6);i[0]=M,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;for(var a=0;a<e.length;a++)i[a+6]=e.charCodeAt(a);this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.next_id++},this.getObjectInfoFloat=function(e,t,n){this.return_cb=t;var i=new Uint8Array(e.length+6);i[0]=R,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;for(var a=0;a<e.length;a++)i[a+6]=e.charCodeAt(a);this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.next_id++},this.getObjectInfoFloatArray=function(e,t,n,i){this.return_cb=n;var a=new Uint8Array(e.length+10);a[0]=Y,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&t,a[7]=t>>8&255,a[8]=t>>16&255,a[9]=t>>24&255;for(var o=0;o<e.length;o++)a[o+10]=e.charCodeAt(o);this.pending[this.next_id]=new PendingData(n,i),this.ws.send(a),this.next_id++},this.refObjectInfo=function(e,t,n){var i=new Sub;if(i.name=e,i.refid=this.subscriptionCount,i.type=t,i.elements=n,this.sub[this.subscriptionCount]=i,this.subscriptionCount++,this.listSent){var a;a=12+i.name.length;var o=new Uint8Array(a+10);o[0]=L,o[2]=255&this.next_id,o[3]=this.next_id>>8&255,o[4]=this.next_id>>16&255,o[5]=this.next_id>>24&255,this.debug&&console.log("RefObjectInfo: ",i.refid);var s=6;o[s++]=255&i.refid,o[s++]=i.refid>>8&255,o[s++]=i.refid>>16&255,o[s++]=i.refid>>24&255,o[s++]=255&i.elements,o[s++]=i.elements>>8&255,o[s++]=i.elements>>16&255,o[s++]=i.elements>>24&255,o[s++]=255&i.name.length,o[s++]=i.name.length>>8&255,o[s++]=i.name.length>>16&255,o[s++]=i.name.length>>24&255;for(var r=0;r<i.name.length;r++)o[s++]=i.name.charCodeAt(r);return this.pending[this.next_id]=new PendingData(this.refObjectInfoReply,null),this.debug&&console.log("Sending RefObjectInfo",this.next_id,a,s),this.ws.send(o),this.next_id++,i.refid}return i.refid},this.refObjectInfoReply=function(e,t){this.debug&&console.log("refObjectInfoReply",e,t)},this.unrefObjectInfo=function(e){var t=new Uint8Array(14);t[0]=E,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,this.debug&&console.log("UnrefObjectInfo: ",e);var n=6;t[n++]=255&e,t[n++]=e>>8&255,t[n++]=e>>16&255,t[n++]=e>>24&255,this.pending[this.next_id]=new PendingData(this.unrefObjectInfoReply,null),this.debug&&console.log("Sending UnrefObjectInfo",this.next_id,4,10,e),this.ws.send(t),this.next_id++,delete this.sub[e]},this.refObjectInfoList=function(e){var t=0,n=0;for(var i in this.return_cb=e,this.sub)t+=12+this.sub[i].name.length,n++;var a=new Uint8Array(t+10);a[0]=B,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&n,a[7]=n>>8&255,a[8]=n>>16&255,a[9]=n>>24&255;var o=10;for(var i in this.sub)if(0!==i){this.debug&&console.log("RefObjectInfoList: ",this.sub[i].refid),a[o++]=255&this.sub[i].refid,a[o++]=this.sub[i].refid>>8&255,a[o++]=this.sub[i].refid>>16&255,a[o++]=this.sub[i].refid>>24&255,a[o++]=255&this.sub[i].elements,a[o++]=this.sub[i].elements>>8&255,a[o++]=this.sub[i].elements>>16&255,a[o++]=this.sub[i].elements>>24&255,a[o++]=255&this.sub[i].name.length,a[o++]=this.sub[i].name.length>>8&255,a[o++]=this.sub[i].name.length>>16&255,a[o++]=this.sub[i].name.length>>24&255;for(var s=0;s<this.sub[i].name.length;s++)a[o++]=this.sub[i].name.charCodeAt(s)}this.pending[this.next_id]=new PendingData(e,null),this.debug&&console.log("Sending RefObjectInfoList",this.next_id,t,o,this.next_id),this.ws.send(a),this.next_id++,this.listSent=!0},this.refObjectInfoListReply=function(e,t){this.debug&&console.log("refObjectInfoListReply",e,t)},this.getRefObjectInfoAll=function(e){var t=new Uint8Array(6);t[0]=G,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,this.pending[this.next_id]=new PendingData(e,null),this.debug&&console.log("Sending getRefObjectInfoAll",this.next_id),this.ws.send(t),this.next_id++},this.getRefObjectInfoAllReply=function(e,t){this.debug&&console.log("getRefObjectInfoAllReply",e,t)},this.getObjectRefInfo=function(e){return this.debug&&console.log("getObjectRefInfo",e,this.sub[e].value),this.sub[e].value},this.setObjectInfoBoolean=function(e,t){var n=new Uint8Array(12+e.length);n[0]=P,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,n[10]=255&e.length,n[11]=e.length>>8&255;for(var i=12,a=0;a<e.length;a++)n[i++]=e.charCodeAt(a);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoBoolean",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoInt=function(e,t){var n=new Uint8Array(12+e.length);n[0]=O,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,n[10]=255&e.length,n[11]=e.length>>8&255;for(var i=12,a=0;a<e.length;a++)n[i++]=e.charCodeAt(a);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoInt",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoFloat=function(e,t){var n=new Uint8Array(12+e.length);n[0]=j,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;var i=new ArrayBuffer(4);new Float32Array(i)[0]=t;var a=new Uint8Array(i);n[6]=a[0],n[7]=a[1],n[8]=a[2],n[9]=a[3],n[10]=255&e.length,n[11]=e.length>>8&255;for(var o=12,s=0;s<e.length;s++)n[o++]=e.charCodeAt(s);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoFloat",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoString=function(e,t){var n,i=new Uint8Array(10+t.length+e.length);i[0]=z,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&t.length,i[7]=t.length>>8&255;var a=8;for(n=0;n<t.length;n++)i[a++]=t.charCodeAt(n);for(i[a++]=255&e.length,i[a++]=e.length>>8&255,n=0;n<e.length;n++)i[a++]=e.charCodeAt(n);return this.ws.send(i),this.debug&&console.log("Sending setObjectInfoString",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.toggleObjectInfo=function(e){var t=new Uint8Array(8+e.length);t[0]=N,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,t[6]=255&e.length,t[7]=e.length>>8&255;for(var n=8,i=0;i<e.length;i++)t[n++]=e.charCodeAt(i);return this.ws.send(t),this.debug&&console.log("Sending toggleObjectInfoBoolean",this.next_id,e,value),this.next_id++,new PwrtStatus(1)},this.getAllXttChildren=function(e,t,n){var i=new Uint8Array(14);i[0]=H,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.vid,i[7]=e.vid>>8&255,i[8]=e.vid>>16&255,i[9]=e.vid>>24&255,i[10]=255&e.oix,i[11]=e.oix>>8&255,i[12]=e.oix>>16&255,i[13]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending getAllXttChildren",this.next_id),this.ws.send(i),this.next_id++},this.getAllClassAttributes=function(e,t,n,i){var a=new Uint8Array(18);a[0]=W,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&e,a[7]=e>>8&255,a[8]=e>>16&255,a[9]=e>>24&255,a[10]=255&t.vid,a[11]=t.vid>>8&255,a[12]=t.vid>>16&255,a[13]=t.vid>>24&255,a[14]=255&t.oix,a[15]=t.oix>>8&255,a[16]=t.oix>>16&255,a[17]=t.oix>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getAllClassAttributes",this.next_id,e,t.vid,t.oix),this.ws.send(a),this.next_id++},this.getObject=function(e,t,n,i){var a=new Uint8Array(16);a[0]=J,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&t,a[7]=t>>8&255,a[8]=255&e.vid,a[9]=e.vid>>8&255,a[10]=e.vid>>16&255,a[11]=e.vid>>24&255,a[12]=255&e.oix,a[13]=e.oix>>8&255,a[14]=e.oix>>16&255,a[15]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObject",this.next_id,e.vid,e.oix),this.ws.send(a),this.next_id++},this.getObjectFromAref=function(e,t,n,i){var a=new Uint8Array(32);a[0]=ee,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&t,a[7]=t>>8&255,a[8]=255&e.objid.vid,a[9]=e.objid.vid>>8&255,a[10]=e.objid.vid>>16&255,a[11]=e.objid.vid>>24&255,a[12]=255&e.objid.oix,a[13]=e.objid.oix>>8&255,a[14]=e.objid.oix>>16&255,a[15]=e.objid.oix>>24&255,a[16]=255&e.offset,a[17]=e.offset>>8&255,a[18]=e.offset>>16&255,a[19]=e.offset>>24&255,a[20]=255&e.body,a[21]=e.body>>8&255,a[22]=e.body>>16&255,a[23]=e.body>>24&255,a[24]=255&e.size,a[25]=e.size>>8&255,a[26]=e.size>>16&255,a[27]=e.size>>24&255,a[28]=255&e.flags,a[29]=e.flags>>8&255,a[30]=e.flags>>16&255,a[31]=e.flags>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObject",this.next_id,oid.vid,oid.oix),this.ws.send(a),this.next_id++},this.getObjectFromName=function(e,t,n,i){var a=new Uint8Array(10+e.length);a[0]=Q,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255,a[6]=255&t,a[7]=t>>8&255,a[8]=255&e.length,a[9]=e.length>>8&255;for(var o=10,s=0;s<e.length;s++)a[o++]=e.charCodeAt(s);this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObjectFromName",this.next_id,e),this.ws.send(a),this.next_id++},this.crrSignal=function(e,t,n){var i=new Uint8Array(14);i[0]=V,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.vid,i[7]=e.vid>>8&255,i[8]=e.vid>>16&255,i[9]=e.vid>>24&255,i[10]=255&e.oix,i[11]=e.oix>>8&255,i[12]=e.oix>>16&255,i[13]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending crrObject",this.next_id,e.vid,e.oix),this.ws.send(i),this.next_id++},this.getOpwindMenu=function(e,t,n){e.length;var i=new Uint8Array(8+e.length);i[0]=K,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.length,i[7]=e.length>>8&255;for(var a=8,o=0;o<e.length;o++)i[a++]=e.charCodeAt(o);this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending getOpwindMenu",this.next_id),this.ws.send(i),this.next_id++},this.login=function(e,t,n,i){var a=new Uint8Array(8+e.length+2+t.length);a[0]=X,a[2]=255&this.next_id,a[3]=this.next_id>>8&255,a[4]=this.next_id>>16&255,a[5]=this.next_id>>24&255;var o=6;a[o]=255&e.length,a[o+1]=e.length>>8&255,o+=2;for(var s=0;s<e.length;s++)a[o++]=e.charCodeAt(s);a[o]=255&t.length,a[o+1]=t.length>>8&255,o+=2;for(s=0;s<t.length;s++)a[o++]=t.charCodeAt(s);this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending login",this.next_id),this.ws.send(a),this.next_id++},this.getMsg=function(e,t,n){var i=new Uint8Array(10);i[0]=q,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.debug&&console.log("Sending getMsg",this.next_id,e),this.next_id++},this.mhSync=function(e,t,n){var i=new Uint8Array(10);i[0]=Z,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending mhSync",this.next_id),this.ws.send(i),this.next_id++},this.mhAcknowledge=function(e,t,n){var i=new Uint8Array(16+e.birthTime.length);i[0]=$,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.nix,i[7]=e.nix>>8&255,i[8]=e.nix>>16&255,i[9]=e.nix>>24&255,i[10]=255&e.idx,i[11]=e.idx>>8&255,i[12]=e.idx>>16&255,i[13]=e.idx>>24&255;var a=14;i[a]=255&e.birthTime.length,i[a+1]=e.birthTime.length>>8&255,a+=2;for(var o=0;o<e.birthTime.length;o++)i[a++]=e.birthTime.charCodeAt(o);this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending mhAcknowledge",this.next_id),console.log("Sending mhAcknowledge",this.next_id),this.ws.send(i),this.next_id++}}var Flow={DRAWOFFSET:2,eConType_Straight:0,eConType_Fixed:1,eConType_AllFixed:2,eConType_Routed:3,eConType_StepDiv:4,eConType_StepConv:5,eConType_TransDiv:6,eConType_TransConv:7,eConType_StraightOneArrow:8,eConType_Reference:9,eDrawType_Line:0,eDrawType_LineRed:1,eDrawType_LineGray:2,eDrawType_LineErase:3,eDrawType_LineDashed:4,eDrawType_LineDashedRed:5,eDrawType_TextHelvetica:6,eDrawType_TextHelveticaBold:7,eDrawType_TextHelveticaErase:8,eDrawType_TextHelveticaEraseBold:9,eDrawType_:10,eDrawType_Green:11,eDrawType_Yellow:12,eDrawType_DarkGray:13,eDrawType_Inherit:9999,mDisplayLevel_1:1,mDisplayLevel_2:4,mDisplayLevel_3:8,mDisplayLevel_4:16,mDisplayLevel_5:32,mDisplayLevel_6:64,eNodeGroup_Common:0,eNodeGroup_Document:1,eNodeGroup_Trace:2,eTraceType_Boolean:0,eTraceType_Int32:1,eTraceType_Float32:2,eTraceType_User:3,eSave_Ctx:1,eSave_Array:2,eSave_NodeClass:3,eSave_ConClass:4,eSave_Rect:5,eSave_Line:6,eSave_Point:7,eSave_Arc:8,eSave_Text:9,eSave_Node:10,eSave_Con:11,eSave_ConPoint:12,eSave_Annot:13,eSave_Arrow:14,eSave_Pixmap:15,eSave_AnnotPixmap:16,eSave_Radiobutton:17,eSave_Frame:18,eSave_AnnotPixmapButton:19,eSave_Triangle:20,eSave_End:99,eSave_Ctx_zoom_factor:100,eSave_Ctx_base_zoom_factor:101,eSave_Ctx_offset_x:102,eSave_Ctx_offset_y:103,eSave_Ctx_nav_zoom_factor:104,eSave_Ctx_print_zoom_factor:105,eSave_Ctx_nav_offset_x:106,eSave_Ctx_nav_offset_y:107,eSave_Ctx_x_right:108,eSave_Ctx_x_left:109,eSave_Ctx_y_high:110,eSave_Ctx_y_low:111,eSave_Ctx_window_width:112,eSave_Ctx_window_height:113,eSave_Ctx_nav_window_width:114,eSave_Ctx_nav_window_height:115,eSave_Ctx_nav_rect_ll_x:116,eSave_Ctx_nav_rect_ll_y:117,eSave_Ctx_nav_rect_ur_x:118,eSave_Ctx_nav_rect_ur_y:119,eSave_Ctx_nav_rect_hot:120,eSave_Ctx_name:121,eSave_Ctx_user_highlight:122,eSave_Ctx_a_nc:123,eSave_Ctx_a_cc:124,eSave_Ctx_a:125,eSave_Ctx_grid_size_x:126,eSave_Ctx_grid_size_y:127,eSave_Ctx_grid_on:128,eSave_Ctx_draw_delta:129,eSave_Ctx_refcon_width:130,eSave_Ctx_refcon_height:131,eSave_Ctx_refcon_textsize:132,eSave_Ctx_refcon_linewidth:133,eSave_Ctx_user_version:134,eSave_Array_a:200,eSave_NodeClass_nc_name:300,eSave_NodeClass_a:301,eSave_NodeClass_group:302,eSave_NodeClass_no_con_obstacle:303,eSave_ConClass_cc_name:400,eSave_ConClass_con_type:401,eSave_ConClass_corner:402,eSave_ConClass_draw_type:403,eSave_ConClass_line_width:404,eSave_ConClass_arrow_width:405,eSave_ConClass_arrow_length:406,eSave_ConClass_round_corner_amount:407,eSave_ConClass_group:408,eSave_Rect_draw_type:500,eSave_Rect_line_width:501,eSave_Rect_ll:502,eSave_Rect_ur:503,eSave_Rect_display_level:504,eSave_Rect_fill:505,eSave_Line_draw_type:600,eSave_Line_line_width:601,eSave_Line_p1:602,eSave_Line_p2:603,eSave_Point_x:700,eSave_Point_y:701,eSave_Arc_angel1:800,eSave_Arc_angel2:801,eSave_Arc_draw_type:802,eSave_Arc_line_width:803,eSave_Arc_ll:804,eSave_Arc_ur:805,eSave_Text_text_size:900,eSave_Text_draw_type:901,eSave_Text_text:902,eSave_Text_p:903,eSave_Node_nc:1e3,eSave_Node_pos:1001,eSave_Node_n_name:1002,eSave_Node_annotsize:1003,eSave_Node_annotv:1004,eSave_Node_refcon_cnt:1005,eSave_Node_x_right:1006,eSave_Node_x_left:1007,eSave_Node_y_high:1008,eSave_Node_y_low:1009,eSave_Node_trace_object:1010,eSave_Node_trace_attribute:1011,eSave_Node_trace_attr_type:1012,eSave_Node_obst_x_right:1013,eSave_Node_obst_x_left:1014,eSave_Node_obst_y_high:1015,eSave_Node_obst_y_low:1016,eSave_Node_trace_inverted:1017,eSave_Con_x_right:1100,eSave_Con_x_left:1101,eSave_Con_y_high:1102,eSave_Con_y_low:1103,eSave_Con_cc:1104,eSave_Con_dest_node:1105,eSave_Con_source_node:1106,eSave_Con_dest_conpoint:1107,eSave_Con_source_conpoint:1108,eSave_Con_dest_direction:1109,eSave_Con_source_direction:1110,eSave_Con_line_a:1111,eSave_Con_arc_a:1112,eSave_Con_arrow_a:1113,eSave_Con_ref_a:1114,eSave_Con_p_num:1115,eSave_Con_l_num:1116,eSave_Con_a_num:1117,eSave_Con_arrow_num:1118,eSave_Con_ref_num:1119,eSave_Con_point_x:1120,eSave_Con_point_y:1121,eSave_Con_source_ref_cnt:1122,eSave_Con_dest_ref_cnt:1123,eSave_Con_c_name:1124,eSave_Con_trace_object:1125,eSave_Con_trace_attribute:1126,eSave_Con_trace_attr_type:1127,eSave_Con_temporary_ref:1128,eSave_ConPoint_number:1200,eSave_ConPoint_direction:1201,eSave_ConPoint_p:1202,eSave_ConPoint_trace_attribute:1203,eSave_ConPoint_trace_attr_type:1204,eSave_Annot_number:1300,eSave_Annot_draw_type:1301,eSave_Annot_text_size:1302,eSave_Annot_p:1303,eSave_Annot_annot_type:1304,eSave_Annot_display_level:1305,eSave_Arrow_arrow_width:1400,eSave_Arrow_arrow_length:1401,eSave_Arrow_draw_type:1402,eSave_Arrow_line_width:1403,eSave_Arrow_p_dest:1404,eSave_Arrow_p1:1405,eSave_Arrow_p2:1406,eSave_Triangle_rect_part:2e3};function GDraw(e){this.ctx=e,this.canvas=document.querySelector("canvas"),this.gctx=this.canvas.getContext("2d"),this.offset_top=this.canvas.offsetTop,this.offset_left=this.canvas.offsetTop,console.log("offset_top",this.offset_top,"offset_left",this.offset_left),this.rect=function(e,t,n,i){this.gctx.strokeRect(e,t,n,i)},this.line=function(e,t,n,i){this.gctx.beginPath(),this.gctx.moveTo(e,t),this.gctx.lineTo(n,i),this.gctx.stroke()}}function FlowArray(b){this.a=[],this.ctx=b,this.add=function(e){this.a.push(e)},this.size=function(){return this.a.length},this.get=function(e){return this.a[e]},this.open=function(e,t){var n,i=!1;for(n=t;n<e.length;n++){var a=e[n].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("array : "+e[n]),o){case Flow.eSave_Array:break;case Flow.eSave_NodeClass:var s=new FlowNodeClass(b);n=s.open(e,n+1),this.a.push(s);break;case Flow.eSave_ConClass:var r=new FlowConClass(b);n=r.open(e,n+1),this.a.push(r);break;case Flow.eSave_Node:var _=new FlowNode(b);n=_.open(e,n+1),this.a.push(_);break;case Flow.eSave_Con:var l=new FlowCon(b);n=l.open(e,n+1),this.a.push(l);break;case Flow.eSave_Rect:var h=new FlowRect(b);n=h.open(e,n+1),this.a.push(h);break;case Flow.eSave_Line:var c=new FlowLine(b);n=c.open(e,n+1),this.a.push(c);break;case Flow.eSave_Triangle:var d=new FlowTriangle(b);n=d.open(e,n+1),this.a.push(d);break;case Flow.eSave_Arc:var g=new FlowArc(b);n=g.open(e,n+1),this.a.push(g);break;case Flow.eSave_Text:var w=new FlowText(b);n=w.open(e,n+1),this.a.push(w);break;case Flow.eSave_ConPoint:var f=new FlowConPoint(b);n=f.open(e,n+1),this.a.push(f);break;case Flow.eSave_Annot:var v=new FlowAnnot(b);n=v.open(e,n+1),this.a.push(v);break;case Flow.eSave_Arrow:var p=new FlowArrow(b);n=p.open(e,n+1),this.a.push(p);break;case Flow.eSave_Point:var u=new FlowPoint(b);n=u.open(e,n+1),this.a.push(u);break;case Flow.eSave_End:i=!0;break;default:console.log("Syntax error in FlowArray",o)}if(i)break}return n},this.draw=function(e,t,n,i){for(var a=0;a<this.a.length;a++)this.a[a].draw(e,t,n,i)},this.search_by_name=function(e){for(var t=e.toUpperCase(),n=0;n<this.a.length;n++)if(this.a[n]instanceof FlowNode&&(console.log("Search",this.a[n].n_name,e),this.a[n].n_name.toUpperCase()==t))return this.a[n];return null}}function FlowNodeClass(e){this.a=new FlowArray(e),this.ctx=e,this.nc_name="",this.group=0,this.draw=function(e,t,n,i){this.a.draw(e,t,n,i)},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("nodeclass : "+e[i]),o){case Flow.eSave_NodeClass_nc_name:this.nc_name=a[1];break;case Flow.eSave_NodeClass_a:i=this.a.open(e,i+1);break;case Flow.eSave_NodeClass_group:this.group=parseInt(a[1]);break;case Flow.eSave_NodeClass_no_con_obstacle:break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowNodeClass")}if(n)break}return i},this.event_handler=function(e,t){return 0}}function FlowConClass(e){this.cc_name="",this.con_type=0,this.corner=0,this.draw_type=0,this.line_width=0,this.arrow_width=0,this.arrow_length=0,this.round_corner_amount=0,this.group=0,this.ctx=e,this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("conclass : "+e[i]),o){case Flow.eSave_ConClass:break;case Flow.eSave_ConClass_cc_name:this.cc_name=a[1];break;case Flow.eSave_ConClass_con_type:this.con_type=parseInt(a[1]);break;case Flow.eSave_ConClass_corner:this.corner=parseInt(a[1]);break;case Flow.eSave_ConClass_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_ConClass_line_width:this.line_width=parseInt(a[1]);break;case Flow.eSave_ConClass_arrow_width:this.arrow_width=parseFloat(a[1]);break;case Flow.eSave_ConClass_arrow_length:this.arrow_length=parseFloat(a[1]);break;case Flow.eSave_ConClass_round_corner_amount:this.round_corner_amount=parseFloat(a[1]);break;case Flow.eSave_ConClass_group:this.group=parseInt(a[1]);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowConClass")}if(n)break}return i}}function FlowPoint(e){this.x=0,this.y=0,this.ctx=e,this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("point : "+e[i]),o){case Flow.eSave_Point:break;case Flow.eSave_Point_x:this.x=parseFloat(a[1]);break;case Flow.eSave_Point_y:this.y=parseFloat(a[1]);break;case Flow.eSave_End:n=!0;break;default:System.out.println("Syntax error in FlowPoint")}if(n)break}return i}}function FlowLine(e){this.p1=new FlowPoint(e),this.p2=new FlowPoint(e),this.draw_type=0,this.line_width=0,this.ctx=e,this.draw=function(e,t,n,i){var a=(this.p1.x+t.x)*this.ctx.zoom_factor,o=(this.p1.y+t.y)*this.ctx.zoom_factor,s=(this.p2.x+t.x)*this.ctx.zoom_factor,r=(this.p2.y+t.y)*this.ctx.zoom_factor;switch(e.lineWidth=this.ctx.zoom_factor/this.ctx.base_zoom_factor*this.line_width,e.lineWidth<1&&(e.lineWidth=1),this.draw_type){case Flow.eDrawType_LineDashed:case Flow.eDrawType_LineDashedRed:e.setLineDash([8,8])}switch(this.draw_type){case Flow.eDrawType_LineGray:e.strokeStyle="lightgray";break;case Flow.eDrawType_LineRed:case Flow.eDrawType_LineDashedRed:e.strokeStyle="red";break;case Flow.eDrawType_LineErase:return;default:e.strokeStyle="black"}switch(i&&(e.strokeStyle="red"),e.beginPath(),e.moveTo(a,o),e.lineTo(s,r),e.stroke(),this.draw_type){case Flow.eDrawType_LineDashed:case Flow.eDrawType_LineDashedRed:e.setLineDash([])}},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("line : "+e[i]),o){case Flow.eSave_Line:break;case Flow.eSave_Line_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Line_line_width:this.line_width=parseInt(a[1]);break;case Flow.eSave_Line_p1:i=this.p1.open(e,i+1);break;case Flow.eSave_Line_p2:i=this.p2.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowLine")}if(n)break}return i}}function FlowRect(e){this.ll=new FlowPoint(e),this.ur=new FlowPoint(e),this.draw_type=0,this.line_width=0,this.display_level=0,this.fill=0,this.ctx=e,this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("rect : "+e[i]),o){case Flow.eSave_Rect:break;case Flow.eSave_Rect_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Rect_line_width:this.line_width=parseInt(a[1]);break;case Flow.eSave_Rect_display_level:this.display_level=parseInt(a[1]);break;case Flow.eSave_Rect_fill:this.fill=parseInt(a[1]);break;case Flow.eSave_Rect_ll:i=this.ll.open(e,i+1);break;case Flow.eSave_Rect_ur:i=this.ur.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowRect")}if(n)break}return i},this.draw=function(e,t,n,i){if(0!=(this.display_level&this.ctx.display_level)){var a=(this.ll.x+t.x)*this.ctx.zoom_factor,o=(this.ll.y+t.y)*this.ctx.zoom_factor,s=(this.ur.x-this.ll.x)*this.ctx.zoom_factor,r=(this.ur.y-this.ll.y)*this.ctx.zoom_factor;switch(e.lineWidth=this.ctx.zoom_factor/this.ctx.base_zoom_factor*this.line_width,e.lineWidth<1&&(e.lineWidth=1),this.draw_type){case Flow.eDrawType_LineGray:e.strokeStyle="grey";break;case Flow.eDrawType_LineRed:case Flow.eDrawType_LineDashedRed:e.strokeStyle="red";break;case Flow.eDrawType_LineErase:return;default:e.strokeStyle="black"}i&&(e.strokeStyle="red"),e.strokeRect(a,o,s,r)}}}function FlowArc(e){this.ll=new FlowPoint(e),this.ur=new FlowPoint(e),this.angel1=0,this.angel2=0,this.draw_type=0,this.line_width=0,this.ctx=e,this.draw=function(e,t,n,i){var a=(this.ur.x-this.ll.x)/2*this.ctx.zoom_factor,o=(this.ll.x+t.x)*this.ctx.zoom_factor+a,s=(this.ll.y+t.y)*this.ctx.zoom_factor+a;if(90==this.angel1||270==this.angel1)var r=(this.angel1+90)/180*Math.PI;else r=(this.angel1-90)/180*Math.PI;var _=r+this.angel2/180*Math.PI;e.lineWidth=this.ctx.zoom_factor/this.ctx.base_zoom_factor*this.line_width,e.lineWidth<1&&(e.lineWidth=1),e.strokeStyle="black",i&&(e.strokeStyle="red"),e.beginPath(),e.arc(o,s,a,r,_,!1),e.stroke()},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("arc : "+e[i]),o){case Flow.eSave_Arc:break;case Flow.eSave_Arc_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Arc_line_width:this.line_width=parseInt(a[1]);break;case Flow.eSave_Arc_angel1:this.angel1=parseFloat(a[1]);break;case Flow.eSave_Arc_angel2:this.angel2=parseFloat(a[1]);break;case Flow.eSave_Arc_ll:i=this.ll.open(e,i+1);break;case Flow.eSave_Arc_ur:i=this.ur.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowArc")}if(n)break}return i}}function FlowText(e){this.p=new FlowPoint(e),this.draw_type=0,this.text_size=0,this.text="",this.ctx=e,this.draw=function(e,t,n,i){var a=0,o=this.ctx.zoom_factor/this.ctx.base_zoom_factor*(this.text_size+4)-4;if(!(o<0)){var s=(this.p.x+t.x)*this.ctx.zoom_factor,r=(this.p.y+t.y)*this.ctx.zoom_factor;switch(o){case 0:a=8;break;case 1:a=10;break;case 2:a=12;break;case 3:case 4:a=14;break;case 5:a=8;break;case 6:case 7:a=18;break;default:a=3*o}e.font=a+"px Arial",e.lineWidth=.5,e.fillStyle="black",i&&(e.fillStyle="red"),e.fillText(this.text,s,r)}},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("text : "+e[i]),o){case Flow.eSave_Text:break;case Flow.eSave_Text_text_size:this.text_size=parseInt(a[1]);break;case Flow.eSave_Text_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Text_text:this.text=a[1];break;case Flow.eSave_Text_p:i=this.p.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowText")}if(n)break}return i}}function FlowArrow(e){this.p1=new FlowPoint(e),this.p2=new FlowPoint(e),this.p_dest=new FlowPoint(e),this.arrow_width=0,this.arrow_length=0,this.draw_type=0,this.line_width=0,this.ctx=e,this.draw=function(e,t,n,i){var a=(this.p1.x+t.x)*this.ctx.zoom_factor,o=(this.p2.x+t.x)*this.ctx.zoom_factor,s=(this.p_dest.x+t.x)*this.ctx.zoom_factor,r=(this.p1.y+t.y)*this.ctx.zoom_factor,_=(this.p2.y+t.y)*this.ctx.zoom_factor,l=(this.p_dest.y+t.y)*this.ctx.zoom_factor;switch(this.draw_type){case Flow.eDrawType_LineGray:e.fillStyle="lightgray";break;case Flow.eDrawType_LineRed:case Flow.eDrawType_LineDashedRed:e.fillStyle="red";break;case Flow.eDrawType_LineErase:return;default:e.fillStyle="black"}i&&(e.fillStyle="red"),e.beginPath(),e.moveTo(a,r),e.lineTo(o,_),e.lineTo(s,l),e.lineTo(a,r),e.fill()},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("arrow : "+e[i]),o){case Flow.eSave_Arrow:break;case Flow.eSave_Arrow_arrow_width:this.arrow_width=parseFloat(a[1]);break;case Flow.eSave_Arrow_arrow_length:this.arrow_length=parseFloat(a[1]);break;case Flow.eSave_Arrow_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Arrow_line_width:this.line_width=parseInt(a[1]);break;case Flow.eSave_Arrow_p_dest:i=this.p_dest.open(e,i+1);break;case Flow.eSave_Arrow_p1:i=this.p1.open(e,i+1);break;case Flow.eSave_Arrow_p2:i=this.p2.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowArrow")}if(n)break}}}function FlowTriangle(e){this.prototype=new FlowRect(e),this.draw=function(e,t,n,i){var a=(this.prototype.ll.x+t.x)*this.prototype.ctx.zoom_factor,o=(this.prototype.ll.y+t.y)*this.prototype.ctx.zoom_factor,s=(this.prototype.ur.x+t.x)*this.prototype.ctx.zoom_factor,r=(this.prototype.ur.y+t.y)*this.prototype.ctx.zoom_factor;e.lineWidth=this.prototype.ctx.zoom_factor/this.prototype.ctx.base_zoom_factor*this.prototype.line_width,e.lineWidth<1&&(e.lineWidth=1);var _=this.prototype.draw_type;if(_==Flow.eDrawType_Inherit&&null!=n&&(_=n.fill_color),1==this.prototype.fill){switch(_){case Flow.eDrawType_LineRed:e.fillStyle="red";break;case Flow.eDrawType_Green:e.fillStyle="green";break;case Flow.eDrawType_Yellow:e.fillStyle="yellow";break;default:e.fillStyle="gray"}e.beginPath(),e.moveTo(a,r),e.lineTo((a+s)/2,o),e.lineTo(s,r),e.lineTo(a,r),e.fill()}else e.strokeStyle="black",e.beginPath(),e.moveTo(a,r),e.lineTo((a+s)/2,o),e.lineTo(s,r),e.lineTo(a,r),e.stroke()},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.prototype.ctx.debug&&console.log("triangle : "+e[i]),o){case Flow.eSave_Triangle_rect_part:i=this.prototype.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowTriangle")}if(n)break}return i}}function FlowConPoint(s){this.p=new FlowPoint(s),this.number=0,this.direction=0,this.trace_attribute="",this.trace_attr_type=0,this.ctx=s,this.draw=function(e,t,n,i){},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(s.debug&&console.log("conpoint : "+e[i]),o){case Flow.eSave_ConPoint:break;case Flow.eSave_ConPoint_number:this.number=parseInt(a[1]);break;case Flow.eSave_ConPoint_direction:this.direction=parseInt(a[1]);break;case Flow.eSave_ConPoint_p:i=this.p.open(e,i+1);break;case Flow.eSave_ConPoint_trace_attribute:this.trace_attribute=a[1];break;case Flow.eSave_ConPoint_trace_attr_type:this.trace_attr_type=parseInt(a[1]);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowConPoint")}if(n)break}return i}}function FlowAnnot(e){this.p=new FlowPoint(e),this.draw_type=0,this.text_size=0,this.display_level=0,this.annot_type=0,this.number=0,this.ctx=e,this.draw=function(e,t,n,i){if(null!=n&&null!=n.annotv[this.number]&&0!=(this.display_level&this.ctx.display_level)){var a=0,o=this.ctx.zoom_factor/this.ctx.base_zoom_factor*(this.text_size+4)-4;if(!(o<0)){switch(o){case 0:a=8;break;case 1:a=10;break;case 2:a=12;break;case 3:case 4:a=14;break;case 5:case 6:case 7:a=18;break;default:a=3*o}switch(this.draw_type){case Flow.eDrawType_TextHelveticaBold:e.font="bold "+a+"px Arial";break;default:e.font=a+"px Arial"}e.fillStyle="black",i&&(e.fillStyle="red"),e.lineWidth=.5;for(var s=(this.p.x+t.x)*this.ctx.zoom_factor,r=(this.p.y+t.y)*this.ctx.zoom_factor-a/4,_=n.annotv[this.number].split("\n"),l=0;l<_.length;l++)e.fillText(_[l],s,r),r+=1.4*a}}},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("annot : "+e[i]),o){case Flow.eSave_Annot:break;case Flow.eSave_Annot_number:this.number=parseInt(a[1]);break;case Flow.eSave_Annot_draw_type:this.draw_type=parseInt(a[1]);break;case Flow.eSave_Annot_text_size:this.text_size=parseInt(a[1]);break;case Flow.eSave_Annot_display_level:this.display_level=parseInt(a[1]);break;case Flow.eSave_Annot_p:i=this.p.open(e,i+1);break;case Flow.eSave_Annot_annot_type:this.annot_type=parseInt(a[1]);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowAnnot")}if(n)break}return i}}function FlowCon(o){this.ctx=o,this.x_right=0,this.x_left=0,this.y_high=0,this.y_low=0,this.cc=null,this.p_num=0,this.l_num=0,this.a_num=0,this.arrow_num=0,this.ref_num=0,this.point_x=new FlowArray(o),this.point_y=new FlowArray(o),this.line_a=new FlowArray(o),this.arc_a=new FlowArray(o),this.arrow_a=new FlowArray(o),this.ref_a=new FlowArray(o),this.c_name="",this.trace_object="",this.trace_attribute="",this.trace_attr_type=0,this.temporary_ref=0,this.highlight=!1,this.redraw=!0,this.draw=function(e,t,n,i){if(this.redraw){var a=new FlowPoint(o);a.x=0,(a.y=0)!=this.temporary_ref||this.cc.con_type==Flow.eConType_Reference?this.ref_a.draw(e,a,null,i):(this.line_a.draw(e,a,null,i),this.arc_a.draw(e,a,null,i),this.arrow_a.draw(e,a,null,i)),this.redraw=!1}},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("con : "+e[i]),o){case Flow.eSave_Con:break;case Flow.eSave_Con_cc:for(var s=a[1],r=!1,_=0;_<this.ctx.a_cc.size();_++)if(this.ctx.a_cc.get(_).cc_name===s){this.cc=this.ctx.a_cc.get(_),r=!0;break}r||console.log("FlowCon: ConClass not found: "+s);break;case Flow.eSave_Con_c_name:null!=a[1]&&(this.c_name=a[1]);break;case Flow.eSave_Con_x_right:this.x_right=parseFloat(a[1]);break;case Flow.eSave_Con_x_left:this.x_left=parseFloat(a[1]);break;case Flow.eSave_Con_y_high:this.y_high=parseFloat(a[1]);break;case Flow.eSave_Con_y_low:this.y_low=parseFloat(a[1]);break;case Flow.eSave_Con_dest_node:case Flow.eSave_Con_source_node:i++;break;case Flow.eSave_Con_dest_conpoint:case Flow.eSave_Con_source_conpoint:case Flow.eSave_Con_dest_direction:case Flow.eSave_Con_source_direction:break;case Flow.eSave_Con_line_a:i=this.line_a.open(e,i+1);break;case Flow.eSave_Con_arc_a:i=this.arc_a.open(e,i+1);break;case Flow.eSave_Con_arrow_a:i=this.arrow_a.open(e,i+1);break;case Flow.eSave_Con_ref_a:i=this.ref_a.open(e,i+1);break;case Flow.eSave_Con_p_num:this.p_num=parseInt(a[1]);break;case Flow.eSave_Con_l_num:this.l_num=parseInt(a[1]);break;case Flow.eSave_Con_a_num:this.a_num=parseInt(a[1]);break;case Flow.eSave_Con_arrow_num:this.arrow_num=parseInt(a[1]);break;case Flow.eSave_Con_ref_num:this.ref_num=parseInt(a[1]);break;case Flow.eSave_Con_point_x:for(_=0;_<this.p_num;_++)i++,this.point_x[_]=parseFloat(e[i]);break;case Flow.eSave_Con_point_y:for(_=0;_<this.p_num;_++)i++,this.point_y[_]=parseFloat(e[i]);break;case Flow.eSave_Con_source_ref_cnt:case Flow.eSave_Con_dest_ref_cnt:break;case Flow.eSave_Con_trace_object:null!=a[1]&&(this.trace_object=a[1]);break;case Flow.eSave_Con_trace_attribute:null!=a[1]&&(this.trace_attribute=a[1]);break;case Flow.eSave_Con_trace_attr_type:this.trace_attr_type=parseInt(a[1]);break;case Flow.eSave_Con_temporary_ref:this.temporary_ref=parseInt(a[1]);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowCon")}if(n)break}return i},this.connect=function(){},this.scan=function(){}}function FlowNode(a){this.ctx=a,this.OFFSET=2,this.x_right=0,this.x_left=0,this.y_high=0,this.y_low=0,this.nc=null,this.pos=new FlowPoint(a),this.n_name="",this.annotv=[],this.annotsize=[],this.trace_object="",this.trace_attribute="",this.trace_attr_type=0,this.highlight=!1,this.select=!1,this.fill_color=0,this.p=0,this.old_value=0,this.first_scan=!0,this.redraw=!0,this.draw=function(e,t,n,i){if(this.redraw){if(this.nc.group!=Flow.eNodeGroup_Document){var a=this.x_left*this.ctx.zoom_factor,o=this.y_low*this.ctx.zoom_factor-1,s=(this.x_right-this.x_left)*this.ctx.zoom_factor,r=(this.y_high-this.y_low)*this.ctx.zoom_factor+2;e.fillStyle="white",this.select&&(e.fillStyle="lightblue"),e.fillRect(a,o,s,r)}this.nc.draw(e,this.pos,this,this.highlight),this.redraw=!1}},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.ctx.debug&&console.log("node : "+e[i]),o){case Flow.eSave_Node_nc:for(var s=a[1],r=!1,_=0;_<this.ctx.a_nc.size();_++)if(this.ctx.a_nc.get(_).nc_name===s){this.nc=this.ctx.a_nc.get(_),r=!0;break}r||console.log("FlowNode: NodeClass not found: "+s);break;case Flow.eSave_Node_n_name:null!=a[1]&&(this.n_name=a[1]);break;case Flow.eSave_Node_refcon_cnt:i+=32;break;case Flow.eSave_Node_x_right:this.x_right=parseFloat(a[1]);break;case Flow.eSave_Node_x_left:this.x_left=parseFloat(a[1]);break;case Flow.eSave_Node_y_high:this.y_high=parseFloat(a[1]);break;case Flow.eSave_Node_y_low:this.y_low=parseFloat(a[1]);break;case Flow.eSave_Node_annotsize:for(_=0;_<10;_++)i++,this.annotsize[_]=parseInt(e[i]);break;case Flow.eSave_Node_annotv:for(_=0;_<10;_++)if(0<this.annotsize[_]){for(var l,h=[],c=0,d=!1,g=!0;;)if(null!=e[++i]){for(var w=0;w<e[i].length;w++)if(l=c,c=e[i].charAt(w),g)g=!1;else if('"'!==c||"\\"!==l){if('"'===c){d=!0;break}h.push(c),w==e[i].length-1&&h.push("\n")}else h[h.length-1]=null;if(d)break}else h.push("\n");this.annotv[_]=h.join("")}break;case Flow.eSave_Node_pos:i=this.pos.open(e,i+1);break;case Flow.eSave_Node_trace_object:null!=a[1]&&(this.trace_object=a[1]);break;case Flow.eSave_Node_trace_attribute:null!=a[1]&&(this.trace_attribute=a[1]);break;case Flow.eSave_Node_trace_attr_type:this.trace_attr_type=parseInt(a[1]);break;case Flow.eSave_Node_obst_x_right:case Flow.eSave_Node_obst_x_left:case Flow.eSave_Node_obst_y_high:case Flow.eSave_Node_obst_y_low:case Flow.eSave_Node_trace_inverted:break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowNode")}if(n)break}return console.log("Node",this.trace_attr_type,this.n_name),i},this.connect=function(){if(""!=this.trace_object&&""!=this.trace_attribute&&this.trace_attr_type!=Flow.eTraceType_User){var e=this.trace_attribute.indexOf("#");-1!=e&&(this.trace_attribute=this.trace_attribute.substring(0,e));var t,n=this.trace_object+"."+this.trace_attribute;switch(this.trace_attr_type){case Flow.eTraceType_Boolean:t=Pwr.eType_Boolean;break;case Flow.eTraceType_Int32:t=Pwr.eType_Int32;break;case Flow.eTraceType_Float32:t=Pwr.eType_Float32;break;case Flow.eTraceType_User:return}this.p=this.ctx.gdh.refObjectInfo(n,t,1),console.log("connecting",n,this.p)}},this.scan=function(){if(0!=this.p){var e=this.ctx.gdh.getObjectRefInfo(this.p);if(this.first_scan)this.first_scan=!1;else if(e==this.old_value)return;this.highlight=!!e,this.old_value=e,this.redraw=!0}},this.event_handler=function(e,t){var n=e/this.ctx.zoom_factor+a.x_left,i=t/this.ctx.zoom_factor+a.y_low;return n>=this.x_left&&n<=this.x_right&&i>=this.y_low&&i<=this.y_high?(console.log("Hit in node"),this.select?(this.select=!1,this.redraw=!0):(this.ctx.set_select(!1),this.set_select(!0)),console.log("Hit in",this.n_name),1):0},this.set_select=function(e){e!=this.select&&(this.select=e,this.redraw=!0,this.select?this.ctx.select_object=this:this.ctx.select_object=null)}}function FlowCtx(){this.display_level=Flow.mDisplayLevel_1,this.gdh=0,this.debug=!1,this.zoom_factor=20,this.base_zoom_factor=20,this.offset_x=0,this.offset_y=0,this.x_right=0,this.x_left=0,this.y_high=0,this.y_low=0,this.a=new FlowArray(this),this.a_nc=new FlowArray(this),this.a_cc=new FlowArray(this),this.name="Claes context",this.gdraw=new GDraw(this),this.select_object=null,this.draw=function(){this.a.draw(this.gdraw.gctx,null,null,!1)},this.open=function(e,t){for(var n=!1,i=t;i<e.length;i++){var a=e[i].split(" "),o=parseInt(a[0]);switch(this.debug&&console.log("ctx : "+e[i]),o){case Flow.eSave_Ctx:break;case Flow.eSave_Ctx_zoom_factor:this.zoom_factor=parseFloat(a[1]);break;case Flow.eSave_Ctx_base_zoom_factor:this.base_zoom_factor=parseFloat(a[1]);break;case Flow.eSave_Ctx_offset_x:this.offset_x=parseInt(a[1]);break;case Flow.eSave_Ctx_offset_y:this.offset_y=parseInt(a[1]);break;case Flow.eSave_Ctx_nav_zoom_factor:case Flow.eSave_Ctx_print_zoom_factor:case Flow.eSave_Ctx_nav_offset_x:case Flow.eSave_Ctx_nav_offset_y:break;case Flow.eSave_Ctx_x_right:this.x_right=parseFloat(a[1]);break;case Flow.eSave_Ctx_x_left:this.x_left=parseFloat(a[1]);break;case Flow.eSave_Ctx_y_high:this.y_high=parseFloat(a[1]);break;case Flow.eSave_Ctx_y_low:this.y_low=parseFloat(a[1]);break;case Flow.eSave_Ctx_nav_rect_ll_x:case Flow.eSave_Ctx_nav_rect_ll_y:case Flow.eSave_Ctx_nav_rect_ur_x:case Flow.eSave_Ctx_nav_rect_ur_y:case Flow.eSave_Ctx_nav_rect_hot:break;case Flow.eSave_Ctx_name:this.name=a[1];break;case Flow.eSave_Ctx_user_highlight:case Flow.eSave_Ctx_grid_size_x:case Flow.eSave_Ctx_grid_size_y:case Flow.eSave_Ctx_grid_on:case Flow.eSave_Ctx_draw_delta:case Flow.eSave_Ctx_refcon_width:case Flow.eSave_Ctx_refcon_height:case Flow.eSave_Ctx_refcon_textsize:case Flow.eSave_Ctx_refcon_linewidth:case Flow.eSave_Ctx_user_version:break;case Flow.eSave_Ctx_a_nc:i=this.a_nc.open(e,i+1);break;case Flow.eSave_Ctx_a_cc:i=this.a_cc.open(e,i+1);break;case Flow.eSave_Ctx_a:i=this.a.open(e,i+1);break;case Flow.eSave_End:n=!0;break;default:console.log("Syntax error in FlowCtx",o)}if(n)break}return i},this.connect=function(){console.log("ctx connect",this.a.size());for(var e=0;e<this.a.size();e++)this.a.get(e).connect()},this.scan=function(){for(var e=0;e<this.a.size();e++)this.a.get(e).scan()},this.event_handler=function(e,t){for(var n=0,i=0;i<this.a.size()&&!(this.a.get(i)instanceof FlowNode&&1==(n=this.a.get(i).event_handler(e,t)));i++);1==n&&this.draw()},this.set_select=function(e){for(var t=0;t<this.a.size();t++)this.a.get(t)instanceof FlowNode&&this.a.get(t).set_select(e)},this.search_object=function(e){console.log("Searching for ",e);var t=this.a.search_by_name(e);return null!=t&&console.log("Found",e),t},this.center_object=function(e){console.log("center_object",e.pos.x*this.zoom_factor+this.offset_x,window.innerWidth,e.pos.x*this.zoom_factor+this.offset_x-window.innerWidth/2),console.log("center_object",e.pos.y*this.zoom_factor+this.offset_y,window.innerHeight,e.pos.y*this.zoom_factor+this.offset_y-window.innerHeight/2),window.scrollTo(e.pos.x*this.zoom_factor+this.offset_x-window.innerWidth/2,e.pos.y*this.zoom_factor+this.offset_y-window.innerHeight/2+this.gdraw.offset_top)}}function FlowFrame(){var i=this;this.ctx=new FlowCtx,this.timer=null,console.log("ctx: ",this.ctx),this.vars_object=null,this.readFlowWeb=function(e,t){var n=window.location.href.lastIndexOf("/"),i=window.location.href.substring(0,n+1);i+=e,console.log("Target: ",i);var a=new XMLHttpRequest;a.read_cb=t,a.open("GET",i,!0),a.addEventListener("load",function(){console.log("Done:",a.status);var e=a.responseText.split("\n");a.read_cb(e,0)}),a.send(null)},this.read_func=function(e,t){if(console.log("this.ctx:",i.ctx),i.ctx.open(e,t),i.ctx.gdraw.canvas.addEventListener("click",function(e){var t=e.pageY-i.ctx.gdraw.offset_top,n=e.pageX-10;console.log("Click",n,t),i.ctx.event_handler(n,t)}),document.getElementById("toolitem1").addEventListener("click",function(e){console.log("toolitem3 event")}),document.getElementById("toolitem2").addEventListener("click",function(e){console.log("toolitem1 event, storage"),console.log("storage",localStorage.getItem("XttMethodNavigator")),null!=i.ctx.select_object&&localStorage.setItem("XttMethodNavigator",i.ctx.select_object.trace_object),console.log("storage",localStorage.getItem("XttMethodNavigator")),console.log("toolitem2 event window",window.opener),window.opener.focus()}),document.getElementById("toolitem3").addEventListener("click",function(e){}),document.getElementById("toolitem4").addEventListener("click",function(e){}),i.ctx.gdraw.canvas.width=(i.ctx.x_right-i.ctx.x_left)*i.ctx.zoom_factor,i.ctx.gdraw.canvas.height=(i.ctx.y_high-i.ctx.y_low)*i.ctx.zoom_factor,i.ctx.gdraw.gctx.translate(-i.ctx.x_left*i.ctx.zoom_factor,-i.ctx.y_low*i.ctx.zoom_factor),i.ctx.offset_x-=i.ctx.x_left*i.ctx.zoom_factor,i.ctx.offset_y-=i.ctx.y_low*i.ctx.zoom_factor,i.ctx.draw(),console.log("New Gdh"),i.ctx.gdh=new Gdh(i.flow_open),i.ctx.gdh.open_cb=i.flow_open,i.ctx.gdh.close_cb=i.flow_close,console.log("ctx.gdh",i.ctx.gdh),i.ctx.gdh.init(),null!=i.vars_object){var n=i.ctx.search_object(i.vars_object);null!=n&&(i.ctx.center_object(n),i.ctx.set_select(!1),n.set_select(!0))}},this.flow_open=function(){console.log("flow_open"),console.log("ctx.gdh",i.ctx.gdh),i.ctx.connect(),i.ctx.gdh.refObjectInfoList(i.ctx.gdh.refObjectInfoListReply),i.timer=setTimeout(i.flow_cyclic,1e3)},this.flow_scan=function(){i.ctx.scan()},this.flow_cyclic=function(){i.ctx.gdh.getRefObjectInfoAll(i.flow_scan),i.ctx.draw(),i.timer=setTimeout(i.flow_cyclic,1e3)},this.flow_close=function(){for(var e in console.log("Close function",i.timer),clearTimeout(i.timer),i.ctx.gdh.pending)delete i.ctx.gdh.pending[e]},this.get_filename=function(){var e=window.location.search.substring(1);console.log("query",e);var t=e.split("&");console.log("vars",t.length,t[0].substring(4),t[1].substring(4));var n=parseInt(t[0].substring(4)),i=parseInt(t[1].substring(4)),a=[],o=[];a[0]=255&n,a[1]=n>>8&255,a[2]=n>>16&255,a[3]=n>>24&255;for(var s=0;s<4;s++){o[s]=a[s].toString();for(var r=0;r<3;r++)o[s].length<3&&(o[s]="0"+o[s])}var _=i.toString(16);for(r=0;r<8;r++)_.length<8&&(_="0"+_);var l="pwr_"+o[3]+"_"+o[2]+"_"+o[1]+"_"+o[0]+"_"+_+".flw";return console.log(l),2<t.length&&(this.vars_object=t[2].substring(4),console.log("vars object: ",this.vars_object)),l}}var frame=new FlowFrame;frame.readFlowWeb(frame.get_filename(),frame.read_func),console.log("eSave",Flow.eSave_Ctx);