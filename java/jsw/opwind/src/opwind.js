"use strict";function JopCrypt(){this.ITERATIONS=16,this.con_salt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,0,0,0,0,0],this.shifts2=[!1,!1,!0,!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],this.skb=[[0,16,536870912,536870928,65536,65552,536936448,536936464,2048,2064,536872960,536872976,67584,67600,536938496,536938512,32,48,536870944,536870960,65568,65584,536936480,536936496,2080,2096,536872992,536873008,67616,67632,536938528,536938544,524288,524304,537395200,537395216,589824,589840,537460736,537460752,526336,526352,537397248,537397264,591872,591888,537462784,537462800,524320,524336,537395232,537395248,589856,589872,537460768,537460784,526368,526384,537397280,537397296,591904,591920,537462816,537462832],[0,33554432,8192,33562624,2097152,35651584,2105344,35659776,4,33554436,8196,33562628,2097156,35651588,2105348,35659780,1024,33555456,9216,33563648,2098176,35652608,2106368,35660800,1028,33555460,9220,33563652,2098180,35652612,2106372,35660804,268435456,301989888,268443648,301998080,270532608,304087040,270540800,304095232,268435460,301989892,268443652,301998084,270532612,304087044,270540804,304095236,268436480,301990912,268444672,301999104,270533632,304088064,270541824,304096256,268436484,301990916,268444676,301999108,270533636,304088068,270541828,304096260],[0,1,262144,262145,16777216,16777217,17039360,17039361,2,3,262146,262147,16777218,16777219,17039362,17039363,512,513,262656,262657,16777728,16777729,17039872,17039873,514,515,262658,262659,16777730,16777731,17039874,17039875,134217728,134217729,134479872,134479873,150994944,150994945,151257088,151257089,134217730,134217731,134479874,134479875,150994946,150994947,151257090,151257091,134218240,134218241,134480384,134480385,150995456,150995457,151257600,151257601,134218242,134218243,134480386,134480387,150995458,150995459,151257602,151257603],[0,1048576,256,1048832,8,1048584,264,1048840,4096,1052672,4352,1052928,4104,1052680,4360,1052936,67108864,68157440,67109120,68157696,67108872,68157448,67109128,68157704,67112960,68161536,67113216,68161792,67112968,68161544,67113224,68161800,131072,1179648,131328,1179904,131080,1179656,131336,1179912,135168,1183744,135424,1184e3,135176,1183752,135432,1184008,67239936,68288512,67240192,68288768,67239944,68288520,67240200,68288776,67244032,68292608,67244288,68292864,67244040,68292616,67244296,68292872],[0,268435456,65536,268500992,4,268435460,65540,268500996,536870912,805306368,536936448,805371904,536870916,805306372,536936452,805371908,1048576,269484032,1114112,269549568,1048580,269484036,1114116,269549572,537919488,806354944,537985024,806420480,537919492,806354948,537985028,806420484,4096,268439552,69632,268505088,4100,268439556,69636,268505092,536875008,805310464,536940544,805376e3,536875012,805310468,536940548,805376004,1052672,269488128,1118208,269553664,1052676,269488132,1118212,269553668,537923584,806359040,537989120,806424576,537923588,806359044,537989124,806424580],[0,134217728,8,134217736,1024,134218752,1032,134218760,131072,134348800,131080,134348808,132096,134349824,132104,134349832,1,134217729,9,134217737,1025,134218753,1033,134218761,131073,134348801,131081,134348809,132097,134349825,132105,134349833,33554432,167772160,33554440,167772168,33555456,167773184,33555464,167773192,33685504,167903232,33685512,167903240,33686528,167904256,33686536,167904264,33554433,167772161,33554441,167772169,33555457,167773185,33555465,167773193,33685505,167903233,33685513,167903241,33686529,167904257,33686537,167904265],[0,256,524288,524544,16777216,16777472,17301504,17301760,16,272,524304,524560,16777232,16777488,17301520,17301776,2097152,2097408,2621440,2621696,18874368,18874624,19398656,19398912,2097168,2097424,2621456,2621712,18874384,18874640,19398672,19398928,512,768,524800,525056,16777728,16777984,17302016,17302272,528,784,524816,525072,16777744,16778e3,17302032,17302288,2097664,2097920,2621952,2622208,18874880,18875136,19399168,19399424,2097680,2097936,2621968,2622224,18874896,18875152,19399184,19399440],[0,67108864,262144,67371008,2,67108866,262146,67371010,8192,67117056,270336,67379200,8194,67117058,270338,67379202,32,67108896,262176,67371040,34,67108898,262178,67371042,8224,67117088,270368,67379232,8226,67117090,270370,67379234,2048,67110912,264192,67373056,2050,67110914,264194,67373058,10240,67119104,272384,67381248,10242,67119106,272386,67381250,2080,67110944,264224,67373088,2082,67110946,264226,67373090,10272,67119136,272416,67381280,10274,67119138,272418,67381282]],this.SPtrans=[[8520192,131072,2155872256,2156003840,8388608,2147615232,2147614720,2155872256,2147615232,8520192,8519680,2147484160,2155872768,8388608,0,2147614720,131072,2147483648,8389120,131584,2156003840,8519680,2147484160,8389120,2147483648,512,131584,2156003328,512,2155872768,2156003328,0,0,2156003840,8389120,2147614720,8520192,131072,2147484160,8389120,2156003328,512,131584,2155872256,2147615232,2147483648,2155872256,8519680,2156003840,131584,8519680,2155872768,8388608,2147484160,2147614720,0,131072,8388608,2155872768,8520192,2147483648,2156003328,512,2147615232],[268705796,0,270336,268697600,268435460,8196,268443648,270336,8192,268697604,4,268443648,262148,268705792,268697600,4,262144,268443652,268697604,8192,270340,268435456,0,262148,268443652,270340,268705792,268435460,268435456,262144,8196,268705796,262148,268705792,268443648,270340,268705796,262148,268435460,0,268435456,8196,262144,268697604,8192,268435456,270340,268443652,268705792,8192,0,268435460,4,268705796,270336,268697600,268697604,262144,8196,268443648,268443652,4,268697600,270336],[1090519040,16842816,64,1090519104,1073807360,16777216,1090519104,65600,16777280,65536,16842752,1073741824,1090584640,1073741888,1073741824,1090584576,0,1073807360,16842816,64,1073741888,1090584640,65536,1090519040,1090584576,16777280,1073807424,16842752,65600,0,16777216,1073807424,16842816,64,1073741824,65536,1073741888,1073807360,16842752,1090519104,0,16842816,65600,1090584576,1073807360,16777216,1090584640,1073741824,1073807424,1090519040,16777216,1090584640,65536,16777280,1090519104,65600,16777280,0,1090584576,1073741888,1090519040,1073807424,64,16842752],[1049602,67109888,2,68158466,0,68157440,67109890,1048578,68158464,67108866,67108864,1026,67108866,1049602,1048576,67108864,68157442,1049600,1024,2,1049600,67109890,68157440,1024,1026,0,1048578,68158464,67109888,68157442,68158466,1048576,68157442,1026,1048576,67108866,1049600,67109888,2,68157440,67109890,0,1024,1048578,0,68157442,68158464,1024,67108864,68158466,1049602,1048576,68158466,2,67109888,1049602,1048578,1049600,68157440,67109890,1026,67108864,67108866,68158464],[33554432,16384,256,33571080,33570824,33554688,16648,33570816,16384,8,33554440,16640,33554696,33570824,33571072,0,16640,33554432,16392,264,33554688,16648,0,33554440,8,33554696,33571080,16392,33570816,256,264,33571072,33571072,33554696,16392,33570816,16384,8,33554440,33554688,33554432,16640,33571080,0,16648,33554432,256,16392,33554696,256,0,33571080,33570824,33571072,264,16384,16640,33570824,33554688,264,8,16648,33570816,33554440],[536870928,524304,0,537397248,524304,2048,536872976,524288,2064,537397264,526336,536870912,536872960,536870928,537395200,526352,524288,536872976,537395216,0,2048,16,537397248,537395216,537397264,537395200,536870912,2064,16,526336,526352,536872960,2064,536870912,536872960,526352,537397248,524304,0,536872960,536870912,2048,537395216,524288,524304,537397264,526336,16,537397264,526336,524288,536872976,536870928,537395200,526352,0,2048,536870928,536872976,537397248,537395200,2064,16,537395216],[4096,128,4194432,4194305,4198529,4097,4224,0,4194304,4194433,129,4198400,1,4198528,4198400,129,4194433,4096,4097,4198529,0,4194432,4194305,4224,4198401,4225,4198528,1,4225,4198401,128,4194304,4225,4198400,4198401,129,4096,128,4194304,4198401,4194433,4225,4224,0,128,4194305,1,4194432,0,4194433,4194432,4224,129,4096,4198529,4194304,4198528,1,4097,4198529,4194305,4198528,4198400,4097],[136314912,136347648,32800,0,134250496,2097184,136314880,136347680,32,134217728,2129920,32800,2129952,134250528,134217760,136314880,32768,2129952,2097184,134250496,136347680,134217760,0,2129920,134217728,2097152,134250528,136314912,2097152,32768,136347648,32,2097152,32768,134217760,136347680,32800,134217728,0,2129920,136314912,134250528,134250496,2097184,136347648,32,2097184,134250496,136347680,2097152,136314880,134217760,2129920,32800,134250528,136314880,32,136347648,2129952,0,134217728,136314912,32768,2129952]],this.cov_2char=[46,47,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122],this.byteToUnsigned=function(e){var t=Math.floor(e);return 0<=t?t:t+256},this.fourBytesToInt=function(e,t){var n;return n=this.byteToUnsigned(e[t++]),n|=this.byteToUnsigned(e[t++])<<8,n|=this.byteToUnsigned(e[t++])<<16,n|=this.byteToUnsigned(e[t++])<<24},this.intToFourBytes=function(e,t,n){t[n++]=255&e,t[n++]=e>>>8&255,t[n++]=e>>>16&255,t[n++]=e>>>24&255},this.PERM_OP=function(e,t,n,i,s){var o;e^=(o=(e>>>n^t)&i)<<n,t^=o,s[0]=e,s[1]=t},this.HPERM_OP=function(e,t,n){var i;return e=e^(i=(e<<16-t^e)&n)^i>>>16-t},this.des_set_key=function(e){var t,n,i=new Array(2*this.ITERATIONS),s=this.fourBytesToInt(e,0),o=this.fourBytesToInt(e,4),r=new Array(2);this.PERM_OP(o,s,4,252645135,r),o=r[0],s=r[1],s=this.HPERM_OP(s,-2,3435921408),o=this.HPERM_OP(o,-2,3435921408),this.PERM_OP(o,s,1,1431655765,r),o=r[0],s=r[1],this.PERM_OP(s,o,8,16711935,r),s=r[0],o=r[1],this.PERM_OP(o,s,1,1431655765,r),o=(255&(o=r[0]))<<16|65280&o|(16711680&o)>>>16|(4026531840&(s=r[1]))>>>4,s&=268435455;for(var d=0,h=0;h<this.ITERATIONS;h++)o=this.shifts2[h]?(s=s>>>2|s<<26,o>>>2|o<<26):(s=s>>>1|s<<27,o>>>1|o<<27),s&=268435455,o&=268435455,t=this.skb[0][63&s]|this.skb[1][s>>>6&3|s>>>7&60]|this.skb[2][s>>>13&15|s>>>14&48]|this.skb[3][s>>>20&1|s>>>21&6|s>>>22&56],n=this.skb[4][63&o]|this.skb[5][o>>>7&3|o>>>8&60]|this.skb[6][o>>>15&63]|this.skb[7][o>>>21&15|o>>>22&48],i[d++]=4294967295&(n<<16|65535&t),t=(t=t>>>16|4294901760&n)<<4|t>>>28,i[d++]=4294967295&t;return i},this.D_ENCRYPT=function(e,t,n,i,s,o){var r,d,h;return d=(h=t^t>>>16)&i,h&=s,d=d^d<<16^t^o[n],r=(r=h^h<<16^t^o[n+1])>>>4|r<<28,e^=this.SPtrans[1][63&r]|this.SPtrans[3][r>>>8&63]|this.SPtrans[5][r>>>16&63]|this.SPtrans[7][r>>>24&63]|this.SPtrans[0][63&d]|this.SPtrans[2][d>>>8&63]|this.SPtrans[4][d>>>16&63]|this.SPtrans[6][d>>>24&63]},this.body=function(e,t,n){for(var i=0,s=0,o=0,r=0;r<25;r++){for(var d=0;d<2*this.ITERATIONS;d+=4)i=this.D_ENCRYPT(i,s,d,t,n,e),s=this.D_ENCRYPT(s,i,d+2,t,n,e);o=i,i=s,s=o}o=s,s=i>>>1|i<<31,i=o>>>1|o<<31,i&=4294967295,s&=4294967295;var h=new Array(2);this.PERM_OP(s,i,1,1431655765,h),s=h[0],i=h[1],this.PERM_OP(i,s,8,16711935,h),i=h[0],s=h[1],this.PERM_OP(s,i,2,858993459,h),s=h[0],i=h[1],this.PERM_OP(i,s,16,65535,h),i=h[0],s=h[1],this.PERM_OP(s,i,4,252645135,h),s=h[0],i=h[1];var a=new Array(2);return a[0]=i,a[1]=s,a},this.crypt=function(e,t){for(;e.length<2;)e+="A";var n,i=e.charAt(0)+"",s=e.charAt(1)+"",o=i.charCodeAt(0),r=s.charCodeAt(0);console.log("charZero",i,"charOne",s),n=i+s+" ",console.log('buffer "'+n+'"');for(var d=this.con_salt[o],h=this.con_salt[r]<<4,a=new Array(0,0,0,0,0,0,0,0),l=0;l<a.length&&l<t.length;l++){var g=t.charCodeAt(l);a[l]=g<<1}var c=this.des_set_key(a),_=this.body(c,d,h),u=new Array(9);this.intToFourBytes(_[0],u,0),this.intToFourBytes(_[1],u,4);l=2;for(var f=u[8]=0,b=128;l<13;l++)for(var m=0,p=0;m<6;m++)p<<=1,0!=(u[f]&b)&&(p|=1),0==(b>>>=1)&&(f++,b=128),n=n.substring(0,l)+String.fromCharCode(this.cov_2char[p])+n.substring(l+1,n.length);return n}}function PwrtStatus(e){this.sts=e,this.evenSts=function(){return e%2==0},this.oddSts=function(){return e%2==1},this.getSts=function(){return e}}var Pwr={eType_Boolean:98305,eType_Float32:98306,eType_Float64:98307,eType_Char:98308,eType_Int8:98309,eType_Int16:98310,eType_Int32:98311,eType_UInt8:98312,eType_UInt16:98313,eType_UInt32:98314,eType_Objid:98315,eType_Buffer:98316,eType_String:98317,eType_Enum:98318,eType_Struct:98319,eType_Mask:98320,eType_Array:98321,eType_Time:98322,eType_Text:98323,eType_AttrRef:98324,eType_UInt64:98325,eType_Int64:98326,eType_ClassId:98327,eType_TypeId:98328,eType_VolumeId:98329,eType_ObjectIx:98330,eType_RefId:98331,eType_DeltaTime:98332,eType_Status:98333,eType_NetStatus:98334,eType_CastId:98335,eType_ProString:98336,eType_DisableAttr:98337,eType_DataRef:98338,mPrv_RtRead:1,mPrv_RtWrite:2,mPrv_System:4,mPrv_Maintenance:8,mPrv_Process:16,mPrv_Instrument:32,mPrv_Operator1:64,mPrv_Operator2:128,mPrv_Operator3:256,mPrv_Operator4:512,mPrv_Operator5:1024,mPrv_Operator6:2048,mPrv_Operator7:4096,mPrv_Operator8:8192,mPrv_Operator9:16384,mPrv_Operator10:32768,mPrv_RtEventsAck:1<<18,mPrv_RtPlc:1<<19,mPrv_RtNavigator:1<<20,mPrv_DevRead:1<<21,mPrv_DevPlc:1<<22,mPrv_DevConfig:1<<23,mPrv_DevClass:1<<24,mPrv_RtEventsBlock:1<<25,mPrv_Administrator:1<<26,mPrv_SevRead:1<<27,mPrv_SevAdmin:1<<28,mAccess_RtRead:1,mAccess_RtWrite:2,mAccess_System:4,mAccess_Maintenance:8,mAccess_Process:16,mAccess_Instrument:32,mAccess_RtEventsBlock:1<<25,mAccess_RtEventsAck:1<<18,mAccess_RtPlc:1<<19,mAccess_RtNavigator:1<<20,mAccess_AllRt:35454975,mAccess_AllOperators:65472,mAccess_AllPwr:-1,mAdef_pointer:1,mAdef_array:2,mAdef_backup:4,mAdef_changelog:8,mAdef_state:16,mAdef_const:32,mAdef_rtvirtual:64,mAdef_devbodyref:128,mAdef_dynamic:256,mAdef_publicwrite:512,mAdef_noedit:1024,mAdef_invisible:2048,mAdef_refdirect:4096,mAdef_noinvert:8192,mAdef_noremove:16384,mAdef_rtdbref:32768,mAdef_private:65536,mAdef_class:131072,mAdef_superclass:262144,mAdef_buffer:524288,mAdef_nowbl:1048576,mAdef_alwayswbl:2097152,mAdef_disableattr:4194304,mAdef_rthide:8388608},Pwrb={mXttMethodsFlagsMask_IsConfigured:1,mXttOpMethodsMask_OpenGraph:1,mXttOpMethodsMask_OpenObjectGraph:2,mXttOpMethodsMask_OpenTrend:4,mXttOpMethodsMask_OpenHistory:8,mXttOpMethodsMask_OpenFast:16,mXttOpMethodsMask_Camera:32,mXttOpMethodsMask_HistEvent:64,mXttOpMethodsMask_BlockEvents:128,mXttOpMethodsMask_Help:256,mXttOpMethodsMask_Photo:512,mXttOpMethodsMask_Note:1024,mXttOpMethodsMask_ParentObjectGraph:2048,mXttMntMethodsMask_OpenObject:1,mXttMntMethodsMask_OpenTrace:2,mXttMntMethodsMask_RtNavigator:4,mXttMntMethodsMask_OpenCrossref:8,mXttMntMethodsMask_HelpClass:16,mXttMntMethodsMask_DataSheet:32,mXttMntMethodsMask_CircuitDiagram:64,mXttMntMethodsMask_Simulate:1<<31};function PwrtObjid(e,t){this.oix=t,this.vid=e}function PwrtAttrRef(){this.objid,this.offset,this.body,this.size,this.flags}function CdhrNumber(e,t){this.value=e,this.sts=t,this.evenSts=function(){return t%2==0},this.oddSts=function(){return t%2==1},this.getSts=function(){return t}}var CdhC={cUserVolMin:65793,cUserVolMax:16711422};function UserdataCbReturn(){this.userdata,this.row}function Sub(){this.sts,this.refid,this.type,this.elements,this.name,this.value}function ObjectInfo(){this.objid,this.cid,this.has_children,this.name,this.description,this.classname,this.full_name,this.param1}function AttributeInfo(){this.name,this.type,this.size,this.flags,this.element,this.objid,this.full_name,this.classname}function MenuButton(){this.type,this.text,this.name,this.url}function OpwindMenuInfo(){this.title,this.text,this.enable_language,this.enable_login,this.enable_alarmlist,this.enable_eventlog,this.enable_navigator,this.disable_help,this.disable_proview,this.language,this.buttons=[]}function CrrInfo(){this.type,this.objid,this.name,this.classname}function GlowPieInfo(){this.sector_num,this.min_val,this.max_val}function GlowBarChartInfo(){this.bars,this.barsegments,this.min_value,this.max_value}function GlowTableInfo(){this.columns,this.rows,this.column_size=new Array(Glow.TABLE_MAX_COL)}function PendingData(e,t){this.func_cb=e,this.data=t}var GdhOp={GET_OP_SELF:1,GET_OP_METHOD_PLC:2,GET_OP_METHOD_OBJECTGRAPH:3,GET_OP_METHOD_GRAPH:4,GET_OP_METHOD_HELPCLASS:5};function Gdh(){var j=1,M=2,E=3,k=4,R=5,B=6,D=7,L=9,G=10,N=15,F=25,X=26,z=29,H=36,W=39,V=42,J=50,Y=57,q=63,Z=64,K=65,Q=66,$=67,ee=68;this.debug=!1,this.pending=[],this.sub=[],this.PORT=4448,this.ws=null,this.open_cb=null,this.close_cb=null,this.return_cb=null,this.next_id=1234,this.subscriptionCount=1,this.listSend=!1,this.init=function(){""===window.location.hostname?this.ws=new WebSocket("ws:127.0.0.1:4448"):this.ws=new WebSocket("ws://"+window.location.hostname+":4448"),this.ws.binaryType="arraybuffer",(this.ws.gdh=this).ws.onopen=function(e){null!==this.gdh.open_cb&&this.gdh.open_cb()},this.ws.onclose=function(){this.debug&&console.log("Socket closed"),null!==this.gdh.close_cb&&this.gdh.close_cb()},this.ws.onmessage=function(e){if("string"==typeof e.data)console.log("String message received",e,e.data);else if(e.data instanceof ArrayBuffer){var t=new DataView(e.data),n=t.getUint8(0),i=t.getUint32(1),s=t.getUint32(5);switch(n){case R:this.gdh.debug&&console.log("GetObjectInfoBoolean received");var o=t.getUint8(9);(0,this.gdh.pending[i].func_cb)(i,s,o),delete this.gdh.pending[i];break;case D:this.gdh.debug&&console.log("GetObjectInfoInt received");o=t.getUint32(9);(T=this.gdh.pending[i]).func_cb(i,T.data,s,o),delete this.gdh.pending[i];break;case B:this.gdh.debug&&console.log("GetObjectInfoFloat received");o=t.getFloat32(9);(T=this.gdh.pending[i]).func_cb(i,T.data,s,o),delete this.gdh.pending[i];break;case Y:this.gdh.debug&&console.log("GetObjectInfoFloatArray received");var r=t.getInt32(9);o=new Array(r);_=13;for(var d=0;d<r;d++)o[d]=t.getFloat32(_),_+=4;(T=this.gdh.pending[i]).func_cb(i,T.data,s,o),delete this.gdh.pending[i];break;case j:this.gdh.debug&&console.log("SetObjectInfoBoolean received",i,s);break;case E:this.gdh.debug&&console.log("SetObjectInfoInt received",i,s);break;case M:this.gdh.debug&&console.log("SetObjectInfoFloat received",i,s);break;case k:this.gdh.debug&&console.log("SetObjectInfoString received",i,s);break;case L:this.gdh.debug&&console.log("ToggleObjectInfo received",i,s);break;case G:this.gdh.debug&&console.log("RefObjectInfo received",i,s),delete this.gdh.pending[i];break;case N:this.gdh.debug&&console.log("UnrefObjectInfo received",i,s),delete this.gdh.pending[i];break;case X:this.gdh.debug&&console.log("RefObjectInfoList received",i,s),(0,this.gdh.pending[i].func_cb)(i,s),delete this.gdh.pending[i];break;case F:var h=9,a=t.getUint32(h);this.gdh.debug&&console.log("GetObjectRefInfoAll received",i,a),h+=4;for(d=0;d<a;d++){var l=t.getUint32(h);h+=4;var g=t.getUint32(h);h+=4;var c=this.gdh.sub[l];if(void 0===c)h+=g;else{switch(c.type){case Pwr.eType_Boolean:if(c.elements<=1)o=t.getUint8(h),h+=1;else{(b=g)!=c.elements&&console.log("Subscription size error",b,c.elements,l),o=new Array(b);for(var _=0;_<b;_++)o[_]=t.getUint8(h),h+=1}break;case Pwr.eType_Float32:if(c.elements<=1)o=t.getFloat32(h),h+=4;else{(b=g/4)!=c.elements&&console.log("Subscription size error",b,c.elements,l),o=new Array(b);for(_=0;_<b;_++)o[_]=t.getFloat32(h),h+=4}break;case Pwr.eType_Int8:case Pwr.eType_Int16:case Pwr.eType_Int32:case Pwr.eType_UInt8:case Pwr.eType_UInt16:case Pwr.eType_UInt32:case Pwr.eType_Status:case Pwr.eType_NetStatus:case Pwr.eType_Mask:case Pwr.eType_Enum:case GraphIfc.eType_Bit:if(c.elements<=1)o=t.getInt32(h),h+=4;else{(b=g/4)!=c.elements&&console.log("Subscription size error",b,c.elements,l),o=new Array(b);for(_=0;_<b;_++)o[_]=t.getInt32(h),h+=4}break;case Pwr.eType_String:case Pwr.eType_Time:case Pwr.eType_DeltaTime:case Pwr.eType_AttrRef:case Pwr.eType_Objid:if(c.elements<=1){var u=t.getInt16(h);h+=2;var f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);o=String.fromCharCode.apply(null,f)}else{var b;(b=c.elements)!=c.elements&&console.log("Subscription size error",b,c.elements,l),o=new Array(b);for(var m=0;m<b;m++){u=t.getInt16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);o[m]=String.fromCharCode.apply(null,f)}}}this.gdh.sub[l].value=o}}if(void 0===this.gdh.pending[i]){console.log("** GetObjectRefInfoAll received removed",i);break}(0,this.gdh.pending[i].func_cb)(i,s),delete this.gdh.pending[i];break;case W:var p=[];h=9,a=t.getUint32(h);this.gdh.debug&&console.log("GetAllXttChildren received",i,a),console.log("GetAllXttChildren received",s,i,a),h+=4;for(d=0;d<a;d++){(y=new ObjectInfo).objid=new PwrtObjid,y.objid.vid=t.getUint32(h),h+=4,y.objid.oix=t.getUint32(h),h+=4,y.cid=t.getUint32(h),h+=4,y.has_children=0!==t.getUint16(h),h+=2;u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);y.name=String.fromCharCode.apply(null,f);var v=t.getUint16(h);h+=2,f=new Uint8Array(v);for(_=0;_<v;_++)f[_]=t.getUint8(h++);y.description=String.fromCharCode.apply(null,f);var w=t.getUint16(h);h+=2,f=new Uint8Array(w);for(_=0;_<w;_++)f[_]=t.getUint8(h++);y.classname=String.fromCharCode.apply(null,f),p.push(y)}(T=this.gdh.pending[i]).func_cb(i,T.data,s,p),delete this.gdh.pending[i];break;case H:p=[],h=9,a=t.getUint32(h);this.gdh.debug&&console.log("GetAllClassAttributes received",i,a),h+=4;for(d=0;d<a;d++){(y=new AttributeInfo).type=t.getUint32(h),h+=4,y.flags=t.getUint32(h),h+=4,y.size=t.getUint16(h),h+=2,y.elements=t.getUint16(h),h+=2;u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);y.name=String.fromCharCode.apply(null,f),u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);y.classname=String.fromCharCode.apply(null,f),p.push(y)}(T=this.gdh.pending[i]).func_cb(i,T.data,s,p),delete this.gdh.pending[i];break;case q:case ee:case K:this.gdh.debug&&console.log("GetObject received",i,s);var y=null;if(0!=(1&s)){h=9;(y=new ObjectInfo).objid=new PwrtObjid,y.objid.vid=t.getUint32(h),h+=4,y.objid.oix=t.getUint32(h),h+=4,y.cid=t.getUint32(h),h+=4,y.has_children=0!==t.getUint16(h),h+=2;u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);y.name=String.fromCharCode.apply(null,f),u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);y.fullname=String.fromCharCode.apply(null,f);w=t.getUint16(h);h+=2,f=new Uint8Array(w);for(_=0;_<w;_++)f[_]=t.getUint8(h++);y.classname=String.fromCharCode.apply(null,f);v=t.getUint16(h);h+=2,f=new Uint8Array(v);for(_=0;_<v;_++)f[_]=t.getUint8(h++);y.description=String.fromCharCode.apply(null,f);var x=t.getUint16(h);h+=2,f=new Uint8Array(x);for(_=0;_<x;_++)f[_]=t.getUint8(h++);y.param1=String.fromCharCode.apply(null,f)}(T=this.gdh.pending[i]).func_cb(i,T.data,s,y),delete this.gdh.pending[i];break;case V:if(0!=(1&s)){h=9,p=[],a=t.getUint16(h);h+=2,this.gdh.debug&&console.log("CrrSignal received",i,a);for(d=0;d<a;d++){(y=new CrrInfo).type=t.getUint16(h),h+=2,y.objid=new PwrtObjid,y.objid.vid=t.getUint32(h),h+=4,y.objid.oix=t.getUint32(h),h+=4;u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);y.name=String.fromCharCode.apply(null,f);w=t.getUint16(h);h+=2,f=new Uint8Array(w);for(_=0;_<w;_++)f[_]=t.getUint8(h++);y.classname=String.fromCharCode.apply(null,f),p.push(y)}}(T=this.gdh.pending[i]).func_cb(i,T.data,s,p),delete this.gdh.pending[i];break;case Z:p=new OpwindMenuInfo,h=9;if(this.gdh.debug&&console.log("GetOpwindMenu received",i,a),console.log("GetOpwindMenu received",s,i),1&s){u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);p.title=String.fromCharCode.apply(null,f),u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);p.text=String.fromCharCode.apply(null,f),p.enable_language=t.getUint32(h),h+=4,p.enable_login=t.getUint32(h),h+=4,p.enable_alarmlist=t.getUint32(h),h+=4,p.enable_eventlog=t.getUint32(h),h+=4,p.enable_navigator=t.getUint32(h),h+=4,p.disable_help=t.getUint32(h),h+=4,p.disable_proview=t.getUint32(h),h+=4,p.language=t.getUint32(h),h+=4;var A=t.getUint16(h);h+=2;for(d=0;d<A;d++){var P=new MenuButton;P.type=t.getUint32(h),h+=4,u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);P.text=String.fromCharCode.apply(null,f),u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);P.name=String.fromCharCode.apply(null,f),u=t.getUint16(h),h+=2,f=new Uint8Array(u);for(_=0;_<u;_++)f[_]=t.getUint8(h++);P.url=String.fromCharCode.apply(null,f),p.buttons.push(P)}}(T=this.gdh.pending[i]).func_cb(i,T.data,s,p),delete this.gdh.pending[i];break;case z:h=9;this.gdh.debug&&console.log("Check user received",i,a),console.log("Check user received",s,i);var U=0;1&s&&(U=t.getUint32(h),h+=4),(T=this.gdh.pending[i]).func_cb(i,T.data,s,U),delete this.gdh.pending[i];break;case J:if(1&s){h=9,u=t.getUint16(h);h+=2;for(f=new Uint8Array(u),_=0;_<u;_++)f[_]=t.getUint8(h++);var O=String.fromCharCode.apply(null,f)}(T=this.gdh.pending[i]).func_cb(i,T.data,s,O),delete this.gdh.pending[i];break;case Q:p=[],h=9,a=t.getUint32(h);this.gdh.debug&&console.log("MhSync received",i,a),h+=4;for(d=0;d<a;d++){e=new MhEvent;var I=t.getUint16(h);h+=2;for(f=new Uint8Array(I),_=0;_<I;_++)f[_]=t.getUint8(h++);e.eventTime=String.fromCharCode.apply(null,f),I=t.getUint16(h),h+=2,f=new Uint8Array(I);for(_=0;_<I;_++)f[_]=t.getUint8(h++);e.eventText=String.fromCharCode.apply(null,f),I=t.getUint16(h),h+=2,f=new Uint8Array(I);for(_=0;_<I;_++)f[_]=t.getUint8(h++);e.eventName=String.fromCharCode.apply(null,f),e.eventFlags=t.getUint32(h),h+=4,e.eventStatus=t.getUint32(h),h+=4,e.eventPrio=t.getUint32(h),h+=4,e.eventId=new MhEventId,e.eventId.nix=t.getUint32(h),h+=4,e.eventId.idx=t.getUint32(h),h+=4,I=t.getUint16(h),h+=2,f=new Uint8Array(I);for(_=0;_<I;_++)f[_]=t.getUint8(h++);e.eventId.birthTime=String.fromCharCode.apply(null,f),e.targetId=new MhEventId,e.targetId.nix=t.getUint32(h),h+=4,e.targetId.idx=t.getUint32(h),h+=4,I=t.getUint16(h),h+=2,f=new Uint8Array(I);for(_=0;_<I;_++)f[_]=t.getUint8(h++);e.targetId.birthTime=String.fromCharCode.apply(null,f),e.eventType=t.getUint32(h),h+=4;var S=new PwrtObjid(0,0);S.vid=t.getUint32(h),h+=4,S.oix=t.getUint32(h),h+=4,e.object=new PwrtAttrRef,e.object.objid=S,e.object.offset=t.getUint32(h),h+=4,e.object.body=t.getUint32(h),h+=4,e.object.size=t.getUint32(h),h+=4,e.object.flags=t.getUint32(h),h+=4;var C=new PwrtObjid(0,0);C.vid=t.getUint32(h),h+=4,C.oix=t.getUint32(h),h+=4,e.supObject=new PwrtAttrRef,e.supObject.objid=C,e.supObject.offset=t.getUint32(h),h+=4,e.supObject.body=t.getUint32(h),h+=4,e.supObject.size=t.getUint32(h),h+=4,e.supObject.flags=t.getUint32(h),h+=4,I=t.getUint16(h),h+=2,f=new Uint8Array(I);for(_=0;_<I;_++)f[_]=t.getUint8(h++);e.eventMoreText=String.fromCharCode.apply(null,f),e.syncIdx=t.getUint32(h),h+=4,p.push(e)}(T=this.gdh.pending[i]).func_cb(i,T.data,s,p),delete this.gdh.pending[i];break;case $:var T;(T=this.gdh.pending[i]).func_cb(i,T.data,s),delete this.gdh.pending[i];break;default:console.log("Unknown message type")}}}},this.getObjectInfoBoolean=function(e,t){this.return_cb=t;var n=new Uint8Array(e.length+6);n[0]=R,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;for(var i=0;i<e.length;i++)n[i+6]=e.charCodeAt(i);this.pending[this.next_id]=new PendingData(t,null),this.ws.send(n),this.next_id++},this.getObjectInfoInt=function(e,t,n){this.return_cb=t;var i=new Uint8Array(e.length+6);i[0]=D,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;for(var s=0;s<e.length;s++)i[s+6]=e.charCodeAt(s);this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.next_id++},this.getObjectInfoFloat=function(e,t,n){this.return_cb=t;var i=new Uint8Array(e.length+6);i[0]=B,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;for(var s=0;s<e.length;s++)i[s+6]=e.charCodeAt(s);this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.next_id++},this.getObjectInfoFloatArray=function(e,t,n,i){this.return_cb=n;var s=new Uint8Array(e.length+10);s[0]=Y,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&t,s[7]=t>>8&255,s[8]=t>>16&255,s[9]=t>>24&255;for(var o=0;o<e.length;o++)s[o+10]=e.charCodeAt(o);this.pending[this.next_id]=new PendingData(n,i),this.ws.send(s),this.next_id++},this.refObjectInfo=function(e,t,n){var i=new Sub;if(i.name=e,i.refid=this.subscriptionCount,i.type=t,i.elements=n,this.sub[this.subscriptionCount]=i,this.subscriptionCount++,this.listSent){var s;s=12+i.name.length;var o=new Uint8Array(s+10);o[0]=G,o[2]=255&this.next_id,o[3]=this.next_id>>8&255,o[4]=this.next_id>>16&255,o[5]=this.next_id>>24&255,this.debug&&console.log("RefObjectInfo: ",i.refid);var r=6;o[r++]=255&i.refid,o[r++]=i.refid>>8&255,o[r++]=i.refid>>16&255,o[r++]=i.refid>>24&255,o[r++]=255&i.elements,o[r++]=i.elements>>8&255,o[r++]=i.elements>>16&255,o[r++]=i.elements>>24&255,o[r++]=255&i.name.length,o[r++]=i.name.length>>8&255,o[r++]=i.name.length>>16&255,o[r++]=i.name.length>>24&255;for(var d=0;d<i.name.length;d++)o[r++]=i.name.charCodeAt(d);return this.pending[this.next_id]=new PendingData(this.refObjectInfoReply,null),this.debug&&console.log("Sending RefObjectInfo",this.next_id,s,r),this.ws.send(o),this.next_id++,i.refid}return i.refid},this.refObjectInfoReply=function(e,t){this.debug&&console.log("refObjectInfoReply",e,t)},this.unrefObjectInfo=function(e){var t=new Uint8Array(14);t[0]=N,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,this.debug&&console.log("UnrefObjectInfo: ",e);var n=6;t[n++]=255&e,t[n++]=e>>8&255,t[n++]=e>>16&255,t[n++]=e>>24&255,this.pending[this.next_id]=new PendingData(this.unrefObjectInfoReply,null),this.debug&&console.log("Sending UnrefObjectInfo",this.next_id,4,10,e),this.ws.send(t),this.next_id++,delete this.sub[e]},this.refObjectInfoList=function(e){var t=0,n=0;for(var i in this.return_cb=e,this.sub)t+=12+this.sub[i].name.length,n++;var s=new Uint8Array(t+10);s[0]=X,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&n,s[7]=n>>8&255,s[8]=n>>16&255,s[9]=n>>24&255;var o=10;for(var i in this.sub)if(0!==i){this.debug&&console.log("RefObjectInfoList: ",this.sub[i].refid),s[o++]=255&this.sub[i].refid,s[o++]=this.sub[i].refid>>8&255,s[o++]=this.sub[i].refid>>16&255,s[o++]=this.sub[i].refid>>24&255,s[o++]=255&this.sub[i].elements,s[o++]=this.sub[i].elements>>8&255,s[o++]=this.sub[i].elements>>16&255,s[o++]=this.sub[i].elements>>24&255,s[o++]=255&this.sub[i].name.length,s[o++]=this.sub[i].name.length>>8&255,s[o++]=this.sub[i].name.length>>16&255,s[o++]=this.sub[i].name.length>>24&255;for(var r=0;r<this.sub[i].name.length;r++)s[o++]=this.sub[i].name.charCodeAt(r)}this.pending[this.next_id]=new PendingData(e,null),this.debug&&console.log("Sending RefObjectInfoList",this.next_id,t,o,this.next_id),this.ws.send(s),this.next_id++,this.listSent=!0},this.refObjectInfoListReply=function(e,t){this.debug&&console.log("refObjectInfoListReply",e,t)},this.getRefObjectInfoAll=function(e){var t=new Uint8Array(6);t[0]=F,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,this.pending[this.next_id]=new PendingData(e,null),this.debug&&console.log("Sending getRefObjectInfoAll",this.next_id),this.ws.send(t),this.next_id++},this.getRefObjectInfoAllReply=function(e,t){this.debug&&console.log("getRefObjectInfoAllReply",e,t)},this.getObjectRefInfo=function(e){return this.debug&&console.log("getObjectRefInfo",e,this.sub[e].value),this.sub[e].value},this.setObjectInfoBoolean=function(e,t){var n=new Uint8Array(12+e.length);n[0]=j,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,n[10]=255&e.length,n[11]=e.length>>8&255;for(var i=12,s=0;s<e.length;s++)n[i++]=e.charCodeAt(s);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoBoolean",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoInt=function(e,t){var n=new Uint8Array(12+e.length);n[0]=E,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,n[10]=255&e.length,n[11]=e.length>>8&255;for(var i=12,s=0;s<e.length;s++)n[i++]=e.charCodeAt(s);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoInt",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoFloat=function(e,t){var n=new Uint8Array(12+e.length);n[0]=M,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;var i=new ArrayBuffer(4);new Float32Array(i)[0]=t;var s=new Uint8Array(i);n[6]=s[0],n[7]=s[1],n[8]=s[2],n[9]=s[3],n[10]=255&e.length,n[11]=e.length>>8&255;for(var o=12,r=0;r<e.length;r++)n[o++]=e.charCodeAt(r);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoFloat",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.setObjectInfoString=function(e,t){var n,i=new Uint8Array(10+t.length+e.length);i[0]=k,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&t.length,i[7]=t.length>>8&255;var s=8;for(n=0;n<t.length;n++)i[s++]=t.charCodeAt(n);for(i[s++]=255&e.length,i[s++]=e.length>>8&255,n=0;n<e.length;n++)i[s++]=e.charCodeAt(n);return this.ws.send(i),this.debug&&console.log("Sending setObjectInfoString",this.next_id,e,t),this.next_id++,new PwrtStatus(1)},this.toggleObjectInfo=function(e){var t=new Uint8Array(8+e.length);t[0]=L,t[2]=255&this.next_id,t[3]=this.next_id>>8&255,t[4]=this.next_id>>16&255,t[5]=this.next_id>>24&255,t[6]=255&e.length,t[7]=e.length>>8&255;for(var n=8,i=0;i<e.length;i++)t[n++]=e.charCodeAt(i);return this.ws.send(t),this.debug&&console.log("Sending toggleObjectInfoBoolean",this.next_id,e,value),this.next_id++,new PwrtStatus(1)},this.getAllXttChildren=function(e,t,n){var i=new Uint8Array(14);i[0]=W,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.vid,i[7]=e.vid>>8&255,i[8]=e.vid>>16&255,i[9]=e.vid>>24&255,i[10]=255&e.oix,i[11]=e.oix>>8&255,i[12]=e.oix>>16&255,i[13]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending getAllXttChildren",this.next_id),this.ws.send(i),this.next_id++},this.getAllClassAttributes=function(e,t,n,i){var s=new Uint8Array(18);s[0]=H,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&e,s[7]=e>>8&255,s[8]=e>>16&255,s[9]=e>>24&255,s[10]=255&t.vid,s[11]=t.vid>>8&255,s[12]=t.vid>>16&255,s[13]=t.vid>>24&255,s[14]=255&t.oix,s[15]=t.oix>>8&255,s[16]=t.oix>>16&255,s[17]=t.oix>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getAllClassAttributes",this.next_id,e,t.vid,t.oix),this.ws.send(s),this.next_id++},this.getObject=function(e,t,n,i){var s=new Uint8Array(16);s[0]=q,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&t,s[7]=t>>8&255,s[8]=255&e.vid,s[9]=e.vid>>8&255,s[10]=e.vid>>16&255,s[11]=e.vid>>24&255,s[12]=255&e.oix,s[13]=e.oix>>8&255,s[14]=e.oix>>16&255,s[15]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObject",this.next_id,e.vid,e.oix),this.ws.send(s),this.next_id++},this.getObjectFromAref=function(e,t,n,i){var s=new Uint8Array(32);s[0]=ee,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&t,s[7]=t>>8&255,s[8]=255&e.objid.vid,s[9]=e.objid.vid>>8&255,s[10]=e.objid.vid>>16&255,s[11]=e.objid.vid>>24&255,s[12]=255&e.objid.oix,s[13]=e.objid.oix>>8&255,s[14]=e.objid.oix>>16&255,s[15]=e.objid.oix>>24&255,s[16]=255&e.offset,s[17]=e.offset>>8&255,s[18]=e.offset>>16&255,s[19]=e.offset>>24&255,s[20]=255&e.body,s[21]=e.body>>8&255,s[22]=e.body>>16&255,s[23]=e.body>>24&255,s[24]=255&e.size,s[25]=e.size>>8&255,s[26]=e.size>>16&255,s[27]=e.size>>24&255,s[28]=255&e.flags,s[29]=e.flags>>8&255,s[30]=e.flags>>16&255,s[31]=e.flags>>24&255,this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObject",this.next_id,oid.vid,oid.oix),this.ws.send(s),this.next_id++},this.getObjectFromName=function(e,t,n,i){var s=new Uint8Array(10+e.length);s[0]=K,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&t,s[7]=t>>8&255,s[8]=255&e.length,s[9]=e.length>>8&255;for(var o=10,r=0;r<e.length;r++)s[o++]=e.charCodeAt(r);this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending getObjectFromName",this.next_id,e),this.ws.send(s),this.next_id++},this.crrSignal=function(e,t,n){var i=new Uint8Array(14);i[0]=V,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.vid,i[7]=e.vid>>8&255,i[8]=e.vid>>16&255,i[9]=e.vid>>24&255,i[10]=255&e.oix,i[11]=e.oix>>8&255,i[12]=e.oix>>16&255,i[13]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending crrObject",this.next_id,e.vid,e.oix),this.ws.send(i),this.next_id++},this.getOpwindMenu=function(e,t,n){e.length;var i=new Uint8Array(8+e.length);i[0]=Z,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.length,i[7]=e.length>>8&255;for(var s=8,o=0;o<e.length;o++)i[s++]=e.charCodeAt(o);this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending getOpwindMenu",this.next_id),this.ws.send(i),this.next_id++},this.login=function(e,t,n,i){var s=new Uint8Array(8+e.length+2+t.length);s[0]=z,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255;var o=6;s[o]=255&e.length,s[o+1]=e.length>>8&255,o+=2;for(var r=0;r<e.length;r++)s[o++]=e.charCodeAt(r);s[o]=255&t.length,s[o+1]=t.length>>8&255,o+=2;for(r=0;r<t.length;r++)s[o++]=t.charCodeAt(r);this.pending[this.next_id]=new PendingData(n,i),this.debug&&console.log("Sending login",this.next_id),this.ws.send(s),this.next_id++},this.getMsg=function(e,t,n){var i=new Uint8Array(10);i[0]=J,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.ws.send(i),this.debug&&console.log("Sending getMsg",this.next_id,e),this.next_id++},this.mhSync=function(e,t,n){var i=new Uint8Array(10);i[0]=Q,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending mhSync",this.next_id),this.ws.send(i),this.next_id++},this.mhAcknowledge=function(e,t,n){var i=new Uint8Array(16+e.birthTime.length);i[0]=$,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e.nix,i[7]=e.nix>>8&255,i[8]=e.nix>>16&255,i[9]=e.nix>>24&255,i[10]=255&e.idx,i[11]=e.idx>>8&255,i[12]=e.idx>>16&255,i[13]=e.idx>>24&255;var s=14;i[s]=255&e.birthTime.length,i[s+1]=e.birthTime.length>>8&255,s+=2;for(var o=0;o<e.birthTime.length;o++)i[s++]=e.birthTime.charCodeAt(o);this.pending[this.next_id]=new PendingData(t,n),this.debug&&console.log("Sending mhAcknowledge",this.next_id),console.log("Sending mhAcknowledge",this.next_id),this.ws.send(i),this.next_id++}}function OpWindMenu(){this.gdh=0,this.buttons=null,this.priv=0,this.user="",this.user_text=null,this.host;var r=this;this.init=function(){this.host=window.location.hostname,""==this.host&&(this.host="localhost"),this.gdh=new Gdh,this.gdh.open_cb=this.gdh_init_cb,this.gdh.init()},this.is_authorized=function(e){return!!(this.priv&e)},this.get_opplace=function(){var e=window.location.search.substring(1);console.log("query",e);var t=e.split("&");return console.log("vars",t.length,t[0].substring(8)),t[0].substring(8)},this.gdh_init_cb=function(){new PwrtObjid(0,0);r.user="Default",r.gdh.login("","",r.login_cb,r),r.gdh.getOpwindMenu(r.get_opplace(),r.get_menu_cb,999)},this.add_menu_button=function(e,t){var n=document.createElement("input");return n.type="button",n.className="leftmenu-button",n.value=t,n.addEventListener("click",new Function('menu.button_cb("'+n.value+'")')),e.appendChild(n),e.appendChild(document.createElement("br")),n},this.get_menu_cb=function(e,t,n,i){r.info=i,console.log("Menu received",n,t,i.buttons.length);var s=document.getElementById("opwindmenu");document.getElementById("opwind_title").innerHTML=i.title,document.getElementById("opwind_text").innerHTML=i.text,i.enable_login?(r.user_text=document.createTextNode(r.user+" on "+r.host),s.appendChild(r.user_text),s.appendChild(document.createElement("hr")),document.getElementById("login_button").addEventListener("click",function(e){"hidden"==document.getElementById("login_frame").style.visibility?(document.getElementById("login_user").value="",document.getElementById("login_passw").value="",document.getElementById("login_frame").style.visibility="visible",document.getElementById("login_frame").style.height="120px",document.getElementById("login_user").focus()):(document.getElementById("login_frame").style.visibility="hidden",document.getElementById("login_frame").style.height="0px")}),document.getElementById("apply_button").addEventListener("click",function(e){var t=document.getElementById("login_user").value,n=document.getElementById("login_passw").value;""!=t.trim()&&(document.getElementById("login_frame").style.visibility="hidden",document.getElementById("login_frame").style.height="0px",n=(new JopCrypt).crypt("aa",n),r.user=t,r.gdh.login(t,n,r.login_cb,r))}),document.getElementById("cancel_button").addEventListener("click",function(e){document.getElementById("login_frame").style.visibility="hidden",document.getElementById("login_frame").style.height="0px"}),document.getElementById("logout_button").addEventListener("click",function(e){document.getElementById("login_frame").style.visibility="hidden",document.getElementById("login_frame").style.height="0px",r.priv=0,r.user="Default",r.gdh.login("","",r.login_cb,r)}),document.getElementById("login_user").value="",document.getElementById("login_passw").value="",document.getElementById("login_frame").style.visibility="hidden",document.getElementById("login_frame").style.height="0px"):(document.getElementById("login_button").remove(),document.getElementById("login_frame").remove()),i.enable_language&&r.add_menu_button(s,"Language"),i.enable_alarmlist&&(r.add_menu_button(s,"AlarmList"),r.add_menu_button(s,"EventList")),i.enable_eventlog&&r.add_menu_button(s,"EventLog"),i.enable_navigator&&r.add_menu_button(s,"Navigator"),i.disable_help||r.add_menu_button(s,"Help"),i.disable_proview||r.add_menu_button(s,"ProviewR"),s.appendChild(document.createElement("hr"));for(var o=0;o<i.buttons.length;o++)r.add_menu_button(s,i.buttons[o].text)},this.button_cb=function(e){if(r.info.enable_language&&"Language"==e)console.log("Language activated");else if(r.info.enable_alarmlist&&"AlarmList"==e)console.log("AlarmList activated"),r.is_authorized(Pwr.mAccess_RtRead|Pwr.mAccess_RtWrite|Pwr.mAccess_AllOperators|Pwr.mAccess_System|Pwr.mAccess_Maintenance|Pwr.mAccess_Process|Pwr.mAccess_Instrument)?window.open("ev.html?list=alarm","_blank"):window.alert("Not authorized for this operation");else if(r.info.enable_alarmlist&&"EventList"==e)console.log("EventList activated"),r.is_authorized(Pwr.mAccess_RtRead|Pwr.mAccess_RtWrite|Pwr.mAccess_AllOperators|Pwr.mAccess_System|Pwr.mAccess_Maintenance|Pwr.mAccess_Process|Pwr.mAccess_Instrument)?window.open("ev.html?list=event","_blank"):window.alert("Not authorized for this operation");else if(r.info.enable_eventlog&&"EventLog"==e)console.log("EventLog activated"),r.is_authorized(Pwr.mAccess_RtRead|Pwr.mAccess_RtWrite|Pwr.mAccess_AllOperators|Pwr.mAccess_System|Pwr.mAccess_Maintenance|Pwr.mAccess_Process|Pwr.mAccess_Instrument)?window.alert("Not yet implemented"):window.alert("Not authorized for this operation");else if(r.info.enable_navigator&&"Navigator"==e)console.log("Navigator activated"),r.is_authorized(Pwr.mAccess_RtNavigator|Pwr.mAccess_System|Pwr.mAccess_Maintenance|Pwr.mAccess_Process|Pwr.mAccess_Instrument)?window.open("xtt.html","_blank"):window.alert("Not authorized for this operation");else if(r.info.disable_help||"Help"!=e)if(r.info.disable_proview||"ProviewR"!=e)if(r.is_authorized(Pwr.mAccess_RtRead|Pwr.mAccess_RtWrite|Pwr.mAccess_AllOperators|Pwr.mAccess_System|Pwr.mAccess_Maintenance|Pwr.mAccess_Process|Pwr.mAccess_Instrument)){for(var t=0;t<r.info.buttons.length;t++)if(r.info.buttons[t].text==e){console.log("Found",r.info.buttons[t].text);var n=r.info.buttons[t].name,i=n.indexOf(".pwg");-1!=i&&(n=n.substring(0,i));var s="ge.html?graph="+n;console.log("url",s),window.open(s,"_blank");break}}else window.alert("Not authorized for this operation");else console.log("ProviewR activated"),window.open("http://www.proview.se","_blank");else console.log("Help activated"),window.open("xtt_help_index.html","_blank")},this.login_cb=function(e,t,n,i){console.log("Login:",n,i),1&n?(r.priv=i,sessionStorage.setItem("pwr_privilege",r.priv),null!=r.user_text&&(r.user_text.textContent=r.user+" on "+r.host),console.log("Login",r.user,"Priv",r.priv)):(r.priv=0,r.user="none",sessionStorage.setItem("pwr_privilege",r.priv),null!=r.user_text&&(r.user_text.textContent="None on "+r.host),console.log("Login failure","Priv",r.priv))}}var menu=new OpWindMenu;menu.init();