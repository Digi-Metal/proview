"use strict";function PwrtStatus(t){this.sts=t,this.evenSts=function(){return t%2==0},this.oddSts=function(){return t%2==1},this.getSts=function(){return t}}var Pwr={eType_Boolean:98305,eType_Float32:98306,eType_Float64:98307,eType_Char:98308,eType_Int8:98309,eType_Int16:98310,eType_Int32:98311,eType_UInt8:98312,eType_UInt16:98313,eType_UInt32:98314,eType_Objid:98315,eType_Buffer:98316,eType_String:98317,eType_Enum:98318,eType_Struct:98319,eType_Mask:98320,eType_Array:98321,eType_Time:98322,eType_Text:98323,eType_AttrRef:98324,eType_UInt64:98325,eType_Int64:98326,eType_ClassId:98327,eType_TypeId:98328,eType_VolumeId:98329,eType_ObjectIx:98330,eType_RefId:98331,eType_DeltaTime:98332,eType_Status:98333,eType_NetStatus:98334,eType_CastId:98335,eType_ProString:98336,eType_DisableAttr:98337,eType_DataRef:98338,mPrv_RtRead:1,mPrv_RtWrite:2,mPrv_System:4,mPrv_Maintenance:8,mPrv_Process:16,mPrv_Instrument:32,mPrv_Operator1:64,mPrv_Operator2:128,mPrv_Operator3:256,mPrv_Operator4:512,mPrv_Operator5:1024,mPrv_Operator6:2048,mPrv_Operator7:4096,mPrv_Operator8:8192,mPrv_Operator9:16384,mPrv_Operator10:32768,mPrv_RtEventsAck:1<<18,mPrv_RtPlc:1<<19,mPrv_RtNavigator:1<<20,mPrv_DevRead:1<<21,mPrv_DevPlc:1<<22,mPrv_DevConfig:1<<23,mPrv_DevClass:1<<24,mPrv_RtEventsBlock:1<<25,mPrv_Administrator:1<<26,mPrv_SevRead:1<<27,mPrv_SevAdmin:1<<28,mAccess_RtRead:1,mAccess_RtWrite:2,mAccess_System:4,mAccess_Maintenance:8,mAccess_Process:16,mAccess_Instrument:32,mAccess_RtEventsBlock:1<<25,mAccess_RtEventsAck:1<<18,mAccess_RtPlc:1<<19,mAccess_RtNavigator:1<<20,mAccess_AllRt:35454975,mAccess_AllOperators:65472,mAccess_AllPwr:-1,mAdef_pointer:1,mAdef_array:2,mAdef_backup:4,mAdef_changelog:8,mAdef_state:16,mAdef_const:32,mAdef_rtvirtual:64,mAdef_devbodyref:128,mAdef_dynamic:256,mAdef_publicwrite:512,mAdef_noedit:1024,mAdef_invisible:2048,mAdef_refdirect:4096,mAdef_noinvert:8192,mAdef_noremove:16384,mAdef_rtdbref:32768,mAdef_private:65536,mAdef_class:131072,mAdef_superclass:262144,mAdef_buffer:524288,mAdef_nowbl:1048576,mAdef_alwayswbl:2097152,mAdef_disableattr:4194304,mAdef_rthide:8388608},Pwrb={mXttMethodsFlagsMask_IsConfigured:1,mXttOpMethodsMask_OpenGraph:1,mXttOpMethodsMask_OpenObjectGraph:2,mXttOpMethodsMask_OpenTrend:4,mXttOpMethodsMask_OpenHistory:8,mXttOpMethodsMask_OpenFast:16,mXttOpMethodsMask_Camera:32,mXttOpMethodsMask_HistEvent:64,mXttOpMethodsMask_BlockEvents:128,mXttOpMethodsMask_Help:256,mXttOpMethodsMask_Photo:512,mXttOpMethodsMask_Note:1024,mXttOpMethodsMask_ParentObjectGraph:2048,mXttMntMethodsMask_OpenObject:1,mXttMntMethodsMask_OpenTrace:2,mXttMntMethodsMask_RtNavigator:4,mXttMntMethodsMask_OpenCrossref:8,mXttMntMethodsMask_HelpClass:16,mXttMntMethodsMask_DataSheet:32,mXttMntMethodsMask_CircuitDiagram:64,mXttMntMethodsMask_Simulate:1<<31};function PwrtObjid(t,e){this.oix=e,this.vid=t}function PwrtAttrRef(){this.objid,this.offset,this.body,this.size,this.flags}function CdhrNumber(t,e){this.value=t,this.sts=e,this.evenSts=function(){return e%2==0},this.oddSts=function(){return e%2==1},this.getSts=function(){return e}}var CdhC={cUserVolMin:65793,cUserVolMax:16711422};function UserdataCbReturn(){this.userdata,this.row}function CliTable(t,e){this.command=t,this.qualifier=e}var CliC={SUCCESS:1,SYNTAX_ERROR:2,UNKNOWN_COMMAND:4,QUALNOTFOUND:6,VERB_VECT_SIZE:5,STATE_INIT:0,STATE_VERB:1,STATE_QUAL:2,STATE_QUALVALUE:3,STATE_SPACE:4,STATE_EQUAL:5,STATE_ERROR:6,STATE_QUOTE_VERB:7,STATE_QUOTE_QUALVALUE:8,STATE_QUALVALUE_EXACT:9,STATE_VERB_EXACT:10,TAB:"\t",SPACE:" "};function Cli(t){this.verb=new Array(CliC.VERB_VECT_SIZE),this.verbCount=0,this.qualifier=new Array(30),this.qualValue=new Array(30),this.qualifierCount=0,this.status,this.cliTableIndex,this.cliQualifierIndex=new Array(30),this.configuredVerbs,this.cliTable=t,this.getStsString=function(){switch(this.status){case CliC.SUCCESS:return"Success";case CliC.SYNTAX_ERROR:return"Syntax error";case CliC.UNKNOWN_COMMAND:return"Unknown command verb";case CliC.QUALNOTFOUND:return"Unknown qualifier";default:return"Unknown command interpreter error"}},this.evenSts=function(){return this.status%2==0},this.oddSts=function(){return this.status%2!=0},this.parse=function(t){var e,i=CliC.STATE_INIT,n=0;for(this.status=CliC.SUCCESS,this.verbCount=0,e=this.qualifierCount=0;e<t.length;e++){var s=t.charAt(e);switch(i){case CliC.STATE_INIT:if(s==CliC.SPACE||s==CliC.TAB)break;i=CliC.STATE_VERB,n=e;break;case CliC.STATE_SPACE:if(s==CliC.SPACE||s==CliC.TAB)break;if("/"==s)i=CliC.STATE_QUAL,n=e;else if("="==s){if(0===this.qualifierCount){i=CliC.STATE_ERROR,this.status=CliC.SYNTAX_ERROR;break}i=CliC.STATE_EQUAL}else{if('"'==s){i=CliC.STATE_QUOTE_VERB;break}i=CliC.STATE_VERB,n=e}break;case CliC.STATE_VERB:if(s==CliC.SPACE||s==CliC.TAB){if(this.verbCount==CliC.VERB_VECT_SIZE){i=CliC.STATE_ERROR;break}0===this.verbCount?this.verb[this.verbCount++]=t.substring(n,e).toUpperCase():this.verb[this.verbCount++]=t.substring(n,e),i=CliC.STATE_SPACE}else if("/"==s){if(this.verbCount==CliC.VERB_VECT_SIZE){i=CliC.STATE_ERROR;break}this.verb[this.verbCount++]=t.substring(n,e).toUpperCase(),i=CliC.STATE_QUAL,n=e}break;case CliC.STATE_VERB_EXACT:if('"'==s){if(this.verbCount==CliC.VERB_VECT_SIZE){i=CliC.STATE_ERROR;break}this.verb[this.verbCount++]=t.substring(n,e),i=CliC.STATE_SPACE}break;case CliC.STATE_QUAL:s==CliC.SPACE||s==CliC.TAB?(this.qualifier[this.qualifierCount++]=t.substring(n,e).toUpperCase(),i=CliC.STATE_SPACE):"="==s?(this.qualifier[this.qualifierCount++]=t.substring(n,e).toUpperCase(),i=CliC.STATE_EQUAL):"/"==s&&(this.qualifier[this.qualifierCount++]=t.substring(n,e).toUpperCase(),i=CliC.STATE_QUAL,n=e);break;case CliC.STATE_QUALVALUE:s==CliC.SPACE||s==CliC.TAB?(this.qualValue[this.qualifierCount-1]=t.substring(n,e),i=CliC.STATE_SPACE):"/"==s&&(this.qualValue[this.qualifierCount-1]=t.substring(n,e),i=CliC.STATE_QUAL,n=e);break;case CliC.STATE_QUALVALUE_EXACT:'"'==s&&(this.qualValue[this.qualifierCount-1]=t.substring(n,e),i=CliC.STATE_SPACE);break;case CliC.STATE_QUOTE_VERB:i=CliC.STATE_VERB_EXACT,n=e;break;case CliC.STATE_QUOTE_QUALVALUE:i=CliC.STATE_QUALVALUE_EXACT,n=e;break;case CliC.STATE_EQUAL:if(s==CliC.SPACE||s==CliC.TAB)break;'"'==s?i=CliC.STATE_QUOTE_QUALVALUE:(i=CliC.STATE_QUALVALUE,n=e)}if(i==CliC.STATE_ERROR)break}switch(i){case CliC.STATE_INIT:case CliC.STATE_ERROR:return"";case CliC.STATE_VERB:if(this.verbCount==CliC.VERB_VECT_SIZE){i=CliC.STATE_ERROR;break}0===this.verbCount?this.verb[this.verbCount++]=t.substring(n,e).toUpperCase():this.verb[this.verbCount++]=t.substring(n,e);break;case CliC.STATE_VERB_EXACT:if(this.verbCount==CliC.VERB_VECT_SIZE){i=CliC.STATE_ERROR;break}this.verb[this.verbCount++]=t.substring(n,e);break;case CliC.STATE_QUAL:this.qualifier[this.qualifierCount++]=t.substring(n,e).toUpperCase();break;case CliC.STATE_QUALVALUE:case CliC.STATE_QUALVALUE_EXACT:this.qualValue[this.qualifierCount-1]=t.substring(n,e);break;case CliC.STATE_QUOTE_VERB:case CliC.STATE_QUOTE_QUALVALUE:case CliC.STATE_EQUAL:return this.status=CliC.SYNTAX_ERROR,""}if(0===this.verbCount)return this.status=CliC.SYNTAX_ERROR,"";var o=!1;for(e=0;e<this.cliTable.length;e++)if(!(this.verb[0].length>this.cliTable[e].command.length)&&this.verb[0]==this.cliTable[e].command.substring(0,this.verb[0].length)){this.verb[0]=this.cliTable[e].command,o=!0;break}if(!o)return this.status=CliC.UNKNOWN_COMMAND,"";if(this.cliTableIndex=e,this.configuredVerbs=0,null!==this.cliTable[this.cliTableIndex].qualifier){for(e=0;e<this.cliTable[this.cliTableIndex].qualifier.length&&null!==this.cliTable[this.cliTableIndex].qualifier[e];e++)"cli_arg1"==this.cliTable[this.cliTableIndex].qualifier[e]&&this.configuredVerbs++,"cli_arg2"==this.cliTable[this.cliTableIndex].qualifier[e]&&this.configuredVerbs++,"cli_arg3"==this.cliTable[this.cliTableIndex].qualifier[e]&&this.configuredVerbs++,"cli_arg4"==this.cliTable[this.cliTableIndex].qualifier[e]&&this.configuredVerbs++,"cli_arg5"==this.cliTable[this.cliTableIndex].qualifier[e]&&this.configuredVerbs++;for(var a=0;a<this.qualifierCount;a++){for(o=!1,e=0;e<this.cliTable[this.cliTableIndex].qualifier.length&&null!==this.cliTable[this.cliTableIndex].qualifier[e];e++)this.qualifier[a].length>this.cliTable[this.cliTableIndex].qualifier[e].length||this.qualifier[a]==this.cliTable[this.cliTableIndex].qualifier[e].substring(0,this.qualifier[a].length)&&(this.cliQualifierIndex[a]=e,o=!0,this.qualifier[a]=this.cliTable[this.cliTableIndex].qualifier[e]);if(!o)return this.status=CliC.QUALNOTFOUND,""}}else if(0<this.qualifierCount)return this.status=CliC.QUALNOTFOUND,"";return this.verb[0]},this.qualifierFound=function(t){if("cli_arg1"==t)return!(this.verbCount<2||this.configuredVerbs<1);if("cli_arg2"==t)return!(this.verbCount<3||this.configuredVerbs<2);if("cli_arg3"==t)return!(this.verbCount<4||this.configuredVerbs<3);if("cli_arg4"==t)return!(this.verbCount<5||this.configuredVerbs<4);for(var e=0;e<this.qualifierCount;e++)if(t==this.qualifier[e])return!0;return!1},this.getQualValue=function(t){if("cli_arg1"==t)return this.verbCount<2||this.configuredVerbs<1?"":this.verb[1];if("cli_arg2"==t)return this.verbCount<3||this.configuredVerbs<2?"":this.verb[2];if("cli_arg3"==t&&(this.verbCount<4||this.configuredVerbs<3))return this.verb[3];if("cli_arg4"==t)return this.verbCount<5||this.configuredVerbs<4?"":this.verb[4];for(var e=0;e<this.qualifierCount;e++)if(t==this.qualifier[e])return null===this.qualValue[e]?"":this.qualValue[e];return""}}var GraphIfc={eType_Bit:32769};function Sub(){this.sts,this.refid,this.type,this.elements,this.name,this.value}function ObjectInfo(){this.objid,this.cid,this.has_children,this.name,this.description,this.classname,this.full_name,this.param1}function AttributeInfo(){this.name,this.type,this.size,this.flags,this.element,this.objid,this.full_name,this.classname}function MenuButton(){this.type,this.text,this.name,this.url}function OpwindMenuInfo(){this.title,this.text,this.enable_language,this.enable_login,this.enable_alarmlist,this.enable_eventlog,this.enable_navigator,this.disable_help,this.disable_proview,this.language,this.buttons=[]}function CrrInfo(){this.type,this.objid,this.name,this.classname}function GlowPieInfo(){this.sector_num,this.min_val,this.max_val}function GlowBarChartInfo(){this.bars,this.barsegments,this.min_value,this.max_value}function GlowTableInfo(){this.columns,this.rows,this.column_size=new Array(Glow.TABLE_MAX_COL)}function PendingData(t,e){this.func_cb=t,this.data=e}var GdhOp={GET_OP_SELF:1,GET_OP_METHOD_PLC:2,GET_OP_METHOD_OBJECTGRAPH:3,GET_OP_METHOD_GRAPH:4,GET_OP_METHOD_HELPCLASS:5};function Gdh(){var I=1,R=2,k=3,j=4,B=5,V=6,N=7,Q=9,M=10,D=15,G=25,L=26,Y=29,z=36,K=39,F=42,X=50,W=57,q=63,J=64,H=65,Z=66,$=67,tt=68;this.debug=!1,this.pending=[],this.sub=[],this.PORT=4448,this.ws=null,this.open_cb=null,this.close_cb=null,this.return_cb=null,this.next_id=1234,this.subscriptionCount=1,this.listSend=!1,this.init=function(){""===window.location.hostname?this.ws=new WebSocket("ws:127.0.0.1:4448"):this.ws=new WebSocket("ws://"+window.location.hostname+":4448"),this.ws.binaryType="arraybuffer",(this.ws.gdh=this).ws.onopen=function(t){null!==this.gdh.open_cb&&this.gdh.open_cb()},this.ws.onclose=function(){this.debug&&console.log("Socket closed"),null!==this.gdh.close_cb&&this.gdh.close_cb()},this.ws.onmessage=function(t){if("string"==typeof t.data)console.log("String message received",t,t.data);else if(t.data instanceof ArrayBuffer){var e=new DataView(t.data),i=e.getUint8(0),n=e.getUint32(1),s=e.getUint32(5);switch(i){case B:this.gdh.debug&&console.log("GetObjectInfoBoolean received");var o=e.getUint8(9);(0,this.gdh.pending[n].func_cb)(n,s,o),delete this.gdh.pending[n];break;case N:this.gdh.debug&&console.log("GetObjectInfoInt received");o=e.getUint32(9);(P=this.gdh.pending[n]).func_cb(n,P.data,s,o),delete this.gdh.pending[n];break;case V:this.gdh.debug&&console.log("GetObjectInfoFloat received");o=e.getFloat32(9);(P=this.gdh.pending[n]).func_cb(n,P.data,s,o),delete this.gdh.pending[n];break;case W:this.gdh.debug&&console.log("GetObjectInfoFloatArray received");var a=e.getInt32(9);o=new Array(a);g=13;for(var l=0;l<a;l++)o[l]=e.getFloat32(g),g+=4;(P=this.gdh.pending[n]).func_cb(n,P.data,s,o),delete this.gdh.pending[n];break;case I:this.gdh.debug&&console.log("SetObjectInfoBoolean received",n,s);break;case k:this.gdh.debug&&console.log("SetObjectInfoInt received",n,s);break;case R:this.gdh.debug&&console.log("SetObjectInfoFloat received",n,s);break;case j:this.gdh.debug&&console.log("SetObjectInfoString received",n,s);break;case Q:this.gdh.debug&&console.log("ToggleObjectInfo received",n,s);break;case M:this.gdh.debug&&console.log("RefObjectInfo received",n,s),delete this.gdh.pending[n];break;case D:this.gdh.debug&&console.log("UnrefObjectInfo received",n,s),delete this.gdh.pending[n];break;case L:this.gdh.debug&&console.log("RefObjectInfoList received",n,s),(0,this.gdh.pending[n].func_cb)(n,s),delete this.gdh.pending[n];break;case G:var r=9,h=e.getUint32(r);this.gdh.debug&&console.log("GetObjectRefInfoAll received",n,h),r+=4;for(l=0;l<h;l++){var A=e.getUint32(r);r+=4;var c=e.getUint32(r);r+=4;var d=this.gdh.sub[A];if(void 0===d)r+=c;else{switch(d.type){case Pwr.eType_Boolean:if(d.elements<=1)o=e.getUint8(r),r+=1;else{(f=c)!=d.elements&&console.log("Subscription size error",f,d.elements,A),o=new Array(f);for(var g=0;g<f;g++)o[g]=e.getUint8(r),r+=1}break;case Pwr.eType_Float32:if(d.elements<=1)o=e.getFloat32(r),r+=4;else{(f=c/4)!=d.elements&&console.log("Subscription size error",f,d.elements,A),o=new Array(f);for(g=0;g<f;g++)o[g]=e.getFloat32(r),r+=4}break;case Pwr.eType_Int8:case Pwr.eType_Int16:case Pwr.eType_Int32:case Pwr.eType_UInt8:case Pwr.eType_UInt16:case Pwr.eType_UInt32:case Pwr.eType_Status:case Pwr.eType_NetStatus:case Pwr.eType_Mask:case Pwr.eType_Enum:case GraphIfc.eType_Bit:if(d.elements<=1)o=e.getInt32(r),r+=4;else{(f=c/4)!=d.elements&&console.log("Subscription size error",f,d.elements,A),o=new Array(f);for(g=0;g<f;g++)o[g]=e.getInt32(r),r+=4}break;case Pwr.eType_String:case Pwr.eType_Time:case Pwr.eType_DeltaTime:case Pwr.eType_AttrRef:case Pwr.eType_Objid:if(d.elements<=1){var _=e.getInt16(r);r+=2;var u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);o=String.fromCharCode.apply(null,u)}else{var f;(f=d.elements)!=d.elements&&console.log("Subscription size error",f,d.elements,A),o=new Array(f);for(var b=0;b<f;b++){_=e.getInt16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);o[b]=String.fromCharCode.apply(null,u)}}}this.gdh.sub[A].value=o}}if(void 0===this.gdh.pending[n]){console.log("** GetObjectRefInfoAll received removed",n);break}(0,this.gdh.pending[n].func_cb)(n,s),delete this.gdh.pending[n];break;case K:var w=[];r=9,h=e.getUint32(r);this.gdh.debug&&console.log("GetAllXttChildren received",n,h),console.log("GetAllXttChildren received",s,n,h),r+=4;for(l=0;l<h;l++){(m=new ObjectInfo).objid=new PwrtObjid,m.objid.vid=e.getUint32(r),r+=4,m.objid.oix=e.getUint32(r),r+=4,m.cid=e.getUint32(r),r+=4,m.has_children=0!==e.getUint16(r),r+=2;_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);m.name=String.fromCharCode.apply(null,u);var p=e.getUint16(r);r+=2,u=new Uint8Array(p);for(g=0;g<p;g++)u[g]=e.getUint8(r++);m.description=String.fromCharCode.apply(null,u);var v=e.getUint16(r);r+=2,u=new Uint8Array(v);for(g=0;g<v;g++)u[g]=e.getUint8(r++);m.classname=String.fromCharCode.apply(null,u),w.push(m)}(P=this.gdh.pending[n]).func_cb(n,P.data,s,w),delete this.gdh.pending[n];break;case z:w=[],r=9,h=e.getUint32(r);this.gdh.debug&&console.log("GetAllClassAttributes received",n,h),r+=4;for(l=0;l<h;l++){(m=new AttributeInfo).type=e.getUint32(r),r+=4,m.flags=e.getUint32(r),r+=4,m.size=e.getUint16(r),r+=2,m.elements=e.getUint16(r),r+=2;_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);m.name=String.fromCharCode.apply(null,u),_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);m.classname=String.fromCharCode.apply(null,u),w.push(m)}(P=this.gdh.pending[n]).func_cb(n,P.data,s,w),delete this.gdh.pending[n];break;case q:case tt:case H:this.gdh.debug&&console.log("GetObject received",n,s);var m=null;if(0!=(1&s)){r=9;(m=new ObjectInfo).objid=new PwrtObjid,m.objid.vid=e.getUint32(r),r+=4,m.objid.oix=e.getUint32(r),r+=4,m.cid=e.getUint32(r),r+=4,m.has_children=0!==e.getUint16(r),r+=2;_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);m.name=String.fromCharCode.apply(null,u),_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);m.fullname=String.fromCharCode.apply(null,u);v=e.getUint16(r);r+=2,u=new Uint8Array(v);for(g=0;g<v;g++)u[g]=e.getUint8(r++);m.classname=String.fromCharCode.apply(null,u);p=e.getUint16(r);r+=2,u=new Uint8Array(p);for(g=0;g<p;g++)u[g]=e.getUint8(r++);m.description=String.fromCharCode.apply(null,u);var C=e.getUint16(r);r+=2,u=new Uint8Array(C);for(g=0;g<C;g++)u[g]=e.getUint8(r++);m.param1=String.fromCharCode.apply(null,u)}(P=this.gdh.pending[n]).func_cb(n,P.data,s,m),delete this.gdh.pending[n];break;case F:if(0!=(1&s)){r=9,w=[],h=e.getUint16(r);r+=2,this.gdh.debug&&console.log("CrrSignal received",n,h);for(l=0;l<h;l++){(m=new CrrInfo).type=e.getUint16(r),r+=2,m.objid=new PwrtObjid,m.objid.vid=e.getUint32(r),r+=4,m.objid.oix=e.getUint32(r),r+=4;_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);m.name=String.fromCharCode.apply(null,u);v=e.getUint16(r);r+=2,u=new Uint8Array(v);for(g=0;g<v;g++)u[g]=e.getUint8(r++);m.classname=String.fromCharCode.apply(null,u),w.push(m)}}(P=this.gdh.pending[n]).func_cb(n,P.data,s,w),delete this.gdh.pending[n];break;case J:w=new OpwindMenuInfo,r=9;if(this.gdh.debug&&console.log("GetOpwindMenu received",n,h),console.log("GetOpwindMenu received",s,n),1&s){_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);w.title=String.fromCharCode.apply(null,u),_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);w.text=String.fromCharCode.apply(null,u),w.enable_language=e.getUint32(r),r+=4,w.enable_login=e.getUint32(r),r+=4,w.enable_alarmlist=e.getUint32(r),r+=4,w.enable_eventlog=e.getUint32(r),r+=4,w.enable_navigator=e.getUint32(r),r+=4,w.disable_help=e.getUint32(r),r+=4,w.disable_proview=e.getUint32(r),r+=4,w.language=e.getUint32(r),r+=4;var x=e.getUint16(r);r+=2;for(l=0;l<x;l++){var E=new MenuButton;E.type=e.getUint32(r),r+=4,_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);E.text=String.fromCharCode.apply(null,u),_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);E.name=String.fromCharCode.apply(null,u),_=e.getUint16(r),r+=2,u=new Uint8Array(_);for(g=0;g<_;g++)u[g]=e.getUint8(r++);E.url=String.fromCharCode.apply(null,u),w.buttons.push(E)}}(P=this.gdh.pending[n]).func_cb(n,P.data,s,w),delete this.gdh.pending[n];break;case Y:r=9;this.gdh.debug&&console.log("Check user received",n,h),console.log("Check user received",s,n);var T=0;1&s&&(T=e.getUint32(r),r+=4),(P=this.gdh.pending[n]).func_cb(n,P.data,s,T),delete this.gdh.pending[n];break;case X:if(1&s){r=9,_=e.getUint16(r);r+=2;for(u=new Uint8Array(_),g=0;g<_;g++)u[g]=e.getUint8(r++);var O=String.fromCharCode.apply(null,u)}(P=this.gdh.pending[n]).func_cb(n,P.data,s,O),delete this.gdh.pending[n];break;case Z:w=[],r=9,h=e.getUint32(r);this.gdh.debug&&console.log("MhSync received",n,h),r+=4;for(l=0;l<h;l++){t=new MhEvent;var S=e.getUint16(r);r+=2;for(u=new Uint8Array(S),g=0;g<S;g++)u[g]=e.getUint8(r++);t.eventTime=String.fromCharCode.apply(null,u),S=e.getUint16(r),r+=2,u=new Uint8Array(S);for(g=0;g<S;g++)u[g]=e.getUint8(r++);t.eventText=String.fromCharCode.apply(null,u),S=e.getUint16(r),r+=2,u=new Uint8Array(S);for(g=0;g<S;g++)u[g]=e.getUint8(r++);t.eventName=String.fromCharCode.apply(null,u),t.eventFlags=e.getUint32(r),r+=4,t.eventStatus=e.getUint32(r),r+=4,t.eventPrio=e.getUint32(r),r+=4,t.eventId=new MhEventId,t.eventId.nix=e.getUint32(r),r+=4,t.eventId.idx=e.getUint32(r),r+=4,S=e.getUint16(r),r+=2,u=new Uint8Array(S);for(g=0;g<S;g++)u[g]=e.getUint8(r++);t.eventId.birthTime=String.fromCharCode.apply(null,u),t.targetId=new MhEventId,t.targetId.nix=e.getUint32(r),r+=4,t.targetId.idx=e.getUint32(r),r+=4,S=e.getUint16(r),r+=2,u=new Uint8Array(S);for(g=0;g<S;g++)u[g]=e.getUint8(r++);t.targetId.birthTime=String.fromCharCode.apply(null,u),t.eventType=e.getUint32(r),r+=4;var y=new PwrtObjid(0,0);y.vid=e.getUint32(r),r+=4,y.oix=e.getUint32(r),r+=4,t.object=new PwrtAttrRef,t.object.objid=y,t.object.offset=e.getUint32(r),r+=4,t.object.body=e.getUint32(r),r+=4,t.object.size=e.getUint32(r),r+=4,t.object.flags=e.getUint32(r),r+=4;var U=new PwrtObjid(0,0);U.vid=e.getUint32(r),r+=4,U.oix=e.getUint32(r),r+=4,t.supObject=new PwrtAttrRef,t.supObject.objid=U,t.supObject.offset=e.getUint32(r),r+=4,t.supObject.body=e.getUint32(r),r+=4,t.supObject.size=e.getUint32(r),r+=4,t.supObject.flags=e.getUint32(r),r+=4,S=e.getUint16(r),r+=2,u=new Uint8Array(S);for(g=0;g<S;g++)u[g]=e.getUint8(r++);t.eventMoreText=String.fromCharCode.apply(null,u),t.syncIdx=e.getUint32(r),r+=4,w.push(t)}(P=this.gdh.pending[n]).func_cb(n,P.data,s,w),delete this.gdh.pending[n];break;case $:var P;(P=this.gdh.pending[n]).func_cb(n,P.data,s),delete this.gdh.pending[n];break;default:console.log("Unknown message type")}}}},this.getObjectInfoBoolean=function(t,e){this.return_cb=e;var i=new Uint8Array(t.length+6);i[0]=B,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;for(var n=0;n<t.length;n++)i[n+6]=t.charCodeAt(n);this.pending[this.next_id]=new PendingData(e,null),this.ws.send(i),this.next_id++},this.getObjectInfoInt=function(t,e,i){this.return_cb=e;var n=new Uint8Array(t.length+6);n[0]=N,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;for(var s=0;s<t.length;s++)n[s+6]=t.charCodeAt(s);this.pending[this.next_id]=new PendingData(e,i),this.ws.send(n),this.next_id++},this.getObjectInfoFloat=function(t,e,i){this.return_cb=e;var n=new Uint8Array(t.length+6);n[0]=V,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255;for(var s=0;s<t.length;s++)n[s+6]=t.charCodeAt(s);this.pending[this.next_id]=new PendingData(e,i),this.ws.send(n),this.next_id++},this.getObjectInfoFloatArray=function(t,e,i,n){this.return_cb=i;var s=new Uint8Array(t.length+10);s[0]=W,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&e,s[7]=e>>8&255,s[8]=e>>16&255,s[9]=e>>24&255;for(var o=0;o<t.length;o++)s[o+10]=t.charCodeAt(o);this.pending[this.next_id]=new PendingData(i,n),this.ws.send(s),this.next_id++},this.refObjectInfo=function(t,e,i){var n=new Sub;if(n.name=t,n.refid=this.subscriptionCount,n.type=e,n.elements=i,this.sub[this.subscriptionCount]=n,this.subscriptionCount++,this.listSent){var s;s=12+n.name.length;var o=new Uint8Array(s+10);o[0]=M,o[2]=255&this.next_id,o[3]=this.next_id>>8&255,o[4]=this.next_id>>16&255,o[5]=this.next_id>>24&255,this.debug&&console.log("RefObjectInfo: ",n.refid);var a=6;o[a++]=255&n.refid,o[a++]=n.refid>>8&255,o[a++]=n.refid>>16&255,o[a++]=n.refid>>24&255,o[a++]=255&n.elements,o[a++]=n.elements>>8&255,o[a++]=n.elements>>16&255,o[a++]=n.elements>>24&255,o[a++]=255&n.name.length,o[a++]=n.name.length>>8&255,o[a++]=n.name.length>>16&255,o[a++]=n.name.length>>24&255;for(var l=0;l<n.name.length;l++)o[a++]=n.name.charCodeAt(l);return this.pending[this.next_id]=new PendingData(this.refObjectInfoReply,null),this.debug&&console.log("Sending RefObjectInfo",this.next_id,s,a),this.ws.send(o),this.next_id++,n.refid}return n.refid},this.refObjectInfoReply=function(t,e){this.debug&&console.log("refObjectInfoReply",t,e)},this.unrefObjectInfo=function(t){var e=new Uint8Array(14);e[0]=D,e[2]=255&this.next_id,e[3]=this.next_id>>8&255,e[4]=this.next_id>>16&255,e[5]=this.next_id>>24&255,this.debug&&console.log("UnrefObjectInfo: ",t);var i=6;e[i++]=255&t,e[i++]=t>>8&255,e[i++]=t>>16&255,e[i++]=t>>24&255,this.pending[this.next_id]=new PendingData(this.unrefObjectInfoReply,null),this.debug&&console.log("Sending UnrefObjectInfo",this.next_id,4,10,t),this.ws.send(e),this.next_id++,delete this.sub[t]},this.refObjectInfoList=function(t){var e=0,i=0;for(var n in this.return_cb=t,this.sub)e+=12+this.sub[n].name.length,i++;var s=new Uint8Array(e+10);s[0]=L,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&i,s[7]=i>>8&255,s[8]=i>>16&255,s[9]=i>>24&255;var o=10;for(var n in this.sub)if(0!==n){this.debug&&console.log("RefObjectInfoList: ",this.sub[n].refid),s[o++]=255&this.sub[n].refid,s[o++]=this.sub[n].refid>>8&255,s[o++]=this.sub[n].refid>>16&255,s[o++]=this.sub[n].refid>>24&255,s[o++]=255&this.sub[n].elements,s[o++]=this.sub[n].elements>>8&255,s[o++]=this.sub[n].elements>>16&255,s[o++]=this.sub[n].elements>>24&255,s[o++]=255&this.sub[n].name.length,s[o++]=this.sub[n].name.length>>8&255,s[o++]=this.sub[n].name.length>>16&255,s[o++]=this.sub[n].name.length>>24&255;for(var a=0;a<this.sub[n].name.length;a++)s[o++]=this.sub[n].name.charCodeAt(a)}this.pending[this.next_id]=new PendingData(t,null),this.debug&&console.log("Sending RefObjectInfoList",this.next_id,e,o,this.next_id),this.ws.send(s),this.next_id++,this.listSent=!0},this.refObjectInfoListReply=function(t,e){this.debug&&console.log("refObjectInfoListReply",t,e)},this.getRefObjectInfoAll=function(t){var e=new Uint8Array(6);e[0]=G,e[2]=255&this.next_id,e[3]=this.next_id>>8&255,e[4]=this.next_id>>16&255,e[5]=this.next_id>>24&255,this.pending[this.next_id]=new PendingData(t,null),this.debug&&console.log("Sending getRefObjectInfoAll",this.next_id),this.ws.send(e),this.next_id++},this.getRefObjectInfoAllReply=function(t,e){this.debug&&console.log("getRefObjectInfoAllReply",t,e)},this.getObjectRefInfo=function(t){return this.debug&&console.log("getObjectRefInfo",t,this.sub[t].value),this.sub[t].value},this.setObjectInfoBoolean=function(t,e){var i=new Uint8Array(12+t.length);i[0]=I,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,i[10]=255&t.length,i[11]=t.length>>8&255;for(var n=12,s=0;s<t.length;s++)i[n++]=t.charCodeAt(s);return this.ws.send(i),this.debug&&console.log("Sending setObjectInfoBoolean",this.next_id,t,e),this.next_id++,new PwrtStatus(1)},this.setObjectInfoInt=function(t,e){var i=new Uint8Array(12+t.length);i[0]=k,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255,i[6]=255&e,i[7]=e>>8&255,i[8]=e>>16&255,i[9]=e>>24&255,i[10]=255&t.length,i[11]=t.length>>8&255;for(var n=12,s=0;s<t.length;s++)i[n++]=t.charCodeAt(s);return this.ws.send(i),this.debug&&console.log("Sending setObjectInfoInt",this.next_id,t,e),this.next_id++,new PwrtStatus(1)},this.setObjectInfoFloat=function(t,e){var i=new Uint8Array(12+t.length);i[0]=R,i[2]=255&this.next_id,i[3]=this.next_id>>8&255,i[4]=this.next_id>>16&255,i[5]=this.next_id>>24&255;var n=new ArrayBuffer(4);new Float32Array(n)[0]=e;var s=new Uint8Array(n);i[6]=s[0],i[7]=s[1],i[8]=s[2],i[9]=s[3],i[10]=255&t.length,i[11]=t.length>>8&255;for(var o=12,a=0;a<t.length;a++)i[o++]=t.charCodeAt(a);return this.ws.send(i),this.debug&&console.log("Sending setObjectInfoFloat",this.next_id,t,e),this.next_id++,new PwrtStatus(1)},this.setObjectInfoString=function(t,e){var i,n=new Uint8Array(10+e.length+t.length);n[0]=j,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&e.length,n[7]=e.length>>8&255;var s=8;for(i=0;i<e.length;i++)n[s++]=e.charCodeAt(i);for(n[s++]=255&t.length,n[s++]=t.length>>8&255,i=0;i<t.length;i++)n[s++]=t.charCodeAt(i);return this.ws.send(n),this.debug&&console.log("Sending setObjectInfoString",this.next_id,t,e),this.next_id++,new PwrtStatus(1)},this.toggleObjectInfo=function(t){var e=new Uint8Array(8+t.length);e[0]=Q,e[2]=255&this.next_id,e[3]=this.next_id>>8&255,e[4]=this.next_id>>16&255,e[5]=this.next_id>>24&255,e[6]=255&t.length,e[7]=t.length>>8&255;for(var i=8,n=0;n<t.length;n++)e[i++]=t.charCodeAt(n);return this.ws.send(e),this.debug&&console.log("Sending toggleObjectInfoBoolean",this.next_id,t,value),this.next_id++,new PwrtStatus(1)},this.getAllXttChildren=function(t,e,i){var n=new Uint8Array(14);n[0]=K,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t.vid,n[7]=t.vid>>8&255,n[8]=t.vid>>16&255,n[9]=t.vid>>24&255,n[10]=255&t.oix,n[11]=t.oix>>8&255,n[12]=t.oix>>16&255,n[13]=t.oix>>24&255,this.pending[this.next_id]=new PendingData(e,i),this.debug&&console.log("Sending getAllXttChildren",this.next_id),this.ws.send(n),this.next_id++},this.getAllClassAttributes=function(t,e,i,n){var s=new Uint8Array(18);s[0]=z,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&t,s[7]=t>>8&255,s[8]=t>>16&255,s[9]=t>>24&255,s[10]=255&e.vid,s[11]=e.vid>>8&255,s[12]=e.vid>>16&255,s[13]=e.vid>>24&255,s[14]=255&e.oix,s[15]=e.oix>>8&255,s[16]=e.oix>>16&255,s[17]=e.oix>>24&255,this.pending[this.next_id]=new PendingData(i,n),this.debug&&console.log("Sending getAllClassAttributes",this.next_id,t,e.vid,e.oix),this.ws.send(s),this.next_id++},this.getObject=function(t,e,i,n){var s=new Uint8Array(16);s[0]=q,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&e,s[7]=e>>8&255,s[8]=255&t.vid,s[9]=t.vid>>8&255,s[10]=t.vid>>16&255,s[11]=t.vid>>24&255,s[12]=255&t.oix,s[13]=t.oix>>8&255,s[14]=t.oix>>16&255,s[15]=t.oix>>24&255,this.pending[this.next_id]=new PendingData(i,n),this.debug&&console.log("Sending getObject",this.next_id,t.vid,t.oix),this.ws.send(s),this.next_id++},this.getObjectFromAref=function(t,e,i,n){var s=new Uint8Array(32);s[0]=tt,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&e,s[7]=e>>8&255,s[8]=255&t.objid.vid,s[9]=t.objid.vid>>8&255,s[10]=t.objid.vid>>16&255,s[11]=t.objid.vid>>24&255,s[12]=255&t.objid.oix,s[13]=t.objid.oix>>8&255,s[14]=t.objid.oix>>16&255,s[15]=t.objid.oix>>24&255,s[16]=255&t.offset,s[17]=t.offset>>8&255,s[18]=t.offset>>16&255,s[19]=t.offset>>24&255,s[20]=255&t.body,s[21]=t.body>>8&255,s[22]=t.body>>16&255,s[23]=t.body>>24&255,s[24]=255&t.size,s[25]=t.size>>8&255,s[26]=t.size>>16&255,s[27]=t.size>>24&255,s[28]=255&t.flags,s[29]=t.flags>>8&255,s[30]=t.flags>>16&255,s[31]=t.flags>>24&255,this.pending[this.next_id]=new PendingData(i,n),this.debug&&console.log("Sending getObject",this.next_id,oid.vid,oid.oix),this.ws.send(s),this.next_id++},this.getObjectFromName=function(t,e,i,n){var s=new Uint8Array(10+t.length);s[0]=H,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255,s[6]=255&e,s[7]=e>>8&255,s[8]=255&t.length,s[9]=t.length>>8&255;for(var o=10,a=0;a<t.length;a++)s[o++]=t.charCodeAt(a);this.pending[this.next_id]=new PendingData(i,n),this.debug&&console.log("Sending getObjectFromName",this.next_id,t),this.ws.send(s),this.next_id++},this.crrSignal=function(t,e,i){var n=new Uint8Array(14);n[0]=F,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t.vid,n[7]=t.vid>>8&255,n[8]=t.vid>>16&255,n[9]=t.vid>>24&255,n[10]=255&t.oix,n[11]=t.oix>>8&255,n[12]=t.oix>>16&255,n[13]=t.oix>>24&255,this.pending[this.next_id]=new PendingData(e,i),this.debug&&console.log("Sending crrObject",this.next_id,t.vid,t.oix),this.ws.send(n),this.next_id++},this.getOpwindMenu=function(t,e,i){t.length;var n=new Uint8Array(8+t.length);n[0]=J,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t.length,n[7]=t.length>>8&255;for(var s=8,o=0;o<t.length;o++)n[s++]=t.charCodeAt(o);this.pending[this.next_id]=new PendingData(e,i),this.debug&&console.log("Sending getOpwindMenu",this.next_id),this.ws.send(n),this.next_id++},this.login=function(t,e,i,n){var s=new Uint8Array(8+t.length+2+e.length);s[0]=Y,s[2]=255&this.next_id,s[3]=this.next_id>>8&255,s[4]=this.next_id>>16&255,s[5]=this.next_id>>24&255;var o=6;s[o]=255&t.length,s[o+1]=t.length>>8&255,o+=2;for(var a=0;a<t.length;a++)s[o++]=t.charCodeAt(a);s[o]=255&e.length,s[o+1]=e.length>>8&255,o+=2;for(a=0;a<e.length;a++)s[o++]=e.charCodeAt(a);this.pending[this.next_id]=new PendingData(i,n),this.debug&&console.log("Sending login",this.next_id),this.ws.send(s),this.next_id++},this.getMsg=function(t,e,i){var n=new Uint8Array(10);n[0]=X,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,this.pending[this.next_id]=new PendingData(e,i),this.ws.send(n),this.debug&&console.log("Sending getMsg",this.next_id,t),this.next_id++},this.mhSync=function(t,e,i){var n=new Uint8Array(10);n[0]=Z,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t,n[7]=t>>8&255,n[8]=t>>16&255,n[9]=t>>24&255,this.pending[this.next_id]=new PendingData(e,i),this.debug&&console.log("Sending mhSync",this.next_id),this.ws.send(n),this.next_id++},this.mhAcknowledge=function(t,e,i){var n=new Uint8Array(16+t.birthTime.length);n[0]=$,n[2]=255&this.next_id,n[3]=this.next_id>>8&255,n[4]=this.next_id>>16&255,n[5]=this.next_id>>24&255,n[6]=255&t.nix,n[7]=t.nix>>8&255,n[8]=t.nix>>16&255,n[9]=t.nix>>24&255,n[10]=255&t.idx,n[11]=t.idx>>8&255,n[12]=t.idx>>16&255,n[13]=t.idx>>24&255;var s=14;n[s]=255&t.birthTime.length,n[s+1]=t.birthTime.length>>8&255,s+=2;for(var o=0;o<t.birthTime.length;o++)n[s++]=t.birthTime.charCodeAt(o);this.pending[this.next_id]=new PendingData(e,i),this.debug&&console.log("Sending mhAcknowledge",this.next_id),console.log("Sending mhAcknowledge",this.next_id),this.ws.send(n),this.next_id++}}var Bitmaps={leaf:0,map:2,openmap:4,object:6,attrenum:8,attrarra:10,attrarel:12,attr:14,crrwrite:16,crrread:18,ack:20,alarm:22,eventacked:24,eventalarm:26,eventreturn:28,info:30,system:32,maintenance:34,blockl:36,blockr:38,img:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],pending:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],images:["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAASElEQVQokWP4jwMwMDBgYBR5XBpwGYZVIzYNGDZB+QyEFOBiM+CyCacGBI0hgEGjsxkYGCiwkSI/4tKMz0DqxCM2A4hOOcQCAObFEQyI2PpKAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAQUlEQVQokWNgYGD4jw1jA2hqsGvAZRhWjdg0oIsh8QkqwMXGbhMuDXAxdAFsNDobyifTRor8SFGoUhSPFKUcYjEAMsMz2y6w8kgAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAKElEQVQokWP4DwUMDAwYGB9gwKUQm0FoGL/JOGwb1TgINZKFSbYOCgD1JxQJG0vK9AAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAK0lEQVQokWNgYGD4z8DA8B8bgMlhxbgUEgIMBE3Ggkc1Dk6N5AAGUm2DYQAkYTDe0vu7CAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAQklEQVQokaXOwQ4AIAgCUP7/p+nUlpMSzY2bDwWHA5IEkFJCtaiKxE7dvsue8HZNJEPneoAuSq+OYAf9wy4K0Mk5C+d++RWimsw3AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAPUlEQVQokaXRQQoAQAgCQP//6brKZmSt0M2hIACI4yBURqiKXQp0ThuhGwmt7Vy00XvqCa7QN1wjhtYLCCYyCkvDVnkJOQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAH0lEQVQokWP4TyJgYGBg+E8iZiDFdHrZMKqBGA2kYAD8gaJsjwzf9wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAIklEQVQokWNgYGD4TxL+TyJg+P//P9GmwzXQ3oZRDdSOBwAGOSrkrXppgQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAPklEQVQokWP4////fwYGBgxMCDBgU4jNICyYsOlYbENoJNIW7BqJsYm2NuJyBVE2EqWRfjbiUoQ3oAgpwgUANLqccvbgec0AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAPElEQVQokWNgYGD4jw0wMDDgx9gUEgMYiDIdDaNoJBZg1UiUTTS1EZcriLKRKI30sxGXIgKBhF8RrqgBAOTOqGZ5aiCnAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAAMElEQVQokWP4////fwYGBgxMCDBgU4jNICwYv+nY5InWOGojXW0khLEahtc6PDYCAB9hxkjBPICvAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAMCAYAAABSgIzaAAAALUlEQVQokWNgYGD4jw0wMDDgx9gUEgMYCJmOTZ5ojaM20tVGQgCHK/AnLVwAAPonfpBwU5f4AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAIklEQVQokWP4////fwYGBpwYHTDANGADeDWM2jAEbSAFAADB26JsIjYj1AAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAIElEQVQokWNgYGD4jw8wMDCgYwZcEvg1jNowBG0gBQMAQN8q5COZl1cAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAIUlEQVQokWP4TyJgGIQaGBgY/pOIibcEroEkTLIfhoEGADzs8B5gcUg/AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAJUlEQVQokWNgYGD4TyIedBr+kwgY/v//T7TpcA0k2TAIQ4nmGgDFzt0jExR7hgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAN0lEQVQokaWNQQoAMAjD8v9P633WVWhBkJIotQQoYPYbrHYrqC9D+MG54OBMuMC54GApuPBed9OxiMNLGke1JwAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAANElEQVQokWNgYGD4jw3DABY57IqxsQlqwGELSYop1ECEYgo0EKmYQg1EKMbUQEAxRAMpAABRMgoFjbTzXgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAPElEQVQokWNgYGD4j4yRATY5BmyKkGks4qgS2BSj2UYFDdgAdW2gvpOwhDW6ItwaCGI8JuHWgMOtWD0PACufaaWhXDFDAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAPElEQVQokWP4jwYYGBjgGKscNkXINLo4hgZsipFto44GbJi6NlDfSehhjUxjyGMVxQMYcJmEVwPB5ICEAdcbY6vf9TVAAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAS0lEQVQokZ2Q2w4AIAhCz///ND11M3RVmxuDUBRAtw8QHRyC4SSJSDjDht1Yhxdudks+bFNxYsX9G6rz2qVHxqRspGi2Wpoji/dqaLh22DbO2VuXAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAASklEQVQokWP4////fwYGBqIwVC2cgSKBTQzKxhDA0ICmGau12BRCMLJp2BQgy8H9gM9ELGJkasAXvFg9TQjgDCVc8YBXAwFMmgYASkT1C9E5Ya0AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAARklEQVQokZ2QQQoAMAjD+v9Pu9PA1ThQQRBtoFUBJSkk0SlwOwKykCAEcn+BK8hih/aAe++y7IDuhWgXfcKHCuBBfX6ASR3Vn8ZINQzCrQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAQ0lEQVQokWNgYGD4j45hAJscA8UakBXi0ITddDy2YJqOrBiLJjI1oLsdj1/I0IAnCLFpwtSALYQwNKB7FJ2NooEUDAAtGwcI+Svs4gAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAL0lEQVQokWP4TyJgGCkaGBgQyhhwSeASw9CAYho2A3CZiE0xVg34FOPUgA+QrAEA1FYi+tWeG/cAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAMElEQVQokWNgYGD4TyIeGRr+//+PXQOaBC4xVElkBdgMwHASTBEOxdj9gEcxHYIVAC5kqlZXl5JMAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAJ0lEQVQokWP4jwMwMDBgF8elGIZHNeDSANOEVRyXBpwGUcUGqvoBAK+H8xt0qXFWAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAJ0lEQVQokWNgYGD4jw3///8fqzgDLsUwMKoBlwaSg5UAHoiIw2cDAFMz2iY65DAoAAAAAElFTkSuQmC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAASUlEQVQokZ2RUQoAIAjFdv9L11dhskeUEIQ2mcYIAXjeisA+EahFA9ad/siAA0wqSUsnu87wDZh3VEodO6Rr1c51rc8fd9OoMQHLk7dXak3qLwAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAR0lEQVQokZ2S2woAIAhD9/8/vV6tjgMNhLxMN1SSTGYb46JkfS2gJglQ/ncRAZ5JTCXQYsFRwxpAvFtKoeMvmoqDv1jc5DQONycV+bfOetgAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAOUlEQVQokWNgYGD4///////E0AwMDP8hPDQAk8QhjlMCuzg2G3AB6tlAez8MglAiCZNiw/////8DACmmtFrq9aGNAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAN0lEQVQokWP4////fwYGhv/E0FA2w390jCSJIc6ASwKnBmw24MLUs4H2fhgEoUQKIMkGBgaG/wDZFBj2pVi3HgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAN0lEQVQokWNgYGD4TyJm+E8sgGugig3YxHFqwGcIQQ3obAwN6G7GawMuhVg1EFKMUwM+QJ+IAwDD1Gyi1EZc6gAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAO0lEQVQokWP4TyJg+P///38GBgaiMFwDVWzAJo5TA15DCGnAYKNrwHAzPhtwKcSqgZBinBqIigeaRhwAPuZgrlZXy70AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAP0lEQVQokZWPQQoAMAzC8v9Pu8soDOxaBS82QkWNgPKTJ/BYsLekAOxfquwHWyfws6ED7OgtfNk9bAuTSGBJOufqnHIsmYkzAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAQUlEQVQokZWPQQ4AMAQE5/+f1kuTCkuROGAmADCVPsJsBfdCsX0u3N7sJFfXsAqW8BMaID+9gE3SJayEFo7CFwY7GtAw3ouVj50AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAQElEQVQokZ2QQQ4AMAjC+v9Pu9MWl5AJ42a0IlKBgCIadgGgQ8imqo9D3zDBvJoyR+zwlWHS9SUHaOf4QOywtQCQGucn0g2dEQAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAOklEQVQokWNgYGD4Tyz+////fwZSFBOtAaoQQsM46JLY+HAbUEwgrJmwyZTZQJYfSAolmsQDWTENwwByoOYaWbAqegAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAPElEQVQokWP4jwMwMDBgF8enAZsmvBqw2cSARQBDIQqbGEUoaggpQBcj3Qay/IAN4AwlfBrIigeiNeACADpU5yeYXn+XAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAPElEQVQokWNgYGD4jw3///8fqzgDPg04NOG3AUMTugA2hWhqiFKEzCeoAF2MRBvI8gNJoUT1eCBaAy4MAMhm5hr5iTaWAAAAAElFTkSuQmCC"]},Plow={DRAWOFFSET:2,DEST_INTOLAST:0,DEST_INTOFIRST:1,DEST_AFTER:2,DEST_BEFORE:3,TREE_INDENTATION:1,OPEN_ATTRIBUTES:1,OPEN_CHILDREN:2,OPEN_CROSSREFERENCES:4,OPEN_ALL:7,COLOR_BLACK:1,COLOR_RED:2,COLOR_GRAY:3,COLOR_DARKGRAY:4,COLOR_LIGHTGRAY:5,COLOR_WHITE:6,COLOR_YELLOW:7,COLOR_GREEN:8,COLOR_LIGHTBLUE:9,COLOR_BLUE:10,COLOR_VIOLET:11,eEvent_MB1Click:0,eEvent_MB1ClickShift:1,eEvent_Key_Up:2,eEvent_Key_Down:3,eEvent_Key_Right:4,eEvent_Key_Left:5,eEvent_Key_ShiftRight:6,eEvent_Key_CtrlR:7,eEvent_Key_CtrlL:8,eEvent_Key_CtrlG:9,eEvent_ObjectDeleted:10,RELATIVE_POSITION:1,NEXT_RELATIVE_POSITION:2};function PlowGeometry(){this.ll_x=0,this.ll_y=0,this.ur_x=0,this.ur_y=0}function PlowNodeClass(t){this.a=new PlowArray(t),this.ctx=t,this.nc_name="",this.group=0,this.node_open=0,this.draw=function(t,e,i,n){this.a.draw(t,e,i,n)},this.insert=function(t){this.a.add(t)}}function PlowArray(o){this.a=[],this.ctx=o,this.add=function(t){this.a.push(t)},this.insertNode=function(t,e,i){var n=this.find(t);if(-1==n)if(null==e)switch(i){case Plow.DEST_INTOLAST:case Plow.DEST_AFTER:this.a.push(t),t.level=0;break;default:t.level=0,this.a.unshift(t)}else{var s=this.find(e);if(-1==s)return;switch(i){case Plow.DEST_INTOFIRST:s==this.a.length-1?this.a.push(t):this.a.splice(s+1,0,t),t.level=e.level+1;break;case Plow.DEST_INTOLAST:if(s==this.a.length-1)this.a.push(t);else{n=this.a.length;for(var o=s+1;o<this.a.length;o++)if(this.a[o].level<=e.level){n=o;break}n==this.a.length?this.a.push(t):this.a.splice(n,0,t)}t.level=e.level+1;break;case Plow.DEST_AFTER:if(s==this.a.length-1)this.a.push(t);else{for(o=n;o<this.a.length&&!(this.a[o].level<e.level);o++);this.a.splice(o,0,t)}t.level=e.level;break;case Plow.DEST_BEFORE:0<n&&n--,this.a.splice(n,0,t),t.level=e.level}}},this.remove=function(t){var e=this.find(t);-1!=e&&(this.ctx.event_cb(Plow.eEvent_ObjectDeleted,this.a[e+1],0,0),this.a.splice(e,1))},this.size=function(){return this.a.length},this.get=function(t){return this.a[t]},this.draw=function(t,e,i,n){for(var s=0;s<this.a.length;s++)this.a[s].draw(t,e,i,n)},this.set_borders=function(t){for(var e=0;e<this.a.length;e++)this.a[e].set_borders(t)},this.configure=function(){for(var t=0;t<this.a.length;t++)this.a[t].pos.x=1*this.a[t].level,this.a[t].pos.y=1*t},this.close_node=function(t){var e=this.find(t);if(-1!=e){var i,n=t.level;for(i=e+1;i<this.a.length&&!(this.a[i].level<=n);i++);var s=i;if(s!=e+1)for(i=e+1;i<s;i++)o.select_object==this.a[e+1]&&(o.select_object=null),this.ctx.event_cb(Plow.eEvent_ObjectDeleted,this.a[e+1],0,0),this.a.splice(e+1,1)}},this.get_parent_object=function(t){var e=this.find(t);if(-1==e)return null;for(var i=e;0<=i;i--)if(this.a[i].level<t.level)return this.a[i];return null},this.get_first_child=function(t){var e=this.find(t);return-1==e?null:this.a.length==e-1?null:this.a[e+1].level>t.level?this.a[e+1]:null},this.get_next_sibling=function(t){for(var e=!1,i=0;i<this.a.length;i++)if(this.a[i]!=t){if(e){if(this.a[i].level==t.level)return this.a[i];if(this.a[i].level<t.level)return null}}else e=!0;return null},this.get_next_object=function(t){for(var e=0;e<this.a.length;e++)if(this.a[e]==t)return e==this.a.length-1?null:this.a[e+1];return null},this.get_previous_object=function(t){for(var e=0;e<this.a.length;e++)if(this.a[e]==t)return 0==e?null:this.a[e-1];return null},this.get_first_object=function(){return 0==this.a.length?null:this.a[0]},this.get_last_object=function(){return 0==this.a.length?null:this.a[this.a.length-1]},this.find=function(t){for(var e=0;e<this.a.length;e++)if(this.a[e]==t)return e;return-1}}function PlowNode(n,t,e){this.ctx=n,this.userdata=null,this.OFFSET=2,this.x_right=0,this.x_left=0,this.y_high=0,this.y_low=0,this.nc=t,this.pos=new PlowPoint(n,0,0),this.n_name="",this.annotv=[],this.annotsize=[],this.pixmapv=[],this.trace_object="",this.trace_attribute="",this.trace_attr_type=0,this.highlight=!1,this.select=!1,this.invert=!1,this.level=e,this.node_open=!1,this.fill_color=0,this.p=0,this.old_value=0,this.first_scan=!0,this.relative_position=0,this.set_annotation=function(t,e){10<=t||(this.annotv[t]=e)},this.set_annotation_pixmap=function(t,e){10<=t||(this.pixmapv[t]=e)},this.draw_object=function(){this.draw(this.ctx.gdraw.gctx,null,null,!1)},this.draw=function(t,e,i,n){var s=this.x_left*this.ctx.zoom_factor,o=this.y_low*this.ctx.zoom_factor-1,a=(this.x_right-this.x_left)*this.ctx.zoom_factor,l=(this.y_high-this.y_low)*this.ctx.zoom_factor+2;t.fillStyle="white",this.select&&(t.fillStyle="lightblue"),t.fillRect(s,o,a,l),this.nc.draw(t,this.pos,this,this.highlight)},this.connect=function(){if(""!=this.trace_object&&""!=this.trace_attribute){var t=this.trace_attribute.indexOf("#");-1!=t&&(this.trace_attribute=this.trace_attribute.substring(0,t));var e=this.trace_object+"."+this.trace_attribute;this.p=n.gdh.refObjectInfo(e,this.trace_attr_type),console.log("connecting",e,this.p)}},this.scan=function(){if(0!=this.p){var t=n.gdh.getRefObjectInfo(this.p);if(this.first_scan)this.first_scan=!1;else if(t==this.old_value)return;this.highlight=!!t,this.old_value=t,this.draw_object()}},this.set_borders=function(){this.x_left=1e37,this.x_right=-1e37,this.y_low=1e37,this.y_high=-1e37,t.a.set_borders(this)},this.event_handler=function(t,e,i){return(e-this.ctx.offset_x)/this.ctx.zoom_factor>=this.x_left&&(e-this.ctx.offset_x)/this.ctx.zoom_factor<=this.x_right&&(i-this.ctx.offset_y)/this.ctx.zoom_factor>=this.y_low&&(i-this.ctx.offset_y)/this.ctx.zoom_factor<=this.y_high?(n.event_object=this,1):0},this.set_select=function(t){t?(this.select=!0,this.ctx.select_object=this):(this.select=!1,this.ctx.select_object==this&&(this.ctx.select_object=null)),t!=this.select&&this.draw_object()},this.set_invert=function(t){this.invert=t,this.draw_object()},this.set_userdata=function(t){this.userdata=t},this.get_userdata=function(){return this.userdata},this.in_icon=function(t,e){return t>=this.x_left*this.ctx.zoom_factor&&t<=(this.x_left+1.75)*this.ctx.zoom_factor},this.measure=function(){var t=new PlowGeometry;return t.ll_x=this.x_left*this.ctx.zoom_factor,t.ll_y=this.y_low*this.ctx.zoom_factor,t.ur_x=this.x_right*this.ctx.zoom_factor,t.ur_y=this.y_high*this.ctx.zoom_factor,t}}function PlowPoint(t,e,i){this.x=e,this.y=i,this.ctx=t}function PlowAnnot(t,e,i,n,s,o,a){this.RELATIVE_OFFSET=1,this.p=new PlowPoint(t,e,i),this.draw_type=s,this.text_size=n,this.annot_type=o,this.number=a,this.ctx=t,this.draw=function(t,e,i,n){if(null!=i&&null!=i.annotv[this.number]){var s=0,o=this.ctx.zoom_factor/this.ctx.base_zoom_factor*(this.text_size+4)-4;if(!(o<0)){switch(o){case 0:s=8;break;case 1:s=10;break;case 2:s=12;break;case 3:case 4:s=14;break;case 5:case 6:case 7:s=18;break;default:s=3*o}t.font=s+"px Arial",i.invert?t.fillStyle="white":t.fillStyle="black",n&&(t.fillStyle="red"),t.lineWidth=.5;var a=(this.p.x+e.x)*this.ctx.zoom_factor,l=(this.p.y+e.y)*this.ctx.zoom_factor-s/4;if(0!=(this.annot_type&Plow.RELATIVE_POSITION)){var r=(e.x+i.relative_position+this.RELATIVE_OFFSET)*this.ctx.zoom_factor;a<r&&(a=r)}for(var h=i.annotv[this.number].split("\n"),A=0;A<h.length;A++)t.fillText(h[A],a,l),l+=1.4*s;0==(this.annot_type&Plow.NEXT_RELATIVE_POSITION)&&0==(this.annot_type&Plow.RELATIVE_POSITION)||(i.relative_position=(a+t.measureText(i.annotv[this.number]).width)/this.ctx.zoom_factor-e.x)}}},this.set_borders=function(t){}}function PlowAnnotPixmap(t,e,i,n){this.p=new PlowPoint(t,e,i),this.number=n,this.ctx=t,this.draw=function(e,t,i,n){var s,o=(this.p.x+t.x)*this.ctx.zoom_factor,a=(this.p.y+t.y)*this.ctx.zoom_factor,l=i.pixmapv[this.number];null!=l&&(i.invert&&l++,null==(s=Bitmaps.img[l])?((s=new Image).src=Bitmaps.images[l],Bitmaps.img[l]=s,Bitmaps.pending[l]=[],Bitmaps.pending[l].push(new PlowPoint(this.ctx,o,a)),s.onload=function(){for(var t=0;t<Bitmaps.pending[l].length;t++)e.drawImage(s,Bitmaps.pending[l][t].x,Bitmaps.pending[l][t].y);Bitmaps.pending[l]=null}):s.complete?e.drawImage(s,o,a):Bitmaps.pending[l].push(new PlowPoint(this.ctx,o,a)))},this.set_borders=function(t){}}function PlowRect(t,e,i,n,s,o,a,l,r){this.ll=new PlowPoint(t,e,i),this.ur=new PlowPoint(t,e+n,i+s),this.border_color=a,this.fill_color=o,this.fill=l,this.fix_color=r,this.ctx=t,this.draw=function(t,e,i,n){var s=(this.ll.x+e.x)*this.ctx.zoom_factor,o=(this.ll.y+e.y)*this.ctx.zoom_factor,a=(this.ur.x-this.ll.x)*this.ctx.zoom_factor,l=(this.ur.y-this.ll.y)*this.ctx.zoom_factor;switch(t.lineWidth=1,this.border_color){case Plow.COLOR_GRAY:t.strokeStyle="grey";break;case Plow.COLOR_RED:t.strokeStyle="red";break;case Plow.COLOR_WHITE:t.strokeStyle="white";break;default:t.strokeStyle="black"}if(n&&(t.strokeStyle="red"),t.strokeRect(s,o,a,l),this.fill){switch(this.fill_color){case Plow.COLOR_GRAY:t.fillStyle="grey";break;case Plow.COLOR_RED:t.fillStyle="red";break;case Plow.COLOR_YELLOW:t.fillStyle="yellow";break;case Plow.COLOR_GREEN:t.fillStyle="lightgreen";break;case Plow.COLOR_WHITE:i.invert?t.fillStyle="black":t.fillStyle="white";break;default:i.invert?t.fillStyle="white":t.fillStyle="black"}t.fillRect(s,o,a,l)}},this.set_borders=function(t){this.ll.x+t.pos.x<t.x_left&&(t.x_left=this.ll.x+t.pos.x),this.ur.x+t.pos.x>t.x_right&&(t.x_right=this.ur.x+t.pos.x),this.ll.y+t.pos.y<t.y_low&&(t.y_low=this.ll.y+t.pos.y),this.ur.y+t.pos.y>t.y_high&&(t.y_high=this.ur.y+t.pos.y)}}function GDraw(t){this.ctx=t,this.canvas=document.querySelector("canvas"),this.gctx=this.canvas.getContext("2d"),this.offset_top=this.canvas.offsetTop}function PlowCtx(){this.gdh=0,this.debug=!1,this.nodraw=0,this.zoom_factor=20,this.base_zoom_factor=20,this.offset_x=0,this.offset_y=0,this.x_right=0,this.x_left=0,this.y_high=0,this.y_low=0,this.a=new PlowArray(this),this.a_nc=new PlowArray(this),this.name="Claes context",this.gdraw=new GDraw(this),this.selct_object=null,this.event_cb=null,this.event_object=null,this.draw=function(){0<this.nodraw||(this.gdraw.gctx.fillStyle="white",this.gdraw.gctx.fillRect(0,0,this.gdraw.canvas.width,this.gdraw.canvas.height),this.a.draw(this.gdraw.gctx,null,null,!1))},this.connect=function(){for(var t=0;t<this.a.size();t++)this.a.get(t).connect()},this.scan=function(){console.log("ctx scan",this.a.size());for(var t=0;t<this.a.size();t++)this.a.get(t).scan()},this.set_nodraw=function(){this.nodraw++},this.reset_nodraw=function(){this.nodraw--},this.size=function(){return this.a.size()},this.event_handler=function(t,e,i){var n=0;switch(t){case Plow.eEvent_MB1Click:case Plow.eEvent_MB1ClickShift:for(var s=0;s<this.a.size()&&!(this.a.get(s)instanceof PlowNode&&1==(n=this.a.get(s).event_handler(t,e,i)));s++);1==n&&(this.event_cb(t,this.event_object,e,i),this.draw());break;case Plow.eEvent_Key_Up:case Plow.eEvent_Key_Down:case Plow.eEvent_Key_Left:case Plow.eEvent_Key_Right:case Plow.eEvent_Key_ShiftRight:case Plow.eEvent_Key_CtrlR:case Plow.eEvent_Key_CtrlL:case Plow.eEvent_Key_CtrlG:this.event_cb(t,null,0,0)}},this.set_select=function(t){for(var e=0;e<this.a.size();e++)this.a.get(e)instanceof PlowNode&&this.a.get(e).set_select(t)},this.set_invert=function(t){for(var e=0;e<this.a.size();e++)this.a.get(e)instanceof PlowNode&&this.a.get(e).set_invert(t)},this.get_select=function(){return this.select_object},this.insert=function(t,e){this.a.add(t)},this.insertNode=function(t,e,i){this.a.insertNode(t,e,i)},this.remove=function(t){this.select_object==t&&(this.select_object=null),this.a.remove(t)},this.insert_nc=function(t){this.a_nc.add(t)},this.configure=function(){this.a.configure(),this.a.set_borders();var t=1*this.a.a.length*this.zoom_factor;this.gdraw.canvas.height=t},this.get_parent_object=function(t){return this.a.get_parent_object(t)},this.get_next_object=function(t){return this.a.get_next_object(t)},this.get_last_object=function(){return this.a.get_last_object()},this.get_first_object=function(){return this.a.get_first_object()},this.get_previous_object=function(t){return this.a.get_previous_object(t)},this.close_node=function(t){this.a.close_node(t)},this.is_visible=function(t){return t.y_high*this.zoom_factor<=window.pageYOffset+window.innerHeight-this.gdraw.offset_top&&t.y_low*this.zoom_factor>=window.pageYOffset-this.gdraw.offset_top},this.scroll=function(t,e){window.scrollTo(window.scrollX,t*this.zoom_factor-window.innerHeight*e+this.gdraw.offset_top)}}function XttOpenChildrenData(t,e){this.node=t,this.open_next=e}function Xtt(){this.ctx=null,this.ncObject=null,this.scan_update,this.priv=0;var A=this;this.init=function(){this.priv=sessionStorage.getItem("pwr_privilege"),console.log("pwr_privilege",this.priv),this.methods_init(),this.ctx=new PlowCtx,this.ctx.event_cb=this.plow_event,this.createNodeClasses(),this.ctx.gdh=new Gdh,this.ctx.gdh.open_cb=this.gdh_init_cb,this.ctx.gdh.init(),this.ctx.gdraw.canvas.addEventListener("click",function(t){var e=t.pageY-A.ctx.gdraw.offset_top,i=t.pageX;t.shiftKey?xtt.ctx.event_handler(Plow.eEvent_MB1ClickShift,i,e):xtt.ctx.event_handler(Plow.eEvent_MB1Click,i,e)}),document.addEventListener("keydown",function(t){40==t.keyCode?(A.ctx.event_handler(Plow.eEvent_Key_Down),t.preventDefault()):39==t.keyCode?(t.shiftKey?A.ctx.event_handler(Plow.eEvent_Key_ShiftRight):A.ctx.event_handler(Plow.eEvent_Key_Right),t.preventDefault()):37==t.keyCode?(A.ctx.event_handler(Plow.eEvent_Key_Left),t.preventDefault()):38==t.keyCode?(A.ctx.event_handler(Plow.eEvent_Key_Up),t.preventDefault()):82==t.keyCode?(t.ctrlKey&&A.ctx.event_handler(Plow.eEvent_Key_CtrlR),t.preventDefault()):76==t.keyCode?(t.ctrlKey&&A.ctx.event_handler(Plow.eEvent_Key_CtrlL),t.preventDefault()):71==t.keyCode&&(t.ctrlKey&&A.ctx.event_handler(Plow.eEvent_Key_CtrlG),t.preventDefault())}),document.getElementById("toolitem1").addEventListener("click",function(t){var e=A.ctx.get_select();if(e.userdata instanceof XttItemObject){var i=window.open("","_blank");A.ctx.gdh.getObject(e.userdata.objid,GdhOp.GET_OP_METHOD_GRAPH,A.open_graph_cb,i)}console.log("toolitem1 event")}),document.getElementById("toolitem2").addEventListener("click",function(t){var e=A.ctx.get_select();if(e.userdata instanceof XttItemObject){var i=window.open("","_blank");A.ctx.gdh.getObject(e.userdata.objid,GdhOp.GET_OP_METHOD_OBJECTGRAPH,A.open_objectgraph_cb,i)}console.log("toolitem2 event")}),document.getElementById("toolitem3").addEventListener("click",function(t){console.log("toolitem1 event");var e=A.ctx.get_select();if(e.userdata instanceof XttItemObject){var i=window.open("","_blank");A.ctx.gdh.getObject(e.userdata.objid,GdhOp.GET_OP_METHOD_PLC,A.open_plc_cb,i)}else if(e.userdata instanceof XttItemCrr){var n=e.userdata.name.lastIndexOf("-"),s="";-1!=n&&(s="&obj="+e.userdata.name.substring(n+1)),console.log("flow.html?vid="+e.userdata.objid.vid+"&oix="+e.userdata.objid.oix+s),window.open("flow.html?vid="+e.userdata.objid.vid+"&oix="+e.userdata.objid.oix+s)}console.log("toolitem3 event")}),document.getElementById("toolitem4").addEventListener("click",function(t){console.log("toolitem4 event")}),document.getElementById("toolitem5").addEventListener("click",function(t){console.log("toolitem5 event");var e=A.ctx.get_select();null!=e&&e.userdata.open_attributes(A)}),document.getElementById("toolitem6").addEventListener("click",function(t){var e=A.ctx.get_select();A.ctx.gdh.crrSignal(e.userdata.objid,A.open_crr_cb,e),console.log("toolitem6 event")}),document.getElementById("toolitem7").addEventListener("click",function(t){console.log("toolitem7 event")}),document.getElementById("toolitem8").addEventListener("click",function(t){console.log("toolitem8 event");var e=A.ctx.get_select();if(null!=e&&e.userdata instanceof XttItemObject){var i=window.open("","_blank");A.ctx.gdh.getObject(e.userdata.objid,GdhOp.GET_OP_METHOD_HELPCLASS,A.open_helpclass_cb,i)}}),window.addEventListener("storage",function(t){""!=t.newValue&&(localStorage.setItem("XttMethodNavigator",""),A.display_object(t.newValue))})},this.is_authorized=function(t){return!!(this.priv&t)},this.gdh_init_cb=function(){null==A.priv&&A.ctx.gdh.login("","",A.login_cb,A);var t=new PwrtObjid(0,0);A.ctx.gdh.getAllXttChildren(t,A.open_children_cb,new XttOpenChildrenData(null,null)),A.ctx.gdh.listSent=!0,A.trace_cyclic()},this.login_cb=function(t,e,i,n){console.log("Login:",i,n),A.priv=1&i?n:0},this.open_children_cb=function(t,e,i,n){A.ctx.set_nodraw();for(var s=0;s<n.length;s++)null==e.node?(n[s].full_name=n[s].name,new XttItemObject(A,n[s],null,Plow.DEST_AFTER)):(n[s].full_name=e.node.userdata.full_name+"-"+n[s].name,new XttItemObject(A,n[s],e.node,Plow.DEST_INTOLAST));if(A.ctx.configure(),null!=e.open_next){if(0==e.open_next.length)return void A.ctx.reset_nodraw();for(var o=A.ctx.a.get_first_child(e.node);null!=o;){if(o.userdata.name==e.open_next[0]){1==e.open_next.length?(o.set_select(!0),o.set_invert(!0),A.ctx.is_visible(o)||A.ctx.scroll(o.y_low,.5),window.focus()):(e.open_next.splice(0,1),"."==e.open_next[0]?(e.open_next.splice(0,1),o.userdata.open_attributes(A,e.open_next)):o.userdata.open_children(A,e.open_next));break}o=A.ctx.a.get_next_sibling(o)}}A.ctx.reset_nodraw(),A.ctx.draw()},this.open_attributes_cb=function(t,e,i,n){A.ctx.set_nodraw();for(var s=0;s<n.length;s++)n[s].objid=e.node.userdata.objid,n[s].full_name=e.node.userdata.full_name+"."+n[s].name,0!=(n[s].flags&Pwr.mAdef_array)?new XttItemAttrArray(A,n[s],e.node,Plow.DEST_INTOLAST):0!=(n[s].flags&Pwr.mAdef_class)?new XttItemAttrObject(A,n[s],e.node,Plow.DEST_INTOLAST):new XttItemAttr(A,n[s],e.node,Plow.DEST_INTOLAST);if(A.ctx.configure(),null!=e.open_next){if(0==e.open_next.length)return void A.ctx.reset_nodraw();for(var o=A.ctx.a.get_first_child(e.node);null!=o;){if(o.userdata.name==e.open_next[0]){1==e.open_next.length?(o.set_select(!0),o.set_invert(!0),A.ctx.is_visible(o)||A.ctx.scroll(o.y_low,.5),window.focus()):(e.open_next.splice(0,1),o.userdata.open_attributes(A,e.open_next));break}o=A.ctx.a.get_next_sibling(o)}}A.ctx.reset_nodraw(),A.ctx.draw()},this.open_plc_cb=function(t,e,i,n){var s;0!=(1&i)?(s=""!==n.param1?"&obj="+n.param1:"",console.log("flow.html?vid="+n.objid.vid+"&oix="+n.objid.oix+s),e.location.href="flow.html?vid="+n.objid.vid+"&oix="+n.objid.oix+s,e.document.title="Trace "+n.fullname):e.document.write("Error status "+i)},this.open_objectgraph_cb=function(t,e,i,n){0!=(1&i)?(e.location.href="ge.html?graph="+n.param1+"&instance="+n.fullname,e.document.title=n.fullname):e.document.write("Error status "+i)},this.open_graph_cb=function(t,e,i,n){if(0!=(1&i)){var s=n.param1.indexOf(".");-1!=s&&(n.param1=n.param1.substring(0,s));var o="";""!==n.fullname&&(o="&instance="+n.fullname),e.location.href="ge.html?graph="+n.param1+o,e.document.title=n.param1}else e.document.write("Error status "+i)},this.open_crr_cb=function(t,e,i,n){0!=(1&i)&&e.userdata.open_crossreferences(A,n)},this.open_helpclass_cb=function(t,e,i,n){if(0!=(1&i)){console.log("open_helpclass",n.param1);var s=location.protocol+"//"+location.host+n.param1;e.location.href=s}else e.document.write("Error status "+i)},this.plow_event=function(t,e,i,n){var s=null;switch(null!=e&&(s=e.get_userdata()),t){case Plow.eEvent_ObjectDeleted:e.userdata instanceof XttItemAttr&&e.userdata.scan_close(A);break;case Plow.eEvent_MB1Click:e.in_icon(i,n)?s.open_children(A,null):e.select?(e.set_select(!1),e.set_invert(!1)):(A.ctx.set_select(!1),e.set_select(!0),A.ctx.set_invert(!1),e.set_invert(!0),A.ctx.draw());break;case Plow.eEvent_MB1ClickShift:e.in_icon(i,n)&&s.open_attributes(A,null);break;case Plow.eEvent_Key_Down:if(null!=(h=A.ctx.get_select()))null!=(o=A.ctx.get_next_object(h))&&(h.set_select(!1),h.set_invert(!1),o.set_select(!0),o.set_invert(!0),A.ctx.is_visible(o)||A.ctx.scroll(o.y_low,.1));else(h=A.ctx.a.a[0]).set_select(!0),h.set_invert(!0);break;case Plow.eEvent_Key_Up:var o;if(null!=(h=A.ctx.get_select()))null!=(o=A.ctx.get_previous_object(h))&&(h.set_select(!1),h.set_invert(!1),o.set_select(!0),o.set_invert(!0),h.draw(A.ctx.gdraw.gctx,null,null,0),o.draw(A.ctx.gdraw.gctx,null,null,0),A.ctx.is_visible(o)||A.ctx.scroll(o.y_low,.9));break;case Plow.eEvent_Key_Right:null!=(h=A.ctx.get_select())&&(s=h.userdata).open_children(A,null);break;case Plow.eEvent_Key_Left:null!=(h=A.ctx.get_select())&&(s=h.userdata).close(A);break;case Plow.eEvent_Key_ShiftRight:null!=(h=A.ctx.get_select())&&(s=h.userdata).open_attributes(A,null);break;case Plow.eEvent_Key_CtrlR:null!=(h=A.ctx.get_select())&&A.ctx.gdh.crrSignal(h.userdata.objid,A.open_crr_cb,h);break;case Plow.eEvent_Key_CtrlL:if((h=A.ctx.get_select()).userdata instanceof XttItemObject){var a=window.open("","_blank");A.ctx.gdh.getObject(h.userdata.objid,GdhOp.GET_OP_METHOD_PLC,A.open_plc_cb,a)}else if(h.userdata instanceof XttItemCrr){var l=h.userdata.name.lastIndexOf("-"),r="";-1!=l&&(r="&obj="+h.userdata.name.substring(l+1)),window.open("flow.html?vid="+h.userdata.objid.vid+"&oix="+h.userdata.objid.oix+r)}break;case Plow.eEvent_Key_CtrlG:var h;if((h=A.ctx.get_select()).userdata instanceof XttItemObject){console.log("CtrlG",h.userdata.objid.vid,h.userdata.objid.oix);a=window.open("","_blank");A.ctx.gdh.getObject(h.userdata.objid,GdhOp.GET_OP_METHOD_OBJECTGRAPH,A.open_objectgraph_cb,a)}}},this.createNodeClasses=function(){var t=new PlowRect(this.ctx,0,0,50,1,Plow.COLOR_WHITE,Plow.COLOR_WHITE,!0,!1),e=new PlowAnnot(this.ctx,3,.9,4,Plow.COLOR_BLACK,Plow.NEXT_RELATIVE_POSITION,0),i=new PlowAnnot(this.ctx,7.5,.9,4,Plow.COLOR_BLACK,Plow.RELATIVE_POSITION,1),n=new PlowAnnot(this.ctx,12,.9,4,Plow.COLOR_BLACK,Plow.RELATIVE_POSITION,2),s=new PlowAnnotPixmap(this.ctx,.4,.2,0);this.ncObject=new PlowNodeClass(this.ctx),this.ncObject.insert(t),this.ncObject.insert(e),this.ncObject.insert(i),this.ncObject.insert(n),this.ncObject.insert(s),this.ctx.insert_nc(this.ncObject)},this.methods_init=function(){localStorage.setItem("XttMethodNavigator","")},this.collapse=function(){this.ctx.set_nodraw();for(var t=0;t<this.ctx.a.size();t++){var e=this.ctx.a.get(t);0==e.level&&e.userdata.close(this)}this.ctx.reset_nodraw(),this.ctx.draw()},this.display_object=function(t){var e,i=t.indexOf("."),n=null;if(-1!=i){n=t.substring(i+1);var s=(t=t.substring(0,i)).split("-"),o=n.split(".");for(e=new Array(s.length+o.length+1),a=0;a<s.length;a++)e[a]=s[a];for(e[s.length]=".",a=0;a<o.length;a++)e[a+s.length+1]=o[a]}else e=t.split("-");this.collapse();for(var a=0;a<this.ctx.a.size();a++)if(this.ctx.a.get(a).userdata.name==e[0]){if(a==this.ctx.a.size()-1){var l=this.ctx.a.get(a);l.set_select(!0),l.set_invert(!0),this.ctx.is_visible(l)||this.ctx.scroll(l.y_low,.5),window.focus()}else e.splice(0,1),this.ctx.a.get(a).userdata.open_children(this,e);break}},this.trace_cyclic=function(){A.ctx.gdh.getRefObjectInfoAll(A.trace_scan)},this.trace_scan=function(t,e){A.scan_update=!1;for(var i=0;i<A.ctx.a.size();i++){var n=A.ctx.a.get(i).userdata;n instanceof XttItemAttr&&n.scan(A)}A.scan_update&&A.ctx.draw(),A.timer=setTimeout(A.trace_cyclic,1e3)},this.openValueInputDialog=function(t,e){if(console.log("priv acc",this.priv,Pwr.mAccess_RtWrite|Pwr.mAccess_System),this.is_authorized(Pwr.mAccess_RtWrite|Pwr.mAccess_System)){var i=prompt(e,"");null!==i&&t.set_value(this,i)}else alert("Not authorized for this operation")}}function XttItemObject(t,e,i,n){this.objid=e.objid,this.cid=e.cid,this.name=e.name,this.full_name=e.full_name,this.has_children=e.has_children,this.node=new PlowNode(t.ctx,t.ncObject,0),this.node.set_userdata(this),this.node.set_annotation(0,e.name),this.node.set_annotation(1,e.classname),this.node.set_annotation(2,e.description),this.node.set_annotation_pixmap(0,Bitmaps.map),t.ctx.insertNode(this.node,i,n),e.has_children?this.node.set_annotation_pixmap(0,Bitmaps.map):this.node.set_annotation_pixmap(0,Bitmaps.leaf),this.open_children=function(t,e){0!=this.node.node_open?this.close(t):this.has_children?(t.ctx.gdh.getAllXttChildren(this.objid,t.open_children_cb,new XttOpenChildrenData(this.node,e)),this.node.node_open|=Plow.OPEN_CHILDREN,this.node.set_annotation_pixmap(0,Bitmaps.openmap)):this.open_attributes(t,null)},this.open_attributes=function(t,e){0!=this.node.node_open?this.close(t):(t.ctx.gdh.getAllClassAttributes(this.cid,this.objid,t.open_attributes_cb,new XttOpenChildrenData(this.node,e)),this.node.node_open|=Plow.OPEN_ATTRIBUTES,t.ctx.configure(),t.ctx.draw())},this.open_crossreferences=function(t,e){if(0!=this.node.node_open)this.close(t);else{for(var i=0;i<e.length;i++)new XttItemCrr(t,e[i],this.node,Plow.DEST_INTOLAST);this.node.node_open|=Plow.OPEN_CROSSREFERENCES,t.ctx.configure(),t.ctx.draw()}},this.close=function(t){if(this.node.node_open&Plow.OPEN_CHILDREN)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_CHILDREN,this.node.set_annotation_pixmap(0,Bitmaps.map),t.ctx.configure(),t.ctx.draw();else if(this.node.node_open&Plow.OPEN_ATTRIBUTES)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_ATTRIBUTES,t.ctx.configure(),t.ctx.draw();else if(this.node.node_open&Plow.OPEN_CROSSREFERENCES)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_CROSSREFERENCES,t.ctx.configure(),t.ctx.draw();else{var e=t.ctx.get_parent_object(this.node);null!=e&&(e.userdata.close(t),e.set_select(!0),e.set_invert(!0))}}}function XttItemAttr(t,e,i,n){this.name=e.name,this.objid=e.objid,this.full_name=e.full_name,this.type=e.type,this.flags=e.flags,this.size=e.size,this.refid,this.firstScan=!0,this.old_value,this.node=new PlowNode(t.ctx,t.ncObject,0),this.node.set_userdata(this),this.node.set_annotation(0,this.name),this.node.set_annotation_pixmap(0,Bitmaps.attr),t.ctx.insertNode(this.node,i,n),this.refid=t.ctx.gdh.refObjectInfo(this.full_name,e.type,1),this.open_children=function(t,e){t.openValueInputDialog(this,"Enter value")},this.set_value=function(t,e){switch(this.type){case Pwr.eType_Float32:var i=parseFloat(e.trim());t.ctx.gdh.setObjectInfoFloat(this.full_name,i);break;case Pwr.eType_Int8:case Pwr.eType_Int16:case Pwr.eType_Int32:case Pwr.eType_UInt8:case Pwr.eType_UInt16:case Pwr.eType_UInt32:case Pwr.eType_Status:case Pwr.eType_Mask:case Pwr.eType_Enum:case Pwr.eType_Boolean:i=parseInt(e.trim(),10);t.ctx.gdh.setObjectInfoInt(this.full_name,i);break;case Pwr.eType_String:case Pwr.eType_Time:case Pwr.eType_DeltaTime:case Pwr.eType_AttrRef:case Pwr.eType_Objid:t.ctx.gdh.setObjectInfoString(this.full_name,e)}},this.open_attributes=function(t,e){},this.close=function(t){var e=t.ctx.get_parent_object(this.node);null!=e&&(e.userdata.close(t),e.set_select(!0),e.set_invert(!0))},this.scan=function(t){if(this.refid){var e=t.ctx.gdh.getObjectRefInfo(this.refid);if(this.firstScan||e!=this.old_value){var i;switch(this.type){case Pwr.eType_Float32:i=""+e;break;case Pwr.eType_Boolean:i=e?"1":"0";break;case Pwr.eType_Int32:case Pwr.eType_Int16:case Pwr.eType_Int8:case Pwr.eType_UInt32:case Pwr.eType_UInt16:case Pwr.eType_UInt8:i=""+e;break;case Pwr.eType_String:case Pwr.eType_AttrRef:case Pwr.eType_Objid:i=e;break;default:i=""+e}this.old_value=e,this.node.set_annotation(1,i),t.scan_update=!0}this.firstScan=!1}},this.scan_close=function(t){t.ctx.gdh.unrefObjectInfo(this.refid)}}function XttItemAttrArray(t,e,i,n){this.name=e.name,this.objid=e.objid,this.full_name=e.full_name,this.type=e.type,this.flags=e.flags,this.size=e.size,this.elements=e.elements,this.node=new PlowNode(t.ctx,t.ncObject,0),this.node.set_userdata(this),this.node.set_annotation(0,this.name),this.node.set_annotation_pixmap(0,Bitmaps.attrarra),t.ctx.insertNode(this.node,i,n),this.open_children=function(t,e){this.open_attributes(t,e)},this.open_attributes=function(t,e){var i=new AttributeInfo;i.objid=this.objid,i.type=this.type,i.flags=this.flags&~Pwr.mAdef_array,i.size=this.size/this.elements,i.elements=1,i.name="",i.full_name="",i.classname="",t.ctx.set_nodraw();for(var n=0;n<this.elements;n++)i.name=this.name+"["+n+"]",i.full_name=this.full_name+"["+n+"]",0!=(i.flags&Pwr.mAdef_array)?new XttItemAttrArray(t,i,this.node,Plow.DEST_INTOLAST):0!=(i.flags&Pwr.mAdef_class)?new XttItemAttrObject(t,i,this.node,Plow.DEST_INTOLAST):new XttItemAttr(t,i,this.node,Plow.DEST_INTOLAST);this.node.node_open|=Plow.OPEN_ATTRIBUTES,t.ctx.configure(),t.ctx.reset_nodraw(),t.ctx.draw()},this.close=function(t){if(this.node.node_open&Plow.OPEN_ATTRIBUTES)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_ATTRIBUTES,t.ctx.configure(),t.ctx.draw();else{var e=t.ctx.get_parent_object(this.node);null!=e&&(e.userdata.close(t),e.set_select(!0),e.set_invert(!0))}}}function XttItemAttrObject(t,e,i,n){this.name=e.name,this.classname=e.classname,this.objid=e.objid,this.full_name=e.full_name,this.cid=e.type,this.flags=e.flags,this.size=e.size,this.node=new PlowNode(t.ctx,t.ncObject,0),this.node.set_userdata(this),this.node.set_annotation(0,this.name),this.node.set_annotation(1,this.classname),this.node.set_annotation_pixmap(0,Bitmaps.object),t.ctx.insertNode(this.node,i,n),this.open_children=function(t,e){this.open_attributes(t,null)},this.open_attributes=function(t,e){0!=this.node.node_open?this.close(t):(t.ctx.gdh.getAllClassAttributes(this.cid,this.objid,t.open_attributes_cb,new XttOpenChildrenData(this.node,e)),this.node.node_open|=Plow.OPEN_ATTRIBUTES)},this.close=function(t){if(this.node.node_open&Plow.OPEN_ATTRIBUTES)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_ATTRIBUTES,t.ctx.configure(),t.ctx.draw();else if(this.node.node_open&Plow.OPEN_CROSSREFERENCES)t.ctx.close_node(this.node),this.node.node_open&=~Plow.OPEN_CROSSREFERENCES,t.ctx.configure(),t.ctx.draw();else{var e=t.ctx.get_parent_object(this.node);null!=e&&(e.userdata.close(t),e.set_select(!0),e.set_invert(!0))}}}function XttItemCrr(t,e,i,n){switch(this.name=e.name,this.classname=e.classname,this.objid=e.objid,this.type=e.type,this.node=new PlowNode(t.ctx,t.ncObject,0),this.node.set_userdata(this),this.node.set_annotation(0,this.name),this.node.set_annotation(1,this.classname),this.type){case 0:this.node.set_annotation_pixmap(0,Bitmaps.crrread);break;case 1:case 2:this.node.set_annotation_pixmap(0,Bitmaps.crrwrite)}t.ctx.insertNode(this.node,i,n),this.close=function(t){var e=t.ctx.get_parent_object(this.node);null!=e&&(e.userdata.close(t),e.set_select(!0),e.set_invert(!0))}}var xtt=new Xtt;xtt.init();