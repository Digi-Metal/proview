

#include <iostream.h>
#include <fstream.h>
#include <float.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>
#include "cnv_classread.h"
extern "C" {
#include "pwr.h"
#include "co_cdh.h"
}


int ClassRead::html_init( char *first)
{
  char fname[200];
  char allclasses_name[80];

  strcpy( html_first, volume_name);
  strcat( html_first, "_");
  strcat( html_first, first);
  cdh_ToLower( html_first, html_first);

  strcpy( allclasses_name, volume_name);
  strcat( allclasses_name, "_allclasses.html");
  cdh_ToLower( allclasses_name, allclasses_name);

  // Create index file
  strcpy( fname, dir);
  strcat( fname, volume_name);
  strcat( fname, "_index.html");
  cdh_ToLower( fname, fname);
  fp_html_index.open( fname);

  fp_html_index <<
"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\"\"http://www.w3.org/TR/REC-html40/loose.dtd>" << endl <<
"<!--NewPage-->" << endl <<
"<HTML>" << endl <<
"<HEAD>" << endl <<
"<!-- Generated by co_convert.-->" << endl <<
"<TITLE>" << endl <<
"Generated Documentation (Untitled)" << endl <<
"</TITLE>" << endl <<
"</HEAD>" << endl <<
"<FRAMESET cols=\"20%,80%\">" << endl <<
"<FRAME src=\"" << allclasses_name << "\" name=\"packageFrame\">" << endl <<
"<FRAME src=\"" << html_first << ".html\" name=\"classFrame\">" << endl <<
"</FRAMESET>" << endl <<
"<NOFRAMES>" << endl <<
"<H2>" << endl <<
"Frame Alert</H2>" << endl <<

"<P>" << endl <<
"This document is designed to be viewed using the frames feature. If you see this message, you are using a non-frame-capable web client." << endl <<
"<BR>" << endl <<
"Link to <A HREF=\"" << html_first << ".html\">Non-frame version.</A></NOFRAMES>" << endl <<
"</HTML>" << endl;

  fp_html_index.close();

  // Open allclasses file
  strcpy( fname, dir);
  strcat( fname, allclasses_name);
  cdh_ToLower( fname, fname);
  fp_html_index.open( fname);


  html_index_open = 1;

  fp_html_index <<
"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Frameset//EN\"\"http://www.w3.org/TR/REC-html40/frameset.dtd\">" << endl <<
"<!--NewPage-->" << endl <<
"<HTML>" << endl <<
"<HEAD>" << endl <<
"<!-- Generated by wbdoc on... -->" << endl <<
"<TITLE>" << endl <<
"All Classes" << endl <<
"</TITLE>" << endl <<
"<LINK REL =\"stylesheet\" TYPE=\"text/css\" HREF=\"stylesheet.css\" TITLE=\"Style\">" << endl <<
"</HEAD>" << endl <<
"<BODY BGCOLOR=\"white\">" << endl <<
"<FONT size=\"+1\" CLASS=\"FrameHeadingFont\">" << endl <<
"<B>All Classes</B></FONT>" << endl <<
"<BR>" << endl <<
"" << endl <<
"<TABLE BORDER=\"0\" WIDTH=\"100%\">" << endl <<
"<TR>" << endl <<
"<TD NOWRAP><FONT CLASS=\"FrameItemFont\">  " << endl;

  return 1;
}

int ClassRead::html_close()
{

  fp_html_index <<
"</FONT></TD>" << endl <<
"</TR>" << endl <<
"</TABLE>" << endl <<
"" << endl <<
"</BODY>" << endl <<
"</HTML>" << endl;
  fp_html_index.close();

  return 1;
}

int ClassRead::html_class()
{
  char fname[200];
  int i;
  char html_file_name[80];
  char full_class_name[80];
  char ref_name[200];
  char struct_file[100];
  char low_volume_name[80];
  char low_class_name[80];

  cdh_ToLower( low_volume_name, volume_name);
  cdh_ToLower( low_class_name, class_name);

  struct_get_filename( fname);
  src_filename_to_html( struct_file, fname);

  strcpy( full_class_name, volume_name);
  strcat( full_class_name, ":");
  strcat( full_class_name, class_name);

  strcpy( html_file_name, low_volume_name);
  strcat( html_file_name, "_");
  strcat( html_file_name, low_class_name);

  // Add into index file
  fp_html_index <<
"<A HREF=\"" << html_file_name << ".html\" TARGET=\"classFrame\">" << class_name << "</A>" << endl <<
"<BR>" << endl;

  // Create class html file

  strcpy( fname, dir);
  strcat( fname, html_file_name);
  strcat( fname, ".html");
  cdh_ToLower( fname, fname);
  html_clf = new CnvFile();
  html_clf->f.open( fname);

  fp_tmp.open( cread_cTmpFile1);

  fp_tmp <<
"<HR><BR>" << endl <<
"<A NAME=\"detail\"><H1>Attributes detail</H1></A>" << endl;

  html_class_open = 1;

  html_clf->f <<
"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Frameset//EN\"\"http://www.w3.org/TR/REC-html40/frameset.dtd\">" << endl <<
"<!--NewPage-->" << endl <<
"<HTML>" << endl <<
"<HEAD>" << endl <<
"<!-- Generated by pwr_cnv-->" << endl <<
"<TITLE>" << endl <<
": Class  " << full_class_name << endl <<
"</TITLE>" << endl <<
"<LINK REL =\"stylesheet\" TYPE=\"text/css\" HREF=\"../../stylesheet.css\" TITLE=\"Style\">" << endl <<
"</HEAD>" << endl <<
"<BODY BGCOLOR=\"white\">" << endl <<
"" << endl <<
"<!-- ========== START OF NAVBAR ========== -->" << endl <<
"<A NAME=\"navbar_top\"><!-- --></A>" << endl <<
"<TABLE BORDER=\"0\" WIDTH=\"100%\" CELLPADDING=\"1\" CELLSPACING=\"0\">" << endl <<
"<TR>" << endl <<
"<TD COLSPAN=2 BGCOLOR=\"#EEEEFF\" CLASS=\"NavBarCell1\">" << endl <<
"<A NAME=\"navbar_top_firstrow\"><FONT  CLASS=\"NavBarFont1Rev\"><B>Volume " << volume_name << "</B></FONT></A>" << endl <<
"</TD>" << endl <<
"</TR>" << endl <<
endl <<
"<TR>" << endl <<
"<TD BGCOLOR=\"white\" CLASS=\"NavBarCell2\"><FONT SIZE=\"-2\">" << endl <<
"  Attributes: &nbsp;<A HREF=\"#RtBody\">Runtime</A>" << endl <<
"&nbsp;|&nbsp;<A HREF=\"#DevBody\">Development</A>" << endl <<
"&nbsp;|&nbsp;<A HREF=\"#SysBody\">System</A>" << endl <<
"&nbsp;|&nbsp;<A HREF=\"#template\">Template</A>" << endl <<
"&nbsp;|&nbsp;<A HREF=\"#detail\">Detail</A>" << endl <<
"&nbsp;|&nbsp;<A HREF=\"" << struct_file << "#" << class_name << "\">Struct</A>" << endl;
  if ( doc_fresh && strcmp( doc_code, "") != 0)
  {
    src_filename_to_html( ref_name, doc_code);
    html_clf->f <<
"&nbsp;|&nbsp;<A HREF=\"" << ref_name << "#" << low_class_name << "\">Code</A>" << endl;
  }

  html_clf->f <<
"</FONT></TD>" << endl <<
"<TD BGCOLOR=\"white\" CLASS=\"NavBarCell2\"><FONT SIZE=\"-2\">" << endl <<
"  <A HREF=\"" << low_volume_name << "_index.html\" TARGET=\"_top\"><B>INDEX</B></A>  &nbsp;" << endl <<
"&nbsp;<A HREF=\"" << html_file_name << ".html\" TARGET=\"_top\"><B>NO INDEX</B></A></FONT></TD>" << endl <<
"</TR>" << endl <<
"</TABLE>" << endl <<
"<!-- =========== END OF NAVBAR =========== -->" << endl <<
endl <<
"<HR>" << endl <<
"<!-- ======== START OF CLASS DATA ======== -->" << endl <<
"<H2>" << endl <<
"Class " << class_name << "</H2>" << endl <<
"<HR>" << endl <<
"<DL>" << endl;
  if ( doc_fresh && strcmp( doc_author, "") != 0)
  {
    html_clf->f <<
"<DT><B>Author</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << doc_author << "<DT>" << endl;
  }

  if ( doc_fresh && strcmp( doc_version, "") != 0)
  {
    html_clf->f <<
"<DT><B>Version</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << doc_version << "<DT>" << endl;
  }
  if ( doc_fresh && strcmp( doc_code, "") != 0)
  {
    html_clf->f <<
"<DT><B>Code</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << doc_code << "<DT>" << endl;
  }

  html_clf->f <<
"<BR><DT><B>Description</B><DT><BR>" << endl <<
"</DL><XMP>" << endl;

  if ( doc_fresh)
    for ( i = 0; i < doc_cnt; i++)
      html_clf->f << doc_text[i] << endl;

  html_clf->f <<
"</XMP>" << endl;

  for ( i = 0; i < doc_link_cnt; i++) {
    html_clf->f <<
"  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF=\"" << doc_link_ref[i] << "\" TARGET=\"_self\"> " << doc_link_text[i] <<"</A><BR>" << endl;
  }
  for ( i = 0; i < doc_clink_cnt; i++) {
    html_clf->f <<
"  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<A HREF=\"" << doc_clink_ref[i] << "\" TARGET=\"_self\"> " << doc_clink_text[i] <<"</A><BR>" << endl;
  }
  return 1;
}

int ClassRead::html_body()
{
  char struct_name[80];

  if ( strcmp( low(body_name), "devbody") == 0)
    strcpy( struct_name, "");
  else
  {
    strcpy( struct_name, "pwr_sClass_");
    if ( strcmp( body_structname, "") == 0)
      strcat( struct_name, class_name);
    else
      strcat( struct_name, body_structname);
  }

  html_clf->f <<
"<!-- =========== BODY =========== -->" << endl <<
endl <<
"<HR><BR>" << endl <<
"<A NAME=\"" << body_name << "\"><!-- --></A>" << endl <<
"<TABLE BORDER=\"1\" CELLPADDING=\"3\" CELLSPACING=\"0\" WIDTH=\"100%\">" << endl <<
"<TR BGCOLOR=\"#CCCCFF\" CLASS=\"TableHeadingColor\">" << endl <<
"<TD COLSPAN=3><FONT SIZE=\"+2\">" << endl <<
"<B>" << body_name << " attributes</B></FONT>" <<
"<FONT SIZE=\"+1\"<B>&nbsp;&nbsp;&nbsp;&nbsp;" << struct_name << "</B></FONT></TD>" << endl <<
"</TR>" << endl;

  return 1;
}

int ClassRead::html_body_close()
{
  html_clf->f <<
"</TABLE>" << endl;

  return 1;
}

int ClassRead::html_graphplcnode()
{
  int i;

  html_clf->f <<
"<!-- =========== GRAPHPLCNODE =========== -->" << endl <<
endl <<
"<HR><BR>" << endl <<
"<A NAME=\"GraphPlcNode\"><!-- --></A>" << endl <<
"<TABLE BORDER=\"1\" CELLPADDING=\"3\" CELLSPACING=\"0\" WIDTH=\"100%\">" << endl <<
"<TR BGCOLOR=\"#CCCCFF\" CLASS=\"TableHeadingColor\">" << endl <<
"<TD COLSPAN=2><FONT SIZE=\"+2\">" << endl <<
"<B>" << graphplcnode_name << "</B></FONT></TD>" << endl <<
"</TR>" << endl;

  for ( i = 0; i < doc_cnt; i += 2)
  {
    html_clf->f <<
"<TR BGCOLOR=\"white\" CLASS=\"TableRowColor\">" << endl <<
"<TD><CODE><B>" << doc_text[i] << "</B></CODE></TD>" << endl <<
"<TD><CODE>" << doc_text[i+1] << "</CODE></TD>" << endl;
  }

  return 1;
}

int ClassRead::html_graphplccon()
{
  int i;

  html_clf->f <<
"<!-- =========== GRAPHPLCCON =========== -->" << endl <<
endl <<
"<HR><BR>" << endl <<
"<TABLE BORDER=\"1\" CELLPADDING=\"3\" CELLSPACING=\"0\" WIDTH=\"100%\">" << endl <<
"<TR BGCOLOR=\"#CCCCFF\" CLASS=\"TableHeadingColor\">" << endl <<
"<TD COLSPAN=2><FONT SIZE=\"+2\">" << endl <<
"<B>" << graphplccon_name << "</B></FONT></TD>" << endl <<
"</TR>" << endl;

  for ( i = 0; i < doc_cnt; i += 2)
  {
    html_clf->f <<
"<TR BGCOLOR=\"white\" CLASS=\"TableRowColor\">" << endl <<
"<TD><CODE><B>" << doc_text[i] << "</B></CODE></TD>" << endl <<
"<TD><CODE>" << doc_text[i+1] << "</CODE></TD>" << endl;
  }

  return 1;
}

int ClassRead::html_template()
{
  int i;

  if ( !html_class_open)
    return 1;

  html_clf->f <<
"<!-- =========== TEMPLATE =========== -->" << endl <<
endl <<
"<HR><BR>" << endl <<
"<A NAME=\"template\"><!-- --></A>" << endl <<
"<TABLE BORDER=\"1\" CELLPADDING=\"3\" CELLSPACING=\"0\" WIDTH=\"100%\">" << endl <<
"<TR BGCOLOR=\"#CCCCFF\" CLASS=\"TableHeadingColor\">" << endl <<
"<TD COLSPAN=2><FONT SIZE=\"+2\">" << endl <<
"<B>Template Object</B></FONT></TD>" << endl <<
"</TR>" << endl;

  for ( i = 0; i < doc_cnt; i += 2)
  {
    html_clf->f <<
"<TR BGCOLOR=\"white\" CLASS=\"TableRowColor\">" << endl <<
"<TD><CODE><B>" << doc_text[i] << "</B></CODE></TD>" << endl <<
"<TD><CODE>" << doc_text[i+1] << "</CODE></TD>" << endl;
  }


  return 1;
}

int ClassRead::html_class_close()
{
  fp_tmp.close();

  // Copy temporary file
  copy_tmp_file( cread_cTmpFile1, html_clf->f);

  html_clf->f <<
"<!-- ========= END OF CLASS DATA ========= -->" << endl <<
"</BODY>" << endl <<
"</HTML>" << endl;

  html_clf->f.close();
  delete html_clf;

  html_class_open = 0;

  return 1;
}

int ClassRead::html_attribute()
{
  int i;

  // Summary

  html_clf->f <<
"<TR BGCOLOR=\"white\" CLASS=\"TableRowColor\">" << endl <<
"<TD ALIGN=\"right\" VALIGN=\"top\" WIDTH=\"1%\"><FONT SIZE=\"-1\">" << endl;

  if ( attr_array && attr_pointer)
    html_clf->f <<
"<CODE>Array of pointers to "<< attr_typeref << "</CODE></FONT></TD>" << endl;
  else if ( attr_array)
    html_clf->f <<
"<CODE>Array of "<< attr_typeref << "</CODE></FONT></TD>" << endl;
  else if ( attr_pointer)
    html_clf->f <<
"<CODE>Pointer to " << attr_typeref << "</CODE></FONT></TD>" << endl;
  else
    html_clf->f <<
"<CODE>" << attr_typeref << "</CODE></FONT></TD>" << endl;

  html_clf->f <<
"<TD><A HREF=\"#" << attr_name << "\"><CODE><B>" << attr_name << "</B></CODE></A></TD>" << endl <<
"<TD>";
  if ( doc_fresh)
  {
    if ( strcmp( doc_summary, "") == 0) 
    {
      for ( i = 0; i < doc_cnt; i++)
      {
        html_clf->f << doc_text[i];
        if ( i < doc_cnt - 1)
          html_clf->f << "<BR>" << endl;
      }
    }
    else
      html_clf->f << doc_summary << endl;
  }
  else
    html_clf->f << "<BR>" << endl;

  html_clf->f <<
"</TD>" << endl;


  // Detail

  fp_tmp <<
"<HR>" << endl <<
"<A NAME=\"" << attr_name << "\"> <H3>" <<
"<FONT SIZE=\"-1\">" << attr_type << "</FONT> " << attr_name << "</H3></A>" << endl <<
"<DL><DT>" << endl;

  if ( attr_array && attr_pointer)
    fp_tmp <<
"<CODE><B>Type</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Array of pointers to "<< attr_typeref << "</CODE><DT>" << endl;
  else if ( attr_array)
    fp_tmp <<
"<CODE><B>Type</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Array of "<< attr_typeref << "</CODE><DT>" << endl;
  else if ( attr_pointer)
    fp_tmp <<
"<CODE><B>Type</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pointer to " << attr_typeref << "</CODE><DT>" << endl;
  else
    fp_tmp <<
"<CODE><B>Type</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << attr_typeref << "</CODE><DT>" << endl;

  fp_tmp <<
"<DT><CODE><B>Flags</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << attr_flags << "</CODE><DT>" << endl;

  if ( attr_array)
    fp_tmp <<
"<DT><CODE><B>Elements</B>&nbsp;&nbsp;" << attr_elements << "</CODE><DT>" << endl;

  fp_tmp <<
"<DT><CODE><B>Body</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" << body_name << "</CODE><DT>" << endl <<
"<DT><CODE><B>Class</B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$" << attr_type << "</CODE><DT>" << endl;

  fp_tmp <<
"<BR>" << endl <<
"<CODE><B>Description</B></CODE><DT></DL>" << endl <<
"<XMP>" << endl;

  if ( doc_fresh)
    for ( i = 0; i < doc_cnt; i++)
      fp_tmp << doc_text[i] << endl;

  fp_tmp <<
"</XMP>" << endl;

  return 1;
}

